import * as tslib_1 from "tslib";
import { Component, Input, Optional } from '@angular/core';
import { TranslateService } from '@ngx-translate/core';
import { Constants } from '../constants';
import { PaginationService } from '../services/pagination.service';
import { unsubscribeAllObservables } from '../services/utilities';
var SlickPaginationComponent = /** @class */ (function () {
    /** Constructor */
    function SlickPaginationComponent(paginationService, translate) {
        this.paginationService = paginationService;
        this.translate = translate;
        this.subscriptions = [];
        this._enableTranslate = false;
        // text translations (handled by ngx-translate or by custom locale)
        this.textItemsPerPage = 'items per page';
        this.textItems = 'items';
        this.textOf = 'of';
        this.textPage = 'Page';
    }
    Object.defineProperty(SlickPaginationComponent.prototype, "availablePageSizes", {
        get: function () {
            return this.paginationService.availablePageSizes;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SlickPaginationComponent.prototype, "dataFrom", {
        get: function () {
            return this.paginationService.dataFrom;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SlickPaginationComponent.prototype, "dataTo", {
        get: function () {
            return this.paginationService.dataTo;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SlickPaginationComponent.prototype, "itemsPerPage", {
        get: function () {
            return this.paginationService.itemsPerPage;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SlickPaginationComponent.prototype, "pageCount", {
        get: function () {
            return this.paginationService.pageCount;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SlickPaginationComponent.prototype, "pageNumber", {
        get: function () {
            return this.paginationService.pageNumber;
        },
        set: function (page) {
            // the setter has to be declared but we won't use it, instead we will use the "changeToCurrentPage()" to only update the value after ENTER keydown event
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SlickPaginationComponent.prototype, "totalItems", {
        get: function () {
            return this.paginationService.totalItems;
        },
        enumerable: true,
        configurable: true
    });
    SlickPaginationComponent.prototype.ngOnDestroy = function () {
        this.dispose();
    };
    SlickPaginationComponent.prototype.ngOnInit = function () {
        var _this = this;
        var gridOptions = this.gridOptions || {};
        this._enableTranslate = gridOptions && gridOptions.enableTranslate || false;
        this._locales = gridOptions && gridOptions.locales || Constants.locales;
        if (this._enableTranslate && !this.translate) {
            throw new Error('[Angular-Slickgrid] requires "ngx-translate" to be installed and configured when the grid option "enableTranslate" is enabled.');
        }
        this.translateAllUiTexts(this._locales);
        // translate all the text using ngx-translate or custom locales
        if (this._enableTranslate && this.translate && this.translate.onLangChange) {
            this.subscriptions.push(this.translate.onLangChange.subscribe(function () { return _this.translateAllUiTexts(_this._locales); }));
        }
    };
    SlickPaginationComponent.prototype.changeToFirstPage = function (event) {
        this.paginationService.goToFirstPage(event);
    };
    SlickPaginationComponent.prototype.changeToLastPage = function (event) {
        this.paginationService.goToLastPage(event);
    };
    SlickPaginationComponent.prototype.changeToNextPage = function (event) {
        this.paginationService.goToNextPage(event);
    };
    SlickPaginationComponent.prototype.changeToPreviousPage = function (event) {
        this.paginationService.goToPreviousPage(event);
    };
    SlickPaginationComponent.prototype.changeToCurrentPage = function (event) {
        var pageNumber = 1;
        if (event && event.currentTarget && event.currentTarget.value) {
            pageNumber = +(event.currentTarget.value);
        }
        this.paginationService.goToPageNumber(pageNumber, event);
    };
    SlickPaginationComponent.prototype.changeItemPerPage = function (event) {
        var itemsPerPage = 1;
        if (event && event.currentTarget && event.currentTarget.value) {
            itemsPerPage = +(event.currentTarget.value);
        }
        this.paginationService.changeItemPerPage(itemsPerPage, event);
    };
    SlickPaginationComponent.prototype.dispose = function () {
        this.paginationService.dispose();
        // also unsubscribe all Angular Subscriptions
        this.subscriptions = unsubscribeAllObservables(this.subscriptions);
    };
    // --
    // private functions
    // --------------------
    /** Translate all the texts shown in the UI, use ngx-translate service when available or custom locales when service is null */
    SlickPaginationComponent.prototype.translateAllUiTexts = function (locales) {
        if (this._enableTranslate && this.translate && this.translate.instant && this.translate.currentLang) {
            this.textItemsPerPage = this.translate.instant('ITEMS_PER_PAGE');
            this.textItems = this.translate.instant('ITEMS');
            this.textOf = this.translate.instant('OF');
            this.textPage = this.translate.instant('PAGE');
        }
        else if (locales) {
            this.textItemsPerPage = locales.TEXT_ITEMS_PER_PAGE || 'TEXT_ITEMS_PER_PAGE';
            this.textItems = locales.TEXT_ITEMS || 'TEXT_ITEMS';
            this.textOf = locales.TEXT_OF || 'TEXT_OF';
            this.textPage = locales.TEXT_PAGE || 'TEXT_PAGE';
        }
    };
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], SlickPaginationComponent.prototype, "gridOptions", void 0);
    SlickPaginationComponent = tslib_1.__decorate([
        Component({
            selector: 'slick-pagination',
            template: "<div class=\"slick-pagination\">\r\n  <div class=\"slick-pagination-nav\">\r\n    <nav aria-label=\"Page navigation\">\r\n      <ul class=\"pagination\">\r\n        <li class=\"page-item\" [ngClass]=\"(pageNumber === 1 || totalItems === 0) ? 'disabled' : ''\">\r\n          <a class=\"page-link icon-seek-first fa fa-angle-double-left\" aria-label=\"First\"\r\n            (click)=\"changeToFirstPage($event)\">\r\n          </a>\r\n        </li>\r\n        <li class=\"page-item\" [ngClass]=\"(pageNumber === 1 || totalItems === 0) ? 'disabled' : ''\">\r\n          <a class=\"page-link icon-seek-prev fa fa-angle-left\" aria-label=\"Previous\"\r\n            (click)=\"changeToPreviousPage($event)\">\r\n          </a>\r\n        </li>\r\n      </ul>\r\n    </nav>\r\n\r\n    <div class=\"slick-page-number\">\r\n      <span>{{textPage}}</span>\r\n      <input type=\"text\" class=\"form-control\" data-test=\"page-number-input\" [value]=\"pageNumber\" size=\"1\"\r\n        [readOnly]=\"totalItems === 0\" (change)=\"changeToCurrentPage($event)\">\r\n      <span>{{textOf}}</span><span data-test=\"page-count\"> {{pageCount}}</span>\r\n    </div>\r\n\r\n    <nav aria-label=\"Page navigation\">\r\n      <ul class=\"pagination\">\r\n        <li class=\"page-item\" [ngClass]=\"(pageNumber === pageCount || totalItems === 0) ? 'disabled' : ''\">\r\n          <a class=\"page-link icon-seek-next text-center fa fa-lg fa-angle-right\" aria-label=\"Next\"\r\n            (click)=\"changeToNextPage($event)\">\r\n          </a>\r\n        </li>\r\n        <li class=\"page-item\" [ngClass]=\"(pageNumber === pageCount || totalItems === 0) ? 'disabled' : ''\">\r\n          <a class=\"page-link icon-seek-end fa fa-lg fa-angle-double-right\" aria-label=\"Last\"\r\n            (click)=\"changeToLastPage($event)\">\r\n          </a>\r\n        </li>\r\n      </ul>\r\n    </nav>\r\n  </div>\r\n  <span class=\"slick-pagination-settings\">\r\n    <select id=\"items-per-page-label\" [value]=\"itemsPerPage\" (change)=\"changeItemPerPage($event)\">\r\n      <option value=\"{{pageSize}}\" *ngFor=\"let pageSize of availablePageSizes\">{{pageSize}}</option>\r\n    </select>\r\n    <span>{{textItemsPerPage}}</span>,\r\n    <span class=\"slick-pagination-count\">\r\n      <span *ngIf=\"totalItems\">\r\n        <span class=\"page-info-from-to\">\r\n          <span data-test=\"item-from\">{{dataFrom}}</span>-<span data-test=\"item-to\">{{dataTo}}</span>\r\n          {{textOf}}\r\n        </span>\r\n      </span>\r\n      <span class=\"page-info-total-items\">\r\n        <span data-test=\"total-items\">{{totalItems}}</span> {{textItems}}\r\n      </span>\r\n    </span>\r\n  </span>\r\n</div>\r\n"
        }),
        tslib_1.__param(1, Optional()),
        tslib_1.__metadata("design:paramtypes", [PaginationService, TranslateService])
    ], SlickPaginationComponent);
    return SlickPaginationComponent;
}());
export { SlickPaginationComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpY2stcGFnaW5hdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLXNsaWNrZ3JpZC8iLCJzb3VyY2VzIjpbImFwcC9tb2R1bGVzL2FuZ3VsYXItc2xpY2tncmlkL2NvbXBvbmVudHMvc2xpY2stcGFnaW5hdGlvbi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFxQixRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDOUUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFHdkQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUV6QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNuRSxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQU1sRTtJQWFFLGtCQUFrQjtJQUNsQixrQ0FBb0IsaUJBQW9DLEVBQXNCLFNBQTJCO1FBQXJGLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFBc0IsY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUFYakcsa0JBQWEsR0FBbUIsRUFBRSxDQUFDO1FBQ25DLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQUdqQyxtRUFBbUU7UUFDbkUscUJBQWdCLEdBQUcsZ0JBQWdCLENBQUM7UUFDcEMsY0FBUyxHQUFHLE9BQU8sQ0FBQztRQUNwQixXQUFNLEdBQUcsSUFBSSxDQUFDO1FBQ2QsYUFBUSxHQUFHLE1BQU0sQ0FBQztJQUcyRixDQUFDO0lBRTlHLHNCQUFJLHdEQUFrQjthQUF0QjtZQUNFLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLGtCQUFrQixDQUFDO1FBQ25ELENBQUM7OztPQUFBO0lBRUQsc0JBQUksOENBQVE7YUFBWjtZQUNFLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQztRQUN6QyxDQUFDOzs7T0FB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Q2hEO2FBQU0sSUFBSSxPQUFPLEVBQUU7WUFDbEIsSUFBSSxDQUFDLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsSUFBSSxxQkFBcUIsQ0FBQztZQUM3RSxJQUFJLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQyxVQUFVLElBQUksWUFBWSxDQUFDO1lBQ3BELElBQUksQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLE9BQU8sSUFBSSxTQUFTLENBQUM7WUFDM0MsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsU0FBUyxJQUFJLFdBQVcsQ0FBQztTQUNsRDtJQUNILENBQUM7SUEzSFE7UUFBUixLQUFLLEVBQUU7O2lFQUF5QjtJQUR0Qix3QkFBd0I7UUFKcEMsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLGtCQUFrQjtZQUM1QixtcEZBQWdEO1NBQ2pELENBQUM7UUFlMkQsbUJBQUEsUUFBUSxFQUFFLENBQUE7aURBQTlCLGlCQUFpQixFQUFpQyxnQkFBZ0I7T0FkOUYsd0JBQXdCLENBNkhwQztJQUFELCtCQUFDO0NBQUEsQUE3SEQsSUE2SEM7U0E3SFksd0JBQXdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25EZXN0cm95LCBPbkluaXQsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcclxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcblxyXG5pbXBvcnQgeyBDb25zdGFudHMgfSBmcm9tICcuLi9jb25zdGFudHMnO1xyXG5pbXBvcnQgeyBHcmlkT3B0aW9uLCBMb2NhbGUgfSBmcm9tICcuLy4uL21vZGVscy9pbmRleCc7XHJcbmltcG9ydCB7IFBhZ2luYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvcGFnaW5hdGlvbi5zZXJ2aWNlJztcclxuaW1wb3J0IHsgdW5zdWJzY3JpYmVBbGxPYnNlcnZhYmxlcyB9IGZyb20gJy4uL3NlcnZpY2VzL3V0aWxpdGllcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3NsaWNrLXBhZ2luYXRpb24nLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9zbGljay1wYWdpbmF0aW9uLmNvbXBvbmVudC5odG1sJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgU2xpY2tQYWdpbmF0aW9uQ29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95LCBPbkluaXQge1xyXG4gIEBJbnB1dCgpIGdyaWRPcHRpb25zOiBHcmlkT3B0aW9uO1xyXG5cclxuICBwcml2YXRlIHN1YnNjcmlwdGlvbnM6IFN1YnNjcmlwdGlvbltdID0gW107XHJcbiAgcHJpdmF0ZSBfZW5hYmxlVHJhbnNsYXRlID0gZmFsc2U7XHJcbiAgcHJpdmF0ZSBfbG9jYWxlczogTG9jYWxlO1xyXG5cclxuICAvLyB0ZXh0IHRyYW5zbGF0aW9ucyAoaGFuZGxlZCBieSBuZ3gtdHJhbnNsYXRlIG9yIGJ5IGN1c3RvbSBsb2NhbGUpXHJcbiAgdGV4dEl0ZW1zUGVyUGFnZSA9ICdpdGVtcyBwZXIgcGFnZSc7XHJcbiAgdGV4dEl0ZW1zID0gJ2l0ZW1zJztcclxuICB0ZXh0T2YgPSAnb2YnO1xyXG4gIHRleHRQYWdlID0gJ1BhZ2UnO1xyXG5cclxuICAvKiogQ29uc3RydWN0b3IgKi9cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHBhZ2luYXRpb25TZXJ2aWNlOiBQYWdpbmF0aW9uU2VydmljZSwgQE9wdGlvbmFsKCkgcHJpdmF0ZSB0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2UpIHsgfVxyXG5cclxuICBnZXQgYXZhaWxhYmxlUGFnZVNpemVzKCk6IG51bWJlcltdIHtcclxuICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25TZXJ2aWNlLmF2YWlsYWJsZVBhZ2VTaXplcztcclxuICB9XHJcblxyXG4gIGdldCBkYXRhRnJvbSgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvblNlcnZpY2UuZGF0YUZyb207XHJcbiAgfVxyXG5cclxuICBnZXQgZGF0YVRvKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uU2VydmljZS5kYXRhVG87XHJcbiAgfVxyXG5cclxuICBnZXQgaXRlbXNQZXJQYWdlKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uU2VydmljZS5pdGVtc1BlclBhZ2U7XHJcbiAgfVxyXG5cclxuICBnZXQgcGFnZUNvdW50KCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uU2VydmljZS5wYWdlQ291bnQ7XHJcbiAgfVxyXG5cclxuICBnZXQgcGFnZU51bWJlcigpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvblNlcnZpY2UucGFnZU51bWJlcjtcclxuICB9XHJcbiAgc2V0IHBhZ2VOdW1iZXIocGFnZTogbnVtYmVyKSB7XHJcbiAgICAvLyB0aGUgc2V0dGVyIGhhcyB0byBiZSBkZWNsYXJlZCBidXQgd2Ugd29uJ3QgdXNlIGl0LCBpbnN0ZWFkIHdlIHdpbGwgdXNlIHRoZSBcImNoYW5nZVRvQ3VycmVudFBhZ2UoKVwiIHRvIG9ubHkgdXBkYXRlIHRoZSB2YWx1ZSBhZnRlciBFTlRFUiBrZXlkb3duIGV2ZW50XHJcbiAgfVxyXG5cclxuICBnZXQgdG90YWxJdGVtcygpIHtcclxuICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25TZXJ2aWNlLnRvdGFsSXRlbXM7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIHRoaXMuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBjb25zdCBncmlkT3B0aW9uczogR3JpZE9wdGlvbiA9IHRoaXMuZ3JpZE9wdGlvbnMgfHwge307XHJcbiAgICB0aGlzLl9lbmFibGVUcmFuc2xhdGUgPSBncmlkT3B0aW9ucyAmJiBncmlkT3B0aW9ucy5lbmFibGVUcmFuc2xhdGUgfHwgZmFsc2U7XHJcbiAgICB0aGlzLl9sb2NhbGVzID0gZ3JpZE9wdGlvbnMgJiYgZ3JpZE9wdGlvbnMubG9jYWxlcyB8fCBDb25zdGFudHMubG9jYWxlcztcclxuXHJcbiAgICBpZiAodGhpcy5fZW5hYmxlVHJhbnNsYXRlICYmICF0aGlzLnRyYW5zbGF0ZSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tBbmd1bGFyLVNsaWNrZ3JpZF0gcmVxdWlyZXMgXCJuZ3gtdHJhbnNsYXRlXCIgdG8gYmUgaW5zdGFsbGVkIGFuZCBjb25maWd1cmVkIHdoZW4gdGhlIGdyaWQgb3B0aW9uIFwiZW5hYmxlVHJhbnNsYXRlXCIgaXMgZW5hYmxlZC4nKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnRyYW5zbGF0ZUFsbFVpVGV4dHModGhpcy5fbG9jYWxlcyk7XHJcblxyXG4gICAgLy8gdHJhbnNsYXRlIGFsbCB0aGUgdGV4dCB1c2luZyBuZ3gtdHJhbnNsYXRlIG9yIGN1c3RvbSBsb2NhbGVzXHJcbiAgICBpZiAodGhpcy5fZW5hYmxlVHJhbnNsYXRlICYmIHRoaXMudHJhbnNsYXRlICYmIHRoaXMudHJhbnNsYXRlLm9uTGFuZ0NoYW5nZSkge1xyXG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaCh0aGlzLnRyYW5zbGF0ZS5vbkxhbmdDaGFuZ2Uuc3Vic2NyaWJlKCgpID0+IHRoaXMudHJhbnNsYXRlQWxsVWlUZXh0cyh0aGlzLl9sb2NhbGVzKSkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2hhbmdlVG9GaXJzdFBhZ2UoZXZlbnQ6IGFueSkge1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uU2VydmljZS5nb1RvRmlyc3RQYWdlKGV2ZW50KTtcclxuICB9XHJcblxyXG4gIGNoYW5nZVRvTGFzdFBhZ2UoZXZlbnQ6IGFueSkge1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uU2VydmljZS5nb1RvTGFzdFBhZ2UoZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgY2hhbmdlVG9OZXh0UGFnZShldmVudDogYW55KSB7XHJcbiAgICB0aGlzLnBhZ2luYXRpb25TZXJ2aWNlLmdvVG9OZXh0UGFnZShldmVudCk7XHJcbiAgfVxyXG5cclxuICBjaGFuZ2VUb1ByZXZpb3VzUGFnZShldmVudDogYW55KSB7XHJcbiAgICB0aGlzLnBhZ2luYXRpb25TZXJ2aWNlLmdvVG9QcmV2aW91c1BhZ2UoZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgY2hhbmdlVG9DdXJyZW50UGFnZShldmVudDogYW55KSB7XHJcbiAgICBsZXQgcGFnZU51bWJlciA9IDE7XHJcbiAgICBpZiAoZXZlbnQgJiYgZXZlbnQuY3VycmVudFRhcmdldCAmJiBldmVudC5jdXJyZW50VGFyZ2V0LnZhbHVlKSB7XHJcbiAgICAgIHBhZ2VOdW1iZXIgPSArKGV2ZW50LmN1cnJlbnRUYXJnZXQudmFsdWUpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5wYWdpbmF0aW9uU2VydmljZS5nb1RvUGFnZU51bWJlcihwYWdlTnVtYmVyLCBldmVudCk7XHJcbiAgfVxyXG5cclxuICBjaGFuZ2VJdGVtUGVyUGFnZShldmVudDogYW55KSB7XHJcbiAgICBsZXQgaXRlbXNQZXJQYWdlID0gMTtcclxuICAgIGlmIChldmVudCAmJiBldmVudC5jdXJyZW50VGFyZ2V0ICYmIGV2ZW50LmN1cnJlbnRUYXJnZXQudmFsdWUpIHtcclxuICAgICAgaXRlbXNQZXJQYWdlID0gKyhldmVudC5jdXJyZW50VGFyZ2V0LnZhbHVlKTtcclxuICAgIH1cclxuICAgIHRoaXMucGFnaW5hdGlvblNlcnZpY2UuY2hhbmdlSXRlbVBlclBhZ2UoaXRlbXNQZXJQYWdlLCBldmVudCk7XHJcbiAgfVxyXG5cclxuICBkaXNwb3NlKCkge1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uU2VydmljZS5kaXNwb3NlKCk7XHJcblxyXG4gICAgLy8gYWxzbyB1bnN1YnNjcmliZSBhbGwgQW5ndWxhciBTdWJzY3JpcHRpb25zXHJcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSB1bnN1YnNjcmliZUFsbE9ic2VydmFibGVzKHRoaXMuc3Vic2NyaXB0aW9ucyk7XHJcbiAgfVxyXG5cclxuICAvLyAtLVxyXG4gIC8vIHByaXZhdGUgZnVuY3Rpb25zXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgLyoqIFRyYW5zbGF0ZSBhbGwgdGhlIHRleHRzIHNob3duIGluIHRoZSBVSSwgdXNlIG5neC10cmFuc2xhdGUgc2VydmljZSB3aGVuIGF2YWlsYWJsZSBvciBjdXN0b20gbG9jYWxlcyB3aGVuIHNlcnZpY2UgaXMgbnVsbCAqL1xyXG4gIHByaXZhdGUgdHJhbnNsYXRlQWxsVWlUZXh0cyhsb2NhbGVzOiBMb2NhbGUpIHtcclxuICAgIGlmICh0aGlzLl9lbmFibGVUcmFuc2xhdGUgJiYgdGhpcy50cmFuc2xhdGUgJiYgdGhpcy50cmFuc2xhdGUuaW5zdGFudCAmJiB0aGlzLnRyYW5zbGF0ZS5jdXJyZW50TGFuZykge1xyXG4gICAgICB0aGlzLnRleHRJdGVtc1BlclBhZ2UgPSB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KCdJVEVNU19QRVJfUEFHRScpO1xyXG4gICAgICB0aGlzLnRleHRJdGVtcyA9IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ0lURU1TJyk7XHJcbiAgICAgIHRoaXMudGV4dE9mID0gdGhpcy50cmFuc2xhdGUuaW5zdGFudCgnT0YnKTtcclxuICAgICAgdGhpcy50ZXh0UGFnZSA9IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ1BBR0UnKTtcclxuICAgIH0gZWxzZSBpZiAobG9jYWxlcykge1xyXG4gICAgICB0aGlzLnRleHRJdGVtc1BlclBhZ2UgPSBsb2NhbGVzLlRFWFRfSVRFTVNfUEVSX1BBR0UgfHwgJ1RFWFRfSVRFTVNfUEVSX1BBR0UnO1xyXG4gICAgICB0aGlzLnRleHRJdGVtcyA9IGxvY2FsZXMuVEVYVF9JVEVNUyB8fCAnVEVYVF9JVEVNUyc7XHJcbiAgICAgIHRoaXMudGV4dE9mID0gbG9jYWxlcy5URVhUX09GIHx8ICdURVhUX09GJztcclxuICAgICAgdGhpcy50ZXh0UGFnZSA9IGxvY2FsZXMuVEVYVF9QQUdFIHx8ICdURVhUX1BBR0UnO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=