import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { parseUtcDate, mapOperatorByFieldType, titleCase } from './utilities';
import { CaseType, FieldType, SortDirection, OperatorType } from './../models/index';
import { OdataQueryBuilderService } from './odataQueryBuilder.service';
var DEFAULT_ITEMS_PER_PAGE = 25;
var DEFAULT_PAGE_SIZE = 20;
var GridOdataService = /** @class */ (function () {
    function GridOdataService() {
        this._currentFilters = [];
        this._currentSorters = [];
        this.defaultOptions = {
            top: DEFAULT_ITEMS_PER_PAGE,
            orderBy: '',
            caseType: CaseType.pascalCase
        };
        this._odataService = new OdataQueryBuilderService();
    }
    Object.defineProperty(GridOdataService.prototype, "columnDefinitions", {
        /** Getter for the Column Definitions */
        get: function () {
            return this._columnDefinitions;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GridOdataService.prototype, "odataService", {
        /** Getter for the Odata Service */
        get: function () {
            return this._odataService;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GridOdataService.prototype, "_gridOptions", {
        /** Getter for the Grid Options pulled through the Grid Object */
        get: function () {
            return (this._grid && this._grid.getOptions) ? this._grid.getOptions() : {};
        },
        enumerable: true,
        configurable: true
    });
    GridOdataService.prototype.init = function (serviceOptions, pagination, grid) {
        this._grid = grid;
        var mergedOptions = tslib_1.__assign({}, this.defaultOptions, serviceOptions);
        // unless user specifically set "enablePagination" to False, we'll add "top" property for the pagination in every other cases
        if (this._gridOptions && !this._gridOptions.enablePagination) {
            // save current pagination as Page 1 and page size as "top"
            this._odataService.options = tslib_1.__assign({}, mergedOptions, { top: null });
            this._currentPagination = null;
        }
        else {
            var topOption = (pagination && pagination.pageSize) ? pagination.pageSize : this.defaultOptions.top;
            this._odataService.options = tslib_1.__assign({}, mergedOptions, { top: topOption });
            this._currentPagination = {
                pageNumber: 1,
                pageSize: this._odataService.options.top || this.defaultOptions.top || DEFAULT_PAGE_SIZE,
            };
        }
        this.options = this._odataService.options;
        this.pagination = pagination;
        if (grid && grid.getColumns) {
            this._columnDefinitions = serviceOptions && serviceOptions.columnDefinitions || grid.getColumns();
            this._columnDefinitions = this._columnDefinitions.filter(function (column) { return !column.excludeFromQuery; });
        }
    };
    GridOdataService.prototype.buildQuery = function () {
        return this._odataService.buildQuery();
    };
    GridOdataService.prototype.clearFilters = function () {
        this._currentFilters = [];
        this.updateFilters([]);
    };
    GridOdataService.prototype.clearSorters = function () {
        this._currentSorters = [];
        this.updateSorters([]);
    };
    GridOdataService.prototype.updateOptions = function (serviceOptions) {
        this.options = tslib_1.__assign({}, this.options, serviceOptions);
        this._odataService.options = this.options;
    };
    GridOdataService.prototype.removeColumnFilter = function (fieldName) {
        this._odataService.removeColumnFilter(fieldName);
    };
    /** Get the Filters that are currently used by the grid */
    GridOdataService.prototype.getCurrentFilters = function () {
        return this._currentFilters;
    };
    /** Get the Pagination that is currently used by the grid */
    GridOdataService.prototype.getCurrentPagination = function () {
        return this._currentPagination;
    };
    /** Get the Sorters that are currently used by the grid */
    GridOdataService.prototype.getCurrentSorters = function () {
        return this._currentSorters;
    };
    /**
     * Mapper for mathematical operators (ex.: <= is "le", > is "gt")
     * @param string operator
     * @returns string map
     */
    GridOdataService.prototype.mapOdataOperator = function (operator) {
        var map = '';
        switch (operator) {
            case '<':
                map = 'lt';
                break;
            case '<=':
                map = 'le';
                break;
            case '>':
                map = 'gt';
                break;
            case '>=':
                map = 'ge';
                break;
            case '<>':
            case '!=':
                map = 'ne';
                break;
            case '=':
            case '==':
            default:
                map = 'eq';
                break;
        }
        return map;
    };
    /*
     * Reset the pagination options
     */
    GridOdataService.prototype.resetPaginationOptions = function () {
        this._odataService.updateOptions({
            skip: 0
        });
    };
    GridOdataService.prototype.saveColumnFilter = function (fieldName, value, terms) {
        this._odataService.saveColumnFilter(fieldName, value, terms);
    };
    /*
     * FILTERING
     */
    GridOdataService.prototype.processOnFilterChanged = function (event, args) {
        var gridOptions = this._gridOptions;
        var backendApi = gridOptions.backendServiceApi;
        if (backendApi === undefined) {
            throw new Error('Something went wrong in the GridOdataService, "backendServiceApi" is not initialized');
        }
        // keep current filters & always save it as an array (columnFilters can be an object when it is dealt by SlickGrid Filter)
        this._currentFilters = this.castFilterToColumnFilters(args.columnFilters);
        if (!args || !args.grid) {
            throw new Error('Something went wrong when trying create the GridOdataService, it seems that "args" is not populated correctly');
        }
        // loop through all columns to inspect filters & set the query
        this.updateFilters(args.columnFilters);
        this.resetPaginationOptions();
        return this._odataService.buildQuery();
    };
    /*
     * PAGINATION
     */
    GridOdataService.prototype.processOnPaginationChanged = function (event, args) {
        var pageSize = +(args.pageSize || ((this.pagination) ? this.pagination.pageSize : DEFAULT_PAGE_SIZE));
        this.updatePagination(args.newPage, pageSize);
        // build the OData query which we will use in the WebAPI callback
        return this._odataService.buildQuery();
    };
    /*
     * SORTING
     */
    GridOdataService.prototype.processOnSortChanged = function (event, args) {
        var sortColumns = (args.multiColumnSort) ? args.sortCols : new Array({ sortCol: args.sortCol, sortAsc: args.sortAsc });
        // loop through all columns to inspect sorters & set the query
        this.updateSorters(sortColumns);
        // build the OData query which we will use in the WebAPI callback
        return this._odataService.buildQuery();
    };
    /**
     * loop through all columns to inspect filters & update backend service filters
     * @param columnFilters
     */
    GridOdataService.prototype.updateFilters = function (columnFilters, isUpdatedByPresetOrDynamically) {
        var searchBy = '';
        var searchByArray = [];
        var odataVersion = this._odataService && this._odataService.options && this._odataService.options.version || 2;
        // on filter preset load, we need to keep current filters
        if (isUpdatedByPresetOrDynamically) {
            this._currentFilters = this.castFilterToColumnFilters(columnFilters);
        }
        var _loop_1 = function (columnId) {
            if (columnFilters.hasOwnProperty(columnId)) {
                var columnFilter_1 = columnFilters[columnId];
                // if user defined some "presets", then we need to find the filters from the column definitions instead
                var columnDef = void 0;
                if (isUpdatedByPresetOrDynamically && Array.isArray(this_1._columnDefinitions)) {
                    columnDef = this_1._columnDefinitions.find(function (column) {
                        return column.id === columnFilter_1.columnId;
                    });
                }
                else {
                    columnDef = columnFilter_1.columnDef;
                }
                if (!columnDef) {
                    throw new Error('[GridOData Service]: Something went wrong in trying to get the column definition of the specified filter (or preset filters). Did you make a typo on the filter columnId?');
                }
                var fieldName = columnDef.queryFieldFilter || columnDef.queryField || columnDef.field || columnDef.name || '';
                var fieldType = columnDef.type || FieldType.string;
                var searchTerms = (columnFilter_1 ? columnFilter_1.searchTerms : null) || [];
                var fieldSearchValue = (Array.isArray(searchTerms) && searchTerms.length === 1) ? searchTerms[0] : '';
                if (typeof fieldSearchValue === 'undefined') {
                    fieldSearchValue = '';
                }
                if (!fieldName) {
                    throw new Error("GridOData filter could not find the field name to query the search, your column definition must include a valid \"field\" or \"name\" (optionally you can also use the \"queryfield\" or \"queryFieldFilter\").");
                }
                fieldSearchValue = '' + fieldSearchValue; // make sure it's a string
                var matches = fieldSearchValue.match(/^([<>!=\*]{0,2})(.*[^<>!=\*])([\*]?)$/); // group 1: Operator, 2: searchValue, 3: last char is '*' (meaning starts with, ex.: abc*)
                var operator = columnFilter_1.operator || ((matches) ? matches[1] : '');
                var searchValue = (!!matches) ? matches[2] : '';
                var lastValueChar = (!!matches) ? matches[3] : (operator === '*z' ? '*' : '');
                var bypassOdataQuery = columnFilter_1.bypassBackendQuery || false;
                // no need to query if search value is empty
                if (fieldName && searchValue === '' && searchTerms.length <= 1) {
                    this_1.removeColumnFilter(fieldName);
                    return "continue";
                }
                if (Array.isArray(searchTerms) && searchTerms.length === 1 && typeof searchTerms[0] === 'string' && searchTerms[0].indexOf('..') > 0) {
                    searchTerms = searchTerms[0].split('..');
                    if (!operator) {
                        operator = OperatorType.rangeExclusive;
                    }
                }
                // escaping the search value
                searchValue = searchValue.replace("'", "''"); // escape single quotes by doubling them
                searchValue = encodeURIComponent(searchValue); // encode URI of the final search value
                // if we didn't find an Operator but we have a Column Operator inside the Filter (DOM Element), we should use its default Operator
                // multipleSelect is "IN", while singleSelect is "EQ", else don't map any operator
                if (!operator && columnDef.filter) {
                    operator = columnDef.filter.operator;
                }
                // if we still don't have an operator find the proper Operator to use by it's field type
                if (!operator) {
                    operator = mapOperatorByFieldType(columnDef.type || FieldType.string);
                }
                // extra query arguments
                if (bypassOdataQuery) {
                    // push to our temp array and also trim white spaces
                    if (fieldName) {
                        this_1.saveColumnFilter(fieldName, fieldSearchValue, searchTerms);
                    }
                }
                else {
                    searchBy = '';
                    // titleCase the fieldName so that it matches the WebApi names
                    if (this_1._odataService.options.caseType === CaseType.pascalCase) {
                        fieldName = titleCase(fieldName || '');
                    }
                    if (fieldType === FieldType.date) {
                        searchBy = this_1.filterBySearchDate(fieldName, operator, searchTerms, odataVersion);
                    }
                    else if (searchTerms && searchTerms.length > 1 && (operator === 'IN' || operator === 'NIN' || operator === 'NOTIN' || operator === 'NOT IN' || operator === 'NOT_IN')) {
                        // when having more than 1 search term (then check if we have a "IN" or "NOT IN" filter search)
                        var tmpSearchTerms = [];
                        if (operator === 'IN') {
                            // example:: (Stage eq "Expired" or Stage eq "Renewal")
                            for (var j = 0, lnj = searchTerms.length; j < lnj; j++) {
                                if (fieldType === FieldType.string) {
                                    var searchVal = searchTerms[j].replace("'", "''");
                                    tmpSearchTerms.push(fieldName + " eq '" + searchVal + "'");
                                }
                                else {
                                    // Single quote escape is not needed for non string type
                                    tmpSearchTerms.push(fieldName + " eq " + searchTerms[j]);
                                }
                            }
                            searchBy = tmpSearchTerms.join(' or ');
                            if (!(typeof searchBy === 'string' && searchBy[0] === '(' && searchBy.slice(-1) === ')')) {
                                searchBy = "(" + searchBy + ")";
                            }
                        }
                        else {
                            // example:: (Stage ne "Expired" and Stage ne "Renewal")
                            for (var k = 0, lnk = searchTerms.length; k < lnk; k++) {
                                var searchVal = searchTerms[k].replace("'", "''");
                                tmpSearchTerms.push(fieldName + " ne '" + searchVal + "'");
                            }
                            searchBy = tmpSearchTerms.join(' and ');
                            if (!(typeof searchBy === 'string' && searchBy[0] === '(' && searchBy.slice(-1) === ')')) {
                                searchBy = "(" + searchBy + ")";
                            }
                        }
                    }
                    else if (operator === '*' || operator === 'a*' || operator === '*z' || lastValueChar === '*') {
                        // first/last character is a '*' will be a startsWith or endsWith
                        searchBy = (operator === '*' || operator === '*z') ? "endswith(" + fieldName + ", '" + searchValue + "')" : "startswith(" + fieldName + ", '" + searchValue + "')";
                    }
                    else if (fieldType === FieldType.string) {
                        // string field needs to be in single quotes
                        if (operator === '' || operator === OperatorType.contains || operator === OperatorType.notContains) {
                            searchBy = this_1.odataQueryVersionWrapper('substring', odataVersion, fieldName, searchValue);
                            if (operator === OperatorType.notContains) {
                                searchBy = "not " + searchBy;
                            }
                        }
                        else if (operator === OperatorType.rangeExclusive || operator === OperatorType.rangeInclusive) {
                            // example:: (Duration >= 5 and Duration <= 10)
                            searchBy = this_1.filterBySearchTermRange(fieldName, operator, searchTerms);
                        }
                        else {
                            searchBy = fieldName + " " + this_1.mapOdataOperator(operator) + " '" + searchValue + "'";
                        }
                    }
                    else {
                        if (operator === OperatorType.rangeExclusive || operator === OperatorType.rangeInclusive) {
                            // example:: (Duration >= 5 and Duration <= 10)
                            searchBy = this_1.filterBySearchTermRange(fieldName, operator, searchTerms);
                        }
                        else {
                            // any other field type (or undefined type)
                            searchValue = (fieldType === FieldType.number || fieldType === FieldType.boolean) ? searchValue : "'" + searchValue + "'";
                            searchBy = fieldName + " " + this_1.mapOdataOperator(operator) + " " + searchValue;
                        }
                    }
                    // push to our temp array and also trim white spaces
                    if (searchBy !== '') {
                        searchByArray.push(searchBy.trim());
                        this_1.saveColumnFilter(fieldName || '', fieldSearchValue, searchValue);
                    }
                }
            }
        };
        var this_1 = this;
        // loop through all columns to inspect filters
        for (var columnId in columnFilters) {
            _loop_1(columnId);
        }
        // update the service options with filters for the buildQuery() to work later
        this._odataService.updateOptions({
            filter: (searchByArray.length > 0) ? searchByArray.join(' and ') : '',
            skip: undefined
        });
    };
    /**
     * Update the pagination component with it's new page number and size
     * @param newPage
     * @param pageSize
     */
    GridOdataService.prototype.updatePagination = function (newPage, pageSize) {
        this._currentPagination = {
            pageNumber: newPage,
            pageSize: pageSize,
        };
        // unless user specifically set "enablePagination" to False, we'll update pagination options in every other cases
        if (this._gridOptions && (this._gridOptions.enablePagination || !this._gridOptions.hasOwnProperty('enablePagination'))) {
            this._odataService.updateOptions({
                top: pageSize,
                skip: (newPage - 1) * pageSize
            });
        }
    };
    /**
     * loop through all columns to inspect sorters & update backend service orderBy
     * @param columnFilters
     */
    GridOdataService.prototype.updateSorters = function (sortColumns, presetSorters) {
        var _this = this;
        var e_1, _a;
        var currentSorters = [];
        var odataSorters = [];
        if (!sortColumns && presetSorters) {
            // make the presets the current sorters, also make sure that all direction are in lowercase for OData
            currentSorters = presetSorters;
            currentSorters.forEach(function (sorter) { return sorter.direction = sorter.direction.toLowerCase(); });
            // display the correct sorting icons on the UI, for that it requires (columnId, sortAsc) properties
            var tmpSorterArray = currentSorters.map(function (sorter) {
                var columnDef = _this._columnDefinitions.find(function (column) { return column.id === sorter.columnId; });
                odataSorters.push({
                    field: columnDef ? ((columnDef.queryFieldSorter || columnDef.queryField || columnDef.field) + '') : (sorter.columnId + ''),
                    direction: sorter.direction
                });
                // return only the column(s) found in the Column Definitions ELSE null
                if (columnDef) {
                    return {
                        columnId: sorter.columnId,
                        sortAsc: sorter.direction.toUpperCase() === SortDirection.ASC
                    };
                }
                return null;
            });
            // set the sort icons, but also make sure to filter out null values (that happens when columnDef is not found)
            if (Array.isArray(tmpSorterArray)) {
                this._grid.setSortColumns(tmpSorterArray);
            }
        }
        else if (sortColumns && !presetSorters) {
            // build the SortBy string, it could be multisort, example: customerNo asc, purchaserName desc
            if (sortColumns && sortColumns.length === 0) {
                // TODO fix this line
                // currentSorters = new Array(this.defaultOptions.orderBy); // when empty, use the default sort
            }
            else {
                if (sortColumns) {
                    try {
                        for (var sortColumns_1 = tslib_1.__values(sortColumns), sortColumns_1_1 = sortColumns_1.next(); !sortColumns_1_1.done; sortColumns_1_1 = sortColumns_1.next()) {
                            var columnDef = sortColumns_1_1.value;
                            if (columnDef.sortCol) {
                                var fieldName = (columnDef.sortCol.queryFieldSorter || columnDef.sortCol.queryField || columnDef.sortCol.field) + '';
                                var columnFieldName = (columnDef.sortCol.field || columnDef.sortCol.id) + '';
                                var queryField = (columnDef.sortCol.queryFieldSorter || columnDef.sortCol.queryField || columnDef.sortCol.field || '') + '';
                                if (this._odataService.options.caseType === CaseType.pascalCase) {
                                    fieldName = titleCase(fieldName);
                                    columnFieldName = titleCase(columnFieldName);
                                    queryField = titleCase(queryField);
                                }
                                if (columnFieldName !== '') {
                                    currentSorters.push({
                                        columnId: columnFieldName,
                                        direction: columnDef.sortAsc ? 'asc' : 'desc'
                                    });
                                }
                                if (queryField !== '') {
                                    odataSorters.push({
                                        field: queryField,
                                        direction: columnDef.sortAsc ? SortDirection.ASC : SortDirection.DESC
                                    });
                                }
                            }
                        }
                    }
                    catch (e_1_1) { e_1 = { error: e_1_1 }; }
                    finally {
                        try {
                            if (sortColumns_1_1 && !sortColumns_1_1.done && (_a = sortColumns_1.return)) _a.call(sortColumns_1);
                        }
                        finally { if (e_1) throw e_1.error; }
                    }
                }
            }
        }
        // transform the sortby array into a CSV string for OData
        currentSorters = currentSorters || [];
        var csvString = odataSorters.map(function (sorter) {
            var str = '';
            if (sorter && sorter.field) {
                var sortField = (_this._odataService.options.caseType === CaseType.pascalCase) ? titleCase(sorter.field) : sorter.field;
                str = sortField + " " + (sorter && sorter.direction && sorter.direction.toLowerCase() || '');
            }
            return str;
        }).join(',');
        this._odataService.updateOptions({
            orderBy: csvString
        });
        // keep current Sorters and update the service options with the new sorting
        this._currentSorters = currentSorters;
        // build the OData query which we will use in the WebAPI callback
        return this._odataService.buildQuery();
    };
    //
    // private functions
    // -------------------
    /**
     * Cast provided filters (could be in multiple format) into an array of ColumnFilter
     * @param columnFilters
     */
    GridOdataService.prototype.castFilterToColumnFilters = function (columnFilters) {
        // keep current filters & always save it as an array (columnFilters can be an object when it is dealt by SlickGrid Filter)
        var filtersArray = (typeof columnFilters === 'object') ? Object.keys(columnFilters).map(function (key) { return columnFilters[key]; }) : columnFilters;
        if (!Array.isArray(filtersArray)) {
            return [];
        }
        return filtersArray.map(function (filter) {
            var tmpFilter = { columnId: filter.columnId || '' };
            if (filter.operator) {
                tmpFilter.operator = filter.operator;
            }
            if (Array.isArray(filter.searchTerms)) {
                tmpFilter.searchTerms = filter.searchTerms;
            }
            return tmpFilter;
        });
    };
    GridOdataService.prototype.odataQueryVersionWrapper = function (queryType, version, fieldName, searchValue) {
        var query = '';
        switch (queryType) {
            case 'dateTime':
                query = version >= 4 ? searchValue : "DateTime'" + searchValue + "'";
                break;
            case 'substring':
                query = version >= 4 ? "contains(" + fieldName + ", '" + searchValue + "')" : "substringof('" + searchValue + "', " + fieldName + ")";
                break;
        }
        return query;
    };
    /**
     * Filter by a search date, the searchTerms might be a single value or range of dates (2 searchTerms OR 1 string separated by 2 dots "date1..date2")
     * Also depending on the OData version number, the output will be different, previous version must wrap dates with DateTime
     * - version 2-3:: Finish gt DateTime'2019-08-12T00:00:00Z'
     * - version 4:: Finish gt 2019-08-12T00:00:00Z
     */
    GridOdataService.prototype.filterBySearchDate = function (fieldName, operator, searchTerms, version) {
        var query = '';
        var searchValues;
        if (Array.isArray(searchTerms) && searchTerms.length > 1) {
            searchValues = searchTerms;
            if (operator !== OperatorType.rangeExclusive && operator !== OperatorType.rangeInclusive) {
                operator = this._gridOptions.defaultFilterRangeOperator;
            }
        }
        // single search value
        if (!Array.isArray(searchValues) && Array.isArray(searchTerms) && searchTerms.length === 1 && searchTerms[0]) {
            var searchValue1 = this.odataQueryVersionWrapper('dateTime', version, fieldName, parseUtcDate(searchTerms[0], true));
            if (searchValue1) {
                return fieldName + " " + this.mapOdataOperator(operator) + " " + searchValue1;
            }
        }
        // multiple search value (date range)
        if (Array.isArray(searchValues) && searchValues.length === 2 && searchValues[0] && searchValues[1]) {
            // date field needs to be UTC and within DateTime function
            var searchValue1 = this.odataQueryVersionWrapper('dateTime', version, fieldName, parseUtcDate(searchValues[0], true));
            var searchValue2 = this.odataQueryVersionWrapper('dateTime', version, fieldName, parseUtcDate(searchValues[1], true));
            if (searchValue1 && searchValue2) {
                if (operator === OperatorType.rangeInclusive) {
                    // example:: (Finish >= DateTime'2019-08-11T00:00:00Z' and Finish <= DateTime'2019-09-12T00:00:00Z')
                    query = "(" + fieldName + " ge " + searchValue1 + " and " + fieldName + " le " + searchValue2 + ")";
                }
                else if (operator === OperatorType.rangeExclusive) {
                    // example:: (Finish > DateTime'2019-08-11T00:00:00Z' and Finish < DateTime'2019-09-12T00:00:00Z')
                    query = "(" + fieldName + " gt " + searchValue1 + " and " + fieldName + " lt " + searchValue2 + ")";
                }
            }
        }
        return query;
    };
    /**
     * Filter by a range of searchTerms (2 searchTerms OR 1 string separated by 2 dots "value1..value2")
     */
    GridOdataService.prototype.filterBySearchTermRange = function (fieldName, operator, searchTerms) {
        var query = '';
        if (Array.isArray(searchTerms) && searchTerms.length === 2) {
            if (operator === OperatorType.rangeInclusive) {
                // example:: (Duration >= 5 and Duration <= 10)
                query = "(" + fieldName + " ge " + searchTerms[0] + " and " + fieldName + " le " + searchTerms[1] + ")";
            }
            else if (operator === OperatorType.rangeExclusive) {
                // example:: (Duration > 5 and Duration < 10)
                query = "(" + fieldName + " gt " + searchTerms[0] + " and " + fieldName + " lt " + searchTerms[1] + ")";
            }
        }
        return query;
    };
    GridOdataService = tslib_1.__decorate([
        Injectable(),
        tslib_1.__metadata("design:paramtypes", [])
    ], GridOdataService);
    return GridOdataService;
}());
export { GridOdataService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC1vZGF0YS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci1zbGlja2dyaWQvIiwic291cmNlcyI6WyJhcHAvbW9kdWxlcy9hbmd1bGFyLXNsaWNrZ3JpZC9zZXJ2aWNlcy9ncmlkLW9kYXRhLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFlBQVksRUFBRSxzQkFBc0IsRUFBRSxTQUFTLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDOUUsT0FBTyxFQUVMLFFBQVEsRUFTUixTQUFTLEVBTVQsYUFBYSxFQUViLFlBQVksRUFJYixNQUFNLG1CQUFtQixDQUFDO0FBQzNCLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBRXZFLElBQU0sc0JBQXNCLEdBQUcsRUFBRSxDQUFDO0FBQ2xDLElBQU0saUJBQWlCLEdBQUcsRUFBRSxDQUFDO0FBRzdCO0lBOEJFO1FBN0JRLG9CQUFlLEdBQW9CLEVBQUUsQ0FBQztRQUV0QyxvQkFBZSxHQUFvQixFQUFFLENBQUM7UUFNOUMsbUJBQWMsR0FBZ0I7WUFDNUIsR0FBRyxFQUFFLHNCQUFzQjtZQUMzQixPQUFPLEVBQUUsRUFBRTtZQUNYLFFBQVEsRUFBRSxRQUFRLENBQUMsVUFBVTtTQUM5QixDQUFDO1FBa0JBLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSx3QkFBd0IsRUFBRSxDQUFDO0lBQ3RELENBQUM7SUFoQkQsc0JBQUksK0NBQWlCO1FBRHJCLHdDQUF3QzthQUN4QztZQUNFLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDO1FBQ2pDLENBQUM7OztPQUFBO0lBR0Qsc0JBQUksMENBQVk7UUFEaEIsbUNBQW1DO2FBQ25DO1lBQ0UsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDO1FBQzVCLENBQUM7OztPQUFBO0lBR0Qsc0JBQVksMENBQVk7UUFEeEIsaUVBQWlF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WUFBWSxNQUFHLENBQUM7aUJBQ2pGO3FCQUFNLElBQUksUUFBUSxLQUFLLFlBQVksQ0FBQyxjQUFjLEVBQUU7b0JBQ25ELGtHQUFrRztvQkFDbEcsS0FBSyxHQUFHLE1BQUksU0FBUyxZQUFPLFlBQVksYUFBUSxTQUFTLFlBQU8sWUFBWSxNQUFHLENBQUM7aUJBQ2pGO2FBQ0Y7U0FDRjtRQUNELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQUVEOztPQUVHO0lBQ0ssa0RBQXVCLEdBQS9CLFVBQWdDLFNBQWlCLEVBQUUsUUFBdUMsRUFBRSxXQUF5QjtRQUNuSCxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7UUFFZixJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLElBQUksV0FBVyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDMUQsSUFBSSxRQUFRLEtBQUssWUFBWSxDQUFDLGNBQWMsRUFBRTtnQkFDNUMsK0NBQStDO2dCQUMvQyxLQUFLLEdBQUcsTUFBSSxTQUFTLFlBQU8sV0FBVyxDQUFDLENBQUMsQ0FBQyxhQUFRLFNBQVMsWUFBTyxXQUFXLENBQUMsQ0FBQyxDQUFDLE1BQUcsQ0FBQzthQUNyRjtpQkFBTSxJQUFJLFFBQVEsS0FBSyxZQUFZLENBQUMsY0FBYyxFQUFFO2dCQUNuRCw2Q0FBNkM7Z0JBQzdDLEtBQUssR0FBRyxNQUFJLFNBQVMsWUFBTyxXQUFXLENBQUMsQ0FBQyxDQUFDLGFBQVEsU0FBUyxZQUFPLFdBQVcsQ0FBQyxDQUFDLENBQUMsTUFBRyxDQUFDO2FBQ3JGO1NBQ0Y7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFqa0JVLGdCQUFnQjtRQUQ1QixVQUFVLEVBQUU7O09BQ0EsZ0JBQWdCLENBa2tCNUI7SUFBRCx1QkFBQztDQUFBLEFBbGtCRCxJQWtrQkM7U0Fsa0JZLGdCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IHBhcnNlVXRjRGF0ZSwgbWFwT3BlcmF0b3JCeUZpZWxkVHlwZSwgdGl0bGVDYXNlIH0gZnJvbSAnLi91dGlsaXRpZXMnO1xuaW1wb3J0IHtcbiAgQmFja2VuZFNlcnZpY2UsXG4gIENhc2VUeXBlLFxuICBDb2x1bW4sXG4gIENvbHVtbkZpbHRlcixcbiAgQ29sdW1uRmlsdGVycyxcbiAgQ29sdW1uU29ydCxcbiAgQ3VycmVudEZpbHRlcixcbiAgQ3VycmVudFBhZ2luYXRpb24sXG4gIEN1cnJlbnRTb3J0ZXIsXG4gIEZpbHRlckNoYW5nZWRBcmdzLFxuICBGaWVsZFR5cGUsXG4gIEdyaWRPcHRpb24sXG4gIE9kYXRhT3B0aW9uLFxuICBQYWdpbmF0aW9uLFxuICBQYWdpbmF0aW9uQ2hhbmdlZEFyZ3MsXG4gIFNvcnRDaGFuZ2VkQXJncyxcbiAgU29ydERpcmVjdGlvbixcbiAgU29ydERpcmVjdGlvblN0cmluZyxcbiAgT3BlcmF0b3JUeXBlLFxuICBPZGF0YVNvcnRpbmdPcHRpb24sXG4gIE9wZXJhdG9yU3RyaW5nLFxuICBTZWFyY2hUZXJtXG59IGZyb20gJy4vLi4vbW9kZWxzL2luZGV4JztcbmltcG9ydCB7IE9kYXRhUXVlcnlCdWlsZGVyU2VydmljZSB9IGZyb20gJy4vb2RhdGFRdWVyeUJ1aWxkZXIuc2VydmljZSc7XG5cbmNvbnN0IERFRkFVTFRfSVRFTVNfUEVSX1BBR0UgPSAyNTtcbmNvbnN0IERFRkFVTFRfUEFHRV9TSVpFID0gMjA7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBHcmlkT2RhdGFTZXJ2aWNlIGltcGxlbWVudHMgQmFja2VuZFNlcnZpY2Uge1xuICBwcml2YXRlIF9jdXJyZW50RmlsdGVyczogQ3VycmVudEZpbHRlcltdID0gW107XG4gIHByaXZhdGUgX2N1cnJlbnRQYWdpbmF0aW9uOiBDdXJyZW50UGFnaW5hdGlvbjtcbiAgcHJpdmF0ZSBfY3VycmVudFNvcnRlcnM6IEN1cnJlbnRTb3J0ZXJbXSA9IFtdO1xuICBwcml2YXRlIF9jb2x1bW5EZWZpbml0aW9uczogQ29sdW1uW107XG4gIHByaXZhdGUgX2dyaWQ6IGFueTtcbiAgcHJpdmF0ZSBfb2RhdGFTZXJ2aWNlOiBPZGF0YVF1ZXJ5QnVpbGRlclNlcnZpY2U7XG4gIG9wdGlvbnM6IFBhcnRpYWw8T2RhdGFPcHRpb24+O1xuICBwYWdpbmF0aW9uOiBQYWdpbmF0aW9uIHwgdW5kZWZpbmVkO1xuICBkZWZhdWx0T3B0aW9uczogT2RhdGFPcHRpb24gPSB7XG4gICAgdG9wOiBERUZBVUxUX0lURU1TX1BFUl9QQUdFLFxuICAgIG9yZGVyQnk6ICcnLFxuICAgIGNhc2VUeXBlOiBDYXNlVHlwZS5wYXNjYWxDYXNlXG4gIH07XG5cbiAgLyoqIEdldHRlciBmb3IgdGhlIENvbHVtbiBEZWZpbml0aW9ucyAqL1xuICBnZXQgY29sdW1uRGVmaW5pdGlvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbHVtbkRlZmluaXRpb25zO1xuICB9XG5cbiAgLyoqIEdldHRlciBmb3IgdGhlIE9kYXRhIFNlcnZpY2UgKi9cbiAgZ2V0IG9kYXRhU2VydmljZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fb2RhdGFTZXJ2aWNlO1xuICB9XG5cbiAgLyoqIEdldHRlciBmb3IgdGhlIEdyaWQgT3B0aW9ucyBwdWxsZWQgdGhyb3VnaCB0aGUgR3JpZCBPYmplY3QgKi9cbiAgcHJpdmF0ZSBnZXQgX2dyaWRPcHRpb25zKCk6IEdyaWRPcHRpb24ge1xuICAgIHJldHVybiAodGhpcy5fZ3JpZCAmJiB0aGlzLl9ncmlkLmdldE9wdGlvbnMpID8gdGhpcy5fZ3JpZC5nZXRPcHRpb25zKCkgOiB7fTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuX29kYXRhU2VydmljZSA9IG5ldyBPZGF0YVF1ZXJ5QnVpbGRlclNlcnZpY2UoKTtcbiAgfVxuXG4gIGluaXQoc2VydmljZU9wdGlvbnM6IFBhcnRpYWw8T2RhdGFPcHRpb24+LCBwYWdpbmF0aW9uPzogUGFnaW5hdGlvbiwgZ3JpZD86IGFueSk6IHZvaWQge1xuICAgIHRoaXMuX2dyaWQgPSBncmlkO1xuICAgIGNvbnN0IG1lcmdlZE9wdGlvbnMgPSB7IC4uLnRoaXMuZGVmYXVsdE9wdGlvbnMsIC4uLnNlcnZpY2VPcHRpb25zIH07XG5cbiAgICAvLyB1bmxlc3MgdXNlciBzcGVjaWZpY2FsbHkgc2V0IFwiZW5hYmxlUGFnaW5hdGlvblwiIHRvIEZhbHNlLCB3ZSdsbCBhZGQgXCJ0b3BcIiBwcm9wZXJ0eSBmb3IgdGhlIHBhZ2luYXRpb24gaW4gZXZlcnkgb3RoZXIgY2FzZXNcbiAgICBpZiAodGhpcy5fZ3JpZE9wdGlvbnMgJiYgIXRoaXMuX2dyaWRPcHRpb25zLmVuYWJsZVBhZ2luYXRpb24pIHtcbiAgICAgIC8vIHNhdmUgY3VycmVudCBwYWdpbmF0aW9uIGFzIFBhZ2UgMSBhbmQgcGFnZSBzaXplIGFzIFwidG9wXCJcbiAgICAgIHRoaXMuX29kYXRhU2VydmljZS5vcHRpb25zID0geyAuLi5tZXJnZWRPcHRpb25zLCB0b3A6IG51bGwgfTtcbiAgICAgIHRoaXMuX2N1cnJlbnRQYWdpbmF0aW9uID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgdG9wT3B0aW9uID0gKHBhZ2luYXRpb24gJiYgcGFnaW5hdGlvbi5wYWdlU2l6ZSkgPyBwYWdpbmF0aW9uLnBhZ2VTaXplIDogdGhpcy5kZWZhdWx0T3B0aW9ucy50b3A7XG4gICAgICB0aGlzLl9vZGF0YVNlcnZpY2Uub3B0aW9ucyA9IHsgLi4ubWVyZ2VkT3B0aW9ucywgdG9wOiB0b3BPcHRpb24gfTtcbiAgICAgIHRoaXMuX2N1cnJlbnRQYWdpbmF0aW9uID0ge1xuICAgICAgICBwYWdlTnVtYmVyOiAxLFxuICAgICAgICBwYWdlU2l6ZTogdGhpcy5fb2RhdGFTZXJ2aWNlLm9wdGlvbnMudG9wIHx8IHRoaXMuZGVmYXVsdE9wdGlvbnMudG9wIHx8IERFRkFVTFRfUEFHRV9TSVpFLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICB0aGlzLm9wdGlvbnMgPSB0aGlzLl9vZGF0YVNlcnZpY2Uub3B0aW9ucztcbiAgICB0aGlzLnBhZ2luYXRpb24gPSBwYWdpbmF0aW9uO1xuXG4gICAgaWYgKGdyaWQgJiYgZ3JpZC5nZXRDb2x1bW5zKSB7XG4gICAgICB0aGlzLl9jb2x1bW5EZWZpbml0aW9ucyA9IHNlcnZpY2VPcHRpb25zICYmIHNlcnZpY2VPcHRpb25zLmNvbHVtbkRlZmluaXRpb25zIHx8IGdyaWQuZ2V0Q29sdW1ucygpO1xuICAgICAgdGhpcy5fY29sdW1uRGVmaW5pdGlvbnMgPSB0aGlzLl9jb2x1bW5EZWZpbml0aW9ucy5maWx0ZXIoKGNvbHVtbjogQ29sdW1uKSA9PiAhY29sdW1uLmV4Y2x1ZGVGcm9tUXVlcnkpO1xuICAgIH1cbiAgfVxuXG4gIGJ1aWxkUXVlcnkoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5fb2RhdGFTZXJ2aWNlLmJ1aWxkUXVlcnkoKTtcbiAgfVxuXG4gIGNsZWFyRmlsdGVycygpIHtcbiAgICB0aGlzLl9jdXJyZW50RmlsdGVycyA9IFtdO1xuICAgIHRoaXMudXBkYXRlRmlsdGVycyhbXSk7XG4gIH1cblxuICBjbGVhclNvcnRlcnMoKSB7XG4gICAgdGhpcy5fY3VycmVudFNvcnRlcnMgPSBbXTtcbiAgICB0aGlzLnVwZGF0ZVNvcnRlcnMoW10pO1xuICB9XG5cbiAgdXBkYXRlT3B0aW9ucyhzZXJ2aWNlT3B0aW9ucz86IFBhcnRpYWw8T2RhdGFPcHRpb24+KSB7XG4gICAgdGhpcy5vcHRpb25zID0geyAuLi50aGlzLm9wdGlvbnMsIC4uLnNlcnZpY2VPcHRpb25zIH07XG4gICAgdGhpcy5fb2RhdGFTZXJ2aWNlLm9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG4gIH1cblxuICByZW1vdmVDb2x1bW5GaWx0ZXIoZmllbGROYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLl9vZGF0YVNlcnZpY2UucmVtb3ZlQ29sdW1uRmlsdGVyKGZpZWxkTmFtZSk7XG4gIH1cblxuICAvKiogR2V0IHRoZSBGaWx0ZXJzIHRoYXQgYXJlIGN1cnJlbnRseSB1c2VkIGJ5IHRoZSBncmlkICovXG4gIGdldEN1cnJlbnRGaWx0ZXJzKCk6IEN1cnJlbnRGaWx0ZXJbXSB7XG4gICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRGaWx0ZXJzO1xuICB9XG5cbiAgLyoqIEdldCB0aGUgUGFnaW5hdGlvbiB0aGF0IGlzIGN1cnJlbnRseSB1c2VkIGJ5IHRoZSBncmlkICovXG4gIGdldEN1cnJlbnRQYWdpbmF0aW9uKCk6IEN1cnJlbnRQYWdpbmF0aW9uIHtcbiAgICByZXR1cm4gdGhpcy5fY3VycmVudFBhZ2luYXRpb247XG4gIH1cblxuICAvKiogR2V0IHRoZSBTb3J0ZXJzIHRoYXQgYXJlIGN1cnJlbnRseSB1c2VkIGJ5IHRoZSBncmlkICovXG4gIGdldEN1cnJlbnRTb3J0ZXJzKCk6IEN1cnJlbnRTb3J0ZXJbXSB7XG4gICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRTb3J0ZXJzO1xuICB9XG5cbiAgLyoqXG4gICAqIE1hcHBlciBmb3IgbWF0aGVtYXRpY2FsIG9wZXJhdG9ycyAoZXguOiA8PSBpcyBcImxlXCIsID4gaXMgXCJndFwiKVxuICAgKiBAcGFyYW0gc3RyaW5nIG9wZXJhdG9yXG4gICAqIEByZXR1cm5zIHN0cmluZyBtYXBcbiAgICovXG4gIG1hcE9kYXRhT3BlcmF0b3Iob3BlcmF0b3I6IHN0cmluZykge1xuICAgIGxldCBtYXAgPSAnJztcbiAgICBzd2l0Y2ggKG9wZXJhdG9yKSB7XG4gICAgICBjYXNlICc8JzpcbiAgICAgICAgbWFwID0gJ2x0JztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICc8PSc6XG4gICAgICAgIG1hcCA9ICdsZSc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnPic6XG4gICAgICAgIG1hcCA9ICdndCc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnPj0nOlxuICAgICAgICBtYXAgPSAnZ2UnO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJzw+JzpcbiAgICAgIGNhc2UgJyE9JzpcbiAgICAgICAgbWFwID0gJ25lJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICc9JzpcbiAgICAgIGNhc2UgJz09JzpcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG1hcCA9ICdlcSc7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHJldHVybiBtYXA7XG4gIH1cblxuICAvKlxuICAgKiBSZXNldCB0aGUgcGFnaW5hdGlvbiBvcHRpb25zXG4gICAqL1xuICByZXNldFBhZ2luYXRpb25PcHRpb25zKCkge1xuICAgIHRoaXMuX29kYXRhU2VydmljZS51cGRhdGVPcHRpb25zKHtcbiAgICAgIHNraXA6IDBcbiAgICB9KTtcbiAgfVxuXG4gIHNhdmVDb2x1bW5GaWx0ZXIoZmllbGROYW1lOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcsIHRlcm1zPzogYW55W10pIHtcbiAgICB0aGlzLl9vZGF0YVNlcnZpY2Uuc2F2ZUNvbHVtbkZpbHRlcihmaWVsZE5hbWUsIHZhbHVlLCB0ZXJtcyk7XG4gIH1cblxuICAvKlxuICAgKiBGSUxURVJJTkdcbiAgICovXG4gIHByb2Nlc3NPbkZpbHRlckNoYW5nZWQoZXZlbnQ6IEV2ZW50LCBhcmdzOiBGaWx0ZXJDaGFuZ2VkQXJncyk6IHN0cmluZyB7XG4gICAgY29uc3QgZ3JpZE9wdGlvbnM6IEdyaWRPcHRpb24gPSB0aGlzLl9ncmlkT3B0aW9ucztcbiAgICBjb25zdCBiYWNrZW5kQXBpID0gZ3JpZE9wdGlvbnMuYmFja2VuZFNlcnZpY2VBcGk7XG5cbiAgICBpZiAoYmFja2VuZEFwaSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NvbWV0aGluZyB3ZW50IHdyb25nIGluIHRoZSBHcmlkT2RhdGFTZXJ2aWNlLCBcImJhY2tlbmRTZXJ2aWNlQXBpXCIgaXMgbm90IGluaXRpYWxpemVkJyk7XG4gICAgfVxuXG4gICAgLy8ga2VlcCBjdXJyZW50IGZpbHRlcnMgJiBhbHdheXMgc2F2ZSBpdCBhcyBhbiBhcnJheSAoY29sdW1uRmlsdGVycyBjYW4gYmUgYW4gb2JqZWN0IHdoZW4gaXQgaXMgZGVhbHQgYnkgU2xpY2tHcmlkIEZpbHRlcilcbiAgICB0aGlzLl9jdXJyZW50RmlsdGVycyA9IHRoaXMuY2FzdEZpbHRlclRvQ29sdW1uRmlsdGVycyhhcmdzLmNvbHVtbkZpbHRlcnMpO1xuXG4gICAgaWYgKCFhcmdzIHx8ICFhcmdzLmdyaWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU29tZXRoaW5nIHdlbnQgd3Jvbmcgd2hlbiB0cnlpbmcgY3JlYXRlIHRoZSBHcmlkT2RhdGFTZXJ2aWNlLCBpdCBzZWVtcyB0aGF0IFwiYXJnc1wiIGlzIG5vdCBwb3B1bGF0ZWQgY29ycmVjdGx5Jyk7XG4gICAgfVxuXG4gICAgLy8gbG9vcCB0aHJvdWdoIGFsbCBjb2x1bW5zIHRvIGluc3BlY3QgZmlsdGVycyAmIHNldCB0aGUgcXVlcnlcbiAgICB0aGlzLnVwZGF0ZUZpbHRlcnMoYXJncy5jb2x1bW5GaWx0ZXJzKTtcblxuICAgIHRoaXMucmVzZXRQYWdpbmF0aW9uT3B0aW9ucygpO1xuICAgIHJldHVybiB0aGlzLl9vZGF0YVNlcnZpY2UuYnVpbGRRdWVyeSgpO1xuICB9XG5cbiAgLypcbiAgICogUEFHSU5BVElPTlxuICAgKi9cbiAgcHJvY2Vzc09uUGFnaW5hdGlvbkNoYW5nZWQoZXZlbnQ6IEV2ZW50LCBhcmdzOiBQYWdpbmF0aW9uQ2hhbmdlZEFyZ3MpIHtcbiAgICBjb25zdCBwYWdlU2l6ZSA9ICsoYXJncy5wYWdlU2l6ZSB8fCAoKHRoaXMucGFnaW5hdGlvbikgPyB0aGlzLnBhZ2luYXRpb24ucGFnZVNpemUgOiBERUZBVUxUX1BBR0VfU0laRSkpO1xuICAgIHRoaXMudXBkYXRlUGFnaW5hdGlvbihhcmdzLm5ld1BhZ2UsIHBhZ2VTaXplKTtcblxuICAgIC8vIGJ1aWxkIHRoZSBPRGF0YSBxdWVyeSB3aGljaCB3ZSB3aWxsIHVzZSBpbiB0aGUgV2ViQVBJIGNhbGxiYWNrXG4gICAgcmV0dXJuIHRoaXMuX29kYXRhU2VydmljZS5idWlsZFF1ZXJ5KCk7XG4gIH1cblxuICAvKlxuICAgKiBTT1JUSU5HXG4gICAqL1xuICBwcm9jZXNzT25Tb3J0Q2hhbmdlZChldmVudDogRXZlbnQsIGFyZ3M6IFNvcnRDaGFuZ2VkQXJncykge1xuICAgIGNvbnN0IHNvcnRDb2x1bW5zID0gKGFyZ3MubXVsdGlDb2x1bW5Tb3J0KSA/IGFyZ3Muc29ydENvbHMgOiBuZXcgQXJyYXkoeyBzb3J0Q29sOiBhcmdzLnNvcnRDb2wsIHNvcnRBc2M6IGFyZ3Muc29ydEFzYyB9KTtcblxuICAgIC8vIGxvb3AgdGhyb3VnaCBhbGwgY29sdW1ucyB0byBpbnNwZWN0IHNvcnRlcnMgJiBzZXQgdGhlIHF1ZXJ5XG4gICAgdGhpcy51cGRhdGVTb3J0ZXJzKHNvcnRDb2x1bW5zKTtcblxuICAgIC8vIGJ1aWxkIHRoZSBPRGF0YSBxdWVyeSB3aGljaCB3ZSB3aWxsIHVzZSBpbiB0aGUgV2ViQVBJIGNhbGxiYWNrXG4gICAgcmV0dXJuIHRoaXMuX29kYXRhU2VydmljZS5idWlsZFF1ZXJ5KCk7XG4gIH1cblxuICAvKipcbiAgICogbG9vcCB0aHJvdWdoIGFsbCBjb2x1bW5zIHRvIGluc3BlY3QgZmlsdGVycyAmIHVwZGF0ZSBiYWNrZW5kIHNlcnZpY2UgZmlsdGVyc1xuICAgKiBAcGFyYW0gY29sdW1uRmlsdGVyc1xuICAgKi9cbiAgdXBkYXRlRmlsdGVycyhjb2x1bW5GaWx0ZXJzOiBDb2x1bW5GaWx0ZXJzIHwgQ3VycmVudEZpbHRlcltdLCBpc1VwZGF0ZWRCeVByZXNldE9yRHluYW1pY2FsbHk/OiBib29sZWFuKSB7XG4gICAgbGV0IHNlYXJjaEJ5ID0gJyc7XG4gICAgY29uc3Qgc2VhcmNoQnlBcnJheTogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCBvZGF0YVZlcnNpb24gPSB0aGlzLl9vZGF0YVNlcnZpY2UgJiYgdGhpcy5fb2RhdGFTZXJ2aWNlLm9wdGlvbnMgJiYgdGhpcy5fb2RhdGFTZXJ2aWNlLm9wdGlvbnMudmVyc2lvbiB8fCAyO1xuXG4gICAgLy8gb24gZmlsdGVyIHByZXNldCBsb2FkLCB3ZSBuZWVkIHRvIGtlZXAgY3VycmVudCBmaWx0ZXJzXG4gICAgaWYgKGlzVXBkYXRlZEJ5UHJlc2V0T3JEeW5hbWljYWxseSkge1xuICAgICAgdGhpcy5fY3VycmVudEZpbHRlcnMgPSB0aGlzLmNhc3RGaWx0ZXJUb0NvbHVtbkZpbHRlcnMoY29sdW1uRmlsdGVycyk7XG4gICAgfVxuXG4gICAgLy8gbG9vcCB0aHJvdWdoIGFsbCBjb2x1bW5zIHRvIGluc3BlY3QgZmlsdGVyc1xuICAgIGZvciAoY29uc3QgY29sdW1uSWQgaW4gY29sdW1uRmlsdGVycykge1xuICAgICAgaWYgKGNvbHVtbkZpbHRlcnMuaGFzT3duUHJvcGVydHkoY29sdW1uSWQpKSB7XG4gICAgICAgIGNvbnN0IGNvbHVtbkZpbHRlciA9IGNvbHVtbkZpbHRlcnNbY29sdW1uSWRdO1xuXG4gICAgICAgIC8vIGlmIHVzZXIgZGVmaW5lZCBzb21lIFwicHJlc2V0c1wiLCB0aGVuIHdlIG5lZWQgdG8gZmluZCB0aGUgZmlsdGVycyBmcm9tIHRoZSBjb2x1bW4gZGVmaW5pdGlvbnMgaW5zdGVhZFxuICAgICAgICBsZXQgY29sdW1uRGVmOiBDb2x1bW4gfCB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChpc1VwZGF0ZWRCeVByZXNldE9yRHluYW1pY2FsbHkgJiYgQXJyYXkuaXNBcnJheSh0aGlzLl9jb2x1bW5EZWZpbml0aW9ucykpIHtcbiAgICAgICAgICBjb2x1bW5EZWYgPSB0aGlzLl9jb2x1bW5EZWZpbml0aW9ucy5maW5kKChjb2x1bW46IENvbHVtbikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGNvbHVtbi5pZCA9PT0gY29sdW1uRmlsdGVyLmNvbHVtbklkO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbHVtbkRlZiA9IGNvbHVtbkZpbHRlci5jb2x1bW5EZWY7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjb2x1bW5EZWYpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tHcmlkT0RhdGEgU2VydmljZV06IFNvbWV0aGluZyB3ZW50IHdyb25nIGluIHRyeWluZyB0byBnZXQgdGhlIGNvbHVtbiBkZWZpbml0aW9uIG9mIHRoZSBzcGVjaWZpZWQgZmlsdGVyIChvciBwcmVzZXQgZmlsdGVycykuIERpZCB5b3UgbWFrZSBhIHR5cG8gb24gdGhlIGZpbHRlciBjb2x1bW5JZD8nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBmaWVsZE5hbWUgPSBjb2x1bW5EZWYucXVlcnlGaWVsZEZpbHRlciB8fCBjb2x1bW5EZWYucXVlcnlGaWVsZCB8fCBjb2x1bW5EZWYuZmllbGQgfHwgY29sdW1uRGVmLm5hbWUgfHwgJyc7XG4gICAgICAgIGNvbnN0IGZpZWxkVHlwZSA9IGNvbHVtbkRlZi50eXBlIHx8IEZpZWxkVHlwZS5zdHJpbmc7XG4gICAgICAgIGxldCBzZWFyY2hUZXJtcyA9IChjb2x1bW5GaWx0ZXIgPyBjb2x1bW5GaWx0ZXIuc2VhcmNoVGVybXMgOiBudWxsKSB8fCBbXTtcbiAgICAgICAgbGV0IGZpZWxkU2VhcmNoVmFsdWUgPSAoQXJyYXkuaXNBcnJheShzZWFyY2hUZXJtcykgJiYgc2VhcmNoVGVybXMubGVuZ3RoID09PSAxKSA/IHNlYXJjaFRlcm1zWzBdIDogJyc7XG4gICAgICAgIGlmICh0eXBlb2YgZmllbGRTZWFyY2hWYWx1ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICBmaWVsZFNlYXJjaFZhbHVlID0gJyc7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWZpZWxkTmFtZSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgR3JpZE9EYXRhIGZpbHRlciBjb3VsZCBub3QgZmluZCB0aGUgZmllbGQgbmFtZSB0byBxdWVyeSB0aGUgc2VhcmNoLCB5b3VyIGNvbHVtbiBkZWZpbml0aW9uIG11c3QgaW5jbHVkZSBhIHZhbGlkIFwiZmllbGRcIiBvciBcIm5hbWVcIiAob3B0aW9uYWxseSB5b3UgY2FuIGFsc28gdXNlIHRoZSBcInF1ZXJ5ZmllbGRcIiBvciBcInF1ZXJ5RmllbGRGaWx0ZXJcIikuYCk7XG4gICAgICAgIH1cblxuICAgICAgICBmaWVsZFNlYXJjaFZhbHVlID0gJycgKyBmaWVsZFNlYXJjaFZhbHVlOyAvLyBtYWtlIHN1cmUgaXQncyBhIHN0cmluZ1xuICAgICAgICBjb25zdCBtYXRjaGVzID0gZmllbGRTZWFyY2hWYWx1ZS5tYXRjaCgvXihbPD4hPVxcKl17MCwyfSkoLipbXjw+IT1cXCpdKShbXFwqXT8pJC8pOyAvLyBncm91cCAxOiBPcGVyYXRvciwgMjogc2VhcmNoVmFsdWUsIDM6IGxhc3QgY2hhciBpcyAnKicgKG1lYW5pbmcgc3RhcnRzIHdpdGgsIGV4LjogYWJjKilcbiAgICAgICAgbGV0IG9wZXJhdG9yID0gY29sdW1uRmlsdGVyLm9wZXJhdG9yIHx8ICgobWF0Y2hlcykgPyBtYXRjaGVzWzFdIDogJycpO1xuICAgICAgICBsZXQgc2VhcmNoVmFsdWUgPSAoISFtYXRjaGVzKSA/IG1hdGNoZXNbMl0gOiAnJztcbiAgICAgICAgY29uc3QgbGFzdFZhbHVlQ2hhciA9ICghIW1hdGNoZXMpID8gbWF0Y2hlc1szXSA6IChvcGVyYXRvciA9PT0gJyp6JyA/ICcqJyA6ICcnKTtcbiAgICAgICAgY29uc3QgYnlwYXNzT2RhdGFRdWVyeSA9IGNvbHVtbkZpbHRlci5ieXBhc3NCYWNrZW5kUXVlcnkgfHwgZmFsc2U7XG5cbiAgICAgICAgLy8gbm8gbmVlZCB0byBxdWVyeSBpZiBzZWFyY2ggdmFsdWUgaXMgZW1wdHlcbiAgICAgICAgaWYgKGZpZWxkTmFtZSAmJiBzZWFyY2hWYWx1ZSA9PT0gJycgJiYgc2VhcmNoVGVybXMubGVuZ3RoIDw9IDEpIHtcbiAgICAgICAgICB0aGlzLnJlbW92ZUNvbHVtbkZpbHRlcihmaWVsZE5hbWUpO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2VhcmNoVGVybXMpICYmIHNlYXJjaFRlcm1zLmxlbmd0aCA9PT0gMSAmJiB0eXBlb2Ygc2VhcmNoVGVybXNbMF0gPT09ICdzdHJpbmcnICYmIHNlYXJjaFRlcm1zWzBdLmluZGV4T2YoJy4uJykgPiAwKSB7XG4gICAgICAgICAgc2VhcmNoVGVybXMgPSBzZWFyY2hUZXJtc1swXS5zcGxpdCgnLi4nKTtcbiAgICAgICAgICBpZiAoIW9wZXJhdG9yKSB7XG4gICAgICAgICAgICBvcGVyYXRvciA9IE9wZXJhdG9yVHlwZS5yYW5nZUV4Y2x1c2l2ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBlc2NhcGluZyB0aGUgc2VhcmNoIHZhbHVlXG4gICAgICAgIHNlYXJjaFZhbHVlID0gc2VhcmNoVmFsdWUucmVwbGFjZShgJ2AsIGAnJ2ApOyAvLyBlc2NhcGUgc2luZ2xlIHF1b3RlcyBieSBkb3VibGluZyB0aGVtXG4gICAgICAgIHNlYXJjaFZhbHVlID0gZW5jb2RlVVJJQ29tcG9uZW50KHNlYXJjaFZhbHVlKTsgLy8gZW5jb2RlIFVSSSBvZiB0aGUgZmluYWwgc2VhcmNoIHZhbHVlXG5cbiAgICAgICAgLy8gaWYgd2UgZGlkbid0IGZpbmQgYW4gT3BlcmF0b3IgYnV0IHdlIGhhdmUgYSBDb2x1bW4gT3BlcmF0b3IgaW5zaWRlIHRoZSBGaWx0ZXIgKERPTSBFbGVtZW50KSwgd2Ugc2hvdWxkIHVzZSBpdHMgZGVmYXVsdCBPcGVyYXRvclxuICAgICAgICAvLyBtdWx0aXBsZVNlbGVjdCBpcyBcIklOXCIsIHdoaWxlIHNpbmdsZVNlbGVjdCBpcyBcIkVRXCIsIGVsc2UgZG9uJ3QgbWFwIGFueSBvcGVyYXRvclxuICAgICAgICBpZiAoIW9wZXJhdG9yICYmIGNvbHVtbkRlZi5maWx0ZXIpIHtcbiAgICAgICAgICBvcGVyYXRvciA9IGNvbHVtbkRlZi5maWx0ZXIub3BlcmF0b3I7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiB3ZSBzdGlsbCBkb24ndCBoYXZlIGFuIG9wZXJhdG9yIGZpbmQgdGhlIHByb3BlciBPcGVyYXRvciB0byB1c2UgYnkgaXQncyBmaWVsZCB0eXBlXG4gICAgICAgIGlmICghb3BlcmF0b3IpIHtcbiAgICAgICAgICBvcGVyYXRvciA9IG1hcE9wZXJhdG9yQnlGaWVsZFR5cGUoY29sdW1uRGVmLnR5cGUgfHwgRmllbGRUeXBlLnN0cmluZyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBleHRyYSBxdWVyeSBhcmd1bWVudHNcbiAgICAgICAgaWYgKGJ5cGFzc09kYXRhUXVlcnkpIHtcbiAgICAgICAgICAvLyBwdXNoIHRvIG91ciB0ZW1wIGFycmF5IGFuZCBhbHNvIHRyaW0gd2hpdGUgc3BhY2VzXG4gICAgICAgICAgaWYgKGZpZWxkTmFtZSkge1xuICAgICAgICAgICAgdGhpcy5zYXZlQ29sdW1uRmlsdGVyKGZpZWxkTmFtZSwgZmllbGRTZWFyY2hWYWx1ZSwgc2VhcmNoVGVybXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZWFyY2hCeSA9ICcnO1xuXG4gICAgICAgICAgLy8gdGl0bGVDYXNlIHRoZSBmaWVsZE5hbWUgc28gdGhhdCBpdCBtYXRjaGVzIHRoZSBXZWJBcGkgbmFtZXNcbiAgICAgICAgICBpZiAodGhpcy5fb2RhdGFTZXJ2aWNlLm9wdGlvbnMuY2FzZVR5cGUgPT09IENhc2VUeXBlLnBhc2NhbENhc2UpIHtcbiAgICAgICAgICAgIGZpZWxkTmFtZSA9IHRpdGxlQ2FzZShmaWVsZE5hbWUgfHwgJycpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChmaWVsZFR5cGUgPT09IEZpZWxkVHlwZS5kYXRlKSB7XG4gICAgICAgICAgICBzZWFyY2hCeSA9IHRoaXMuZmlsdGVyQnlTZWFyY2hEYXRlKGZpZWxkTmFtZSwgb3BlcmF0b3IsIHNlYXJjaFRlcm1zLCBvZGF0YVZlcnNpb24pO1xuICAgICAgICAgIH0gZWxzZSBpZiAoc2VhcmNoVGVybXMgJiYgc2VhcmNoVGVybXMubGVuZ3RoID4gMSAmJiAob3BlcmF0b3IgPT09ICdJTicgfHwgb3BlcmF0b3IgPT09ICdOSU4nIHx8IG9wZXJhdG9yID09PSAnTk9USU4nIHx8IG9wZXJhdG9yID09PSAnTk9UIElOJyB8fCBvcGVyYXRvciA9PT0gJ05PVF9JTicpKSB7XG4gICAgICAgICAgICAvLyB3aGVuIGhhdmluZyBtb3JlIHRoYW4gMSBzZWFyY2ggdGVybSAodGhlbiBjaGVjayBpZiB3ZSBoYXZlIGEgXCJJTlwiIG9yIFwiTk9UIElOXCIgZmlsdGVyIHNlYXJjaClcbiAgICAgICAgICAgIGNvbnN0IHRtcFNlYXJjaFRlcm1zID0gW107XG5cbiAgICAgICAgICAgIGlmIChvcGVyYXRvciA9PT0gJ0lOJykge1xuICAgICAgICAgICAgICAvLyBleGFtcGxlOjogKFN0YWdlIGVxIFwiRXhwaXJlZFwiIG9yIFN0YWdlIGVxIFwiUmVuZXdhbFwiKVxuICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgbG5qID0gc2VhcmNoVGVybXMubGVuZ3RoOyBqIDwgbG5qOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoZmllbGRUeXBlID09PSBGaWVsZFR5cGUuc3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBzZWFyY2hWYWwgPSBzZWFyY2hUZXJtc1tqXS5yZXBsYWNlKGAnYCwgYCcnYCk7XG4gICAgICAgICAgICAgICAgICB0bXBTZWFyY2hUZXJtcy5wdXNoKGAke2ZpZWxkTmFtZX0gZXEgJyR7c2VhcmNoVmFsfSdgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgLy8gU2luZ2xlIHF1b3RlIGVzY2FwZSBpcyBub3QgbmVlZGVkIGZvciBub24gc3RyaW5nIHR5cGVcbiAgICAgICAgICAgICAgICAgIHRtcFNlYXJjaFRlcm1zLnB1c2goYCR7ZmllbGROYW1lfSBlcSAke3NlYXJjaFRlcm1zW2pdfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBzZWFyY2hCeSA9IHRtcFNlYXJjaFRlcm1zLmpvaW4oJyBvciAnKTtcbiAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIHNlYXJjaEJ5ID09PSAnc3RyaW5nJyAmJiBzZWFyY2hCeVswXSA9PT0gJygnICYmIHNlYXJjaEJ5LnNsaWNlKC0xKSA9PT0gJyknKSkge1xuICAgICAgICAgICAgICAgIHNlYXJjaEJ5ID0gYCgke3NlYXJjaEJ5fSlgO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAvLyBleGFtcGxlOjogKFN0YWdlIG5lIFwiRXhwaXJlZFwiIGFuZCBTdGFnZSBuZSBcIlJlbmV3YWxcIilcbiAgICAgICAgICAgICAgZm9yIChsZXQgayA9IDAsIGxuayA9IHNlYXJjaFRlcm1zLmxlbmd0aDsgayA8IGxuazsgaysrKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VhcmNoVmFsID0gc2VhcmNoVGVybXNba10ucmVwbGFjZShgJ2AsIGAnJ2ApO1xuICAgICAgICAgICAgICAgIHRtcFNlYXJjaFRlcm1zLnB1c2goYCR7ZmllbGROYW1lfSBuZSAnJHtzZWFyY2hWYWx9J2ApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHNlYXJjaEJ5ID0gdG1wU2VhcmNoVGVybXMuam9pbignIGFuZCAnKTtcbiAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIHNlYXJjaEJ5ID09PSAnc3RyaW5nJyAmJiBzZWFyY2hCeVswXSA9PT0gJygnICYmIHNlYXJjaEJ5LnNsaWNlKC0xKSA9PT0gJyknKSkge1xuICAgICAgICAgICAgICAgIHNlYXJjaEJ5ID0gYCgke3NlYXJjaEJ5fSlgO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmIChvcGVyYXRvciA9PT0gJyonIHx8IG9wZXJhdG9yID09PSAnYSonIHx8IG9wZXJhdG9yID09PSAnKnonIHx8IGxhc3RWYWx1ZUNoYXIgPT09ICcqJykge1xuICAgICAgICAgICAgLy8gZmlyc3QvbGFzdCBjaGFyYWN0ZXIgaXMgYSAnKicgd2lsbCBiZSBhIHN0YXJ0c1dpdGggb3IgZW5kc1dpdGhcbiAgICAgICAgICAgIHNlYXJjaEJ5ID0gKG9wZXJhdG9yID09PSAnKicgfHwgb3BlcmF0b3IgPT09ICcqeicpID8gYGVuZHN3aXRoKCR7ZmllbGROYW1lfSwgJyR7c2VhcmNoVmFsdWV9JylgIDogYHN0YXJ0c3dpdGgoJHtmaWVsZE5hbWV9LCAnJHtzZWFyY2hWYWx1ZX0nKWA7XG4gICAgICAgICAgfSBlbHNlIGlmIChmaWVsZFR5cGUgPT09IEZpZWxkVHlwZS5zdHJpbmcpIHtcbiAgICAgICAgICAgIC8vIHN0cmluZyBmaWVsZCBuZWVkcyB0byBiZSBpbiBzaW5nbGUgcXVvdGVzXG4gICAgICAgICAgICBpZiAob3BlcmF0b3IgPT09ICcnIHx8IG9wZXJhdG9yID09PSBPcGVyYXRvclR5cGUuY29udGFpbnMgfHwgb3BlcmF0b3IgPT09IE9wZXJhdG9yVHlwZS5ub3RDb250YWlucykge1xuICAgICAgICAgICAgICBzZWFyY2hCeSA9IHRoaXMub2RhdGFRdWVyeVZlcnNpb25XcmFwcGVyKCdzdWJzdHJpbmcnLCBvZGF0YVZlcnNpb24sIGZpZWxkTmFtZSwgc2VhcmNoVmFsdWUpO1xuICAgICAgICAgICAgICBpZiAob3BlcmF0b3IgPT09IE9wZXJhdG9yVHlwZS5ub3RDb250YWlucykge1xuICAgICAgICAgICAgICAgIHNlYXJjaEJ5ID0gYG5vdCAke3NlYXJjaEJ5fWA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3BlcmF0b3IgPT09IE9wZXJhdG9yVHlwZS5yYW5nZUV4Y2x1c2l2ZSB8fCBvcGVyYXRvciA9PT0gT3BlcmF0b3JUeXBlLnJhbmdlSW5jbHVzaXZlKSB7XG4gICAgICAgICAgICAgIC8vIGV4YW1wbGU6OiAoRHVyYXRpb24gPj0gNSBhbmQgRHVyYXRpb24gPD0gMTApXG4gICAgICAgICAgICAgIHNlYXJjaEJ5ID0gdGhpcy5maWx0ZXJCeVNlYXJjaFRlcm1SYW5nZShmaWVsZE5hbWUsIG9wZXJhdG9yLCBzZWFyY2hUZXJtcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBzZWFyY2hCeSA9IGAke2ZpZWxkTmFtZX0gJHt0aGlzLm1hcE9kYXRhT3BlcmF0b3Iob3BlcmF0b3IpfSAnJHtzZWFyY2hWYWx1ZX0nYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKG9wZXJhdG9yID09PSBPcGVyYXRvclR5cGUucmFuZ2VFeGNsdXNpdmUgfHwgb3BlcmF0b3IgPT09IE9wZXJhdG9yVHlwZS5yYW5nZUluY2x1c2l2ZSkge1xuICAgICAgICAgICAgICAvLyBleGFtcGxlOjogKER1cmF0aW9uID49IDUgYW5kIER1cmF0aW9uIDw9IDEwKVxuICAgICAgICAgICAgICBzZWFyY2hCeSA9IHRoaXMuZmlsdGVyQnlTZWFyY2hUZXJtUmFuZ2UoZmllbGROYW1lLCBvcGVyYXRvciwgc2VhcmNoVGVybXMpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gYW55IG90aGVyIGZpZWxkIHR5cGUgKG9yIHVuZGVmaW5lZCB0eXBlKVxuICAgICAgICAgICAgICBzZWFyY2hWYWx1ZSA9IChmaWVsZFR5cGUgPT09IEZpZWxkVHlwZS5udW1iZXIgfHwgZmllbGRUeXBlID09PSBGaWVsZFR5cGUuYm9vbGVhbikgPyBzZWFyY2hWYWx1ZSA6IGAnJHtzZWFyY2hWYWx1ZX0nYDtcbiAgICAgICAgICAgICAgc2VhcmNoQnkgPSBgJHtmaWVsZE5hbWV9ICR7dGhpcy5tYXBPZGF0YU9wZXJhdG9yKG9wZXJhdG9yKX0gJHtzZWFyY2hWYWx1ZX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIHB1c2ggdG8gb3VyIHRlbXAgYXJyYXkgYW5kIGFsc28gdHJpbSB3aGl0ZSBzcGFjZXNcbiAgICAgICAgICBpZiAoc2VhcmNoQnkgIT09ICcnKSB7XG4gICAgICAgICAgICBzZWFyY2hCeUFycmF5LnB1c2goc2VhcmNoQnkudHJpbSgpKTtcbiAgICAgICAgICAgIHRoaXMuc2F2ZUNvbHVtbkZpbHRlcihmaWVsZE5hbWUgfHwgJycsIGZpZWxkU2VhcmNoVmFsdWUsIHNlYXJjaFZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyB1cGRhdGUgdGhlIHNlcnZpY2Ugb3B0aW9ucyB3aXRoIGZpbHRlcnMgZm9yIHRoZSBidWlsZFF1ZXJ5KCkgdG8gd29yayBsYXRlclxuICAgIHRoaXMuX29kYXRhU2VydmljZS51cGRhdGVPcHRpb25zKHtcbiAgICAgIGZpbHRlcjogKHNlYXJjaEJ5QXJyYXkubGVuZ3RoID4gMCkgPyBzZWFyY2hCeUFycmF5LmpvaW4oJyBhbmQgJykgOiAnJyxcbiAgICAgIHNraXA6IHVuZGVmaW5lZFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgcGFnaW5hdGlvbiBjb21wb25lbnQgd2l0aCBpdCdzIG5ldyBwYWdlIG51bWJlciBhbmQgc2l6ZVxuICAgKiBAcGFyYW0gbmV3UGFnZVxuICAgKiBAcGFyYW0gcGFnZVNpemVcbiAgICovXG4gIHVwZGF0ZVBhZ2luYXRpb24obmV3UGFnZTogbnVtYmVyLCBwYWdlU2l6ZTogbnVtYmVyKSB7XG4gICAgdGhpcy5fY3VycmVudFBhZ2luYXRpb24gPSB7XG4gICAgICBwYWdlTnVtYmVyOiBuZXdQYWdlLFxuICAgICAgcGFnZVNpemUsXG4gICAgfTtcblxuICAgIC8vIHVubGVzcyB1c2VyIHNwZWNpZmljYWxseSBzZXQgXCJlbmFibGVQYWdpbmF0aW9uXCIgdG8gRmFsc2UsIHdlJ2xsIHVwZGF0ZSBwYWdpbmF0aW9uIG9wdGlvbnMgaW4gZXZlcnkgb3RoZXIgY2FzZXNcbiAgICBpZiAodGhpcy5fZ3JpZE9wdGlvbnMgJiYgKHRoaXMuX2dyaWRPcHRpb25zLmVuYWJsZVBhZ2luYXRpb24gfHwgIXRoaXMuX2dyaWRPcHRpb25zLmhhc093blByb3BlcnR5KCdlbmFibGVQYWdpbmF0aW9uJykpKSB7XG4gICAgICB0aGlzLl9vZGF0YVNlcnZpY2UudXBkYXRlT3B0aW9ucyh7XG4gICAgICAgIHRvcDogcGFnZVNpemUsXG4gICAgICAgIHNraXA6IChuZXdQYWdlIC0gMSkgKiBwYWdlU2l6ZVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGxvb3AgdGhyb3VnaCBhbGwgY29sdW1ucyB0byBpbnNwZWN0IHNvcnRlcnMgJiB1cGRhdGUgYmFja2VuZCBzZXJ2aWNlIG9yZGVyQnlcbiAgICogQHBhcmFtIGNvbHVtbkZpbHRlcnNcbiAgICovXG4gIHVwZGF0ZVNvcnRlcnMoc29ydENvbHVtbnM/OiBDb2x1bW5Tb3J0W10sIHByZXNldFNvcnRlcnM/OiBDdXJyZW50U29ydGVyW10pIHtcbiAgICBsZXQgY3VycmVudFNvcnRlcnM6IEN1cnJlbnRTb3J0ZXJbXSA9IFtdO1xuICAgIGNvbnN0IG9kYXRhU29ydGVyczogT2RhdGFTb3J0aW5nT3B0aW9uW10gPSBbXTtcblxuICAgIGlmICghc29ydENvbHVtbnMgJiYgcHJlc2V0U29ydGVycykge1xuICAgICAgLy8gbWFrZSB0aGUgcHJlc2V0cyB0aGUgY3VycmVudCBzb3J0ZXJzLCBhbHNvIG1ha2Ugc3VyZSB0aGF0IGFsbCBkaXJlY3Rpb24gYXJlIGluIGxvd2VyY2FzZSBmb3IgT0RhdGFcbiAgICAgIGN1cnJlbnRTb3J0ZXJzID0gcHJlc2V0U29ydGVycztcbiAgICAgIGN1cnJlbnRTb3J0ZXJzLmZvckVhY2goKHNvcnRlcikgPT4gc29ydGVyLmRpcmVjdGlvbiA9IHNvcnRlci5kaXJlY3Rpb24udG9Mb3dlckNhc2UoKSBhcyBTb3J0RGlyZWN0aW9uU3RyaW5nKTtcblxuICAgICAgLy8gZGlzcGxheSB0aGUgY29ycmVjdCBzb3J0aW5nIGljb25zIG9uIHRoZSBVSSwgZm9yIHRoYXQgaXQgcmVxdWlyZXMgKGNvbHVtbklkLCBzb3J0QXNjKSBwcm9wZXJ0aWVzXG4gICAgICBjb25zdCB0bXBTb3J0ZXJBcnJheSA9IGN1cnJlbnRTb3J0ZXJzLm1hcCgoc29ydGVyKSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbHVtbkRlZiA9IHRoaXMuX2NvbHVtbkRlZmluaXRpb25zLmZpbmQoKGNvbHVtbjogQ29sdW1uKSA9PiBjb2x1bW4uaWQgPT09IHNvcnRlci5jb2x1bW5JZCk7XG5cbiAgICAgICAgb2RhdGFTb3J0ZXJzLnB1c2goe1xuICAgICAgICAgIGZpZWxkOiBjb2x1bW5EZWYgPyAoKGNvbHVtbkRlZi5xdWVyeUZpZWxkU29ydGVyIHx8IGNvbHVtbkRlZi5xdWVyeUZpZWxkIHx8IGNvbHVtbkRlZi5maWVsZCkgKyAnJykgOiAoc29ydGVyLmNvbHVtbklkICsgJycpLFxuICAgICAgICAgIGRpcmVjdGlvbjogc29ydGVyLmRpcmVjdGlvblxuICAgICAgICB9KTtcblxuICAgICAgICAvLyByZXR1cm4gb25seSB0aGUgY29sdW1uKHMpIGZvdW5kIGluIHRoZSBDb2x1bW4gRGVmaW5pdGlvbnMgRUxTRSBudWxsXG4gICAgICAgIGlmIChjb2x1bW5EZWYpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29sdW1uSWQ6IHNvcnRlci5jb2x1bW5JZCxcbiAgICAgICAgICAgIHNvcnRBc2M6IHNvcnRlci5kaXJlY3Rpb24udG9VcHBlckNhc2UoKSA9PT0gU29ydERpcmVjdGlvbi5BU0NcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIHNldCB0aGUgc29ydCBpY29ucywgYnV0IGFsc28gbWFrZSBzdXJlIHRvIGZpbHRlciBvdXQgbnVsbCB2YWx1ZXMgKHRoYXQgaGFwcGVucyB3aGVuIGNvbHVtbkRlZiBpcyBub3QgZm91bmQpXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh0bXBTb3J0ZXJBcnJheSkpIHtcbiAgICAgICAgdGhpcy5fZ3JpZC5zZXRTb3J0Q29sdW1ucyh0bXBTb3J0ZXJBcnJheSk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChzb3J0Q29sdW1ucyAmJiAhcHJlc2V0U29ydGVycykge1xuICAgICAgLy8gYnVpbGQgdGhlIFNvcnRCeSBzdHJpbmcsIGl0IGNvdWxkIGJlIG11bHRpc29ydCwgZXhhbXBsZTogY3VzdG9tZXJObyBhc2MsIHB1cmNoYXNlck5hbWUgZGVzY1xuICAgICAgaWYgKHNvcnRDb2x1bW5zICYmIHNvcnRDb2x1bW5zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAvLyBUT0RPIGZpeCB0aGlzIGxpbmVcbiAgICAgICAgLy8gY3VycmVudFNvcnRlcnMgPSBuZXcgQXJyYXkodGhpcy5kZWZhdWx0T3B0aW9ucy5vcmRlckJ5KTsgLy8gd2hlbiBlbXB0eSwgdXNlIHRoZSBkZWZhdWx0IHNvcnRcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChzb3J0Q29sdW1ucykge1xuICAgICAgICAgIGZvciAoY29uc3QgY29sdW1uRGVmIG9mIHNvcnRDb2x1bW5zKSB7XG4gICAgICAgICAgICBpZiAoY29sdW1uRGVmLnNvcnRDb2wpIHtcbiAgICAgICAgICAgICAgbGV0IGZpZWxkTmFtZSA9IChjb2x1bW5EZWYuc29ydENvbC5xdWVyeUZpZWxkU29ydGVyIHx8IGNvbHVtbkRlZi5zb3J0Q29sLnF1ZXJ5RmllbGQgfHwgY29sdW1uRGVmLnNvcnRDb2wuZmllbGQpICsgJyc7XG4gICAgICAgICAgICAgIGxldCBjb2x1bW5GaWVsZE5hbWUgPSAoY29sdW1uRGVmLnNvcnRDb2wuZmllbGQgfHwgY29sdW1uRGVmLnNvcnRDb2wuaWQpICsgJyc7XG4gICAgICAgICAgICAgIGxldCBxdWVyeUZpZWxkID0gKGNvbHVtbkRlZi5zb3J0Q29sLnF1ZXJ5RmllbGRTb3J0ZXIgfHwgY29sdW1uRGVmLnNvcnRDb2wucXVlcnlGaWVsZCB8fCBjb2x1bW5EZWYuc29ydENvbC5maWVsZCB8fCAnJykgKyAnJztcbiAgICAgICAgICAgICAgaWYgKHRoaXMuX29kYXRhU2VydmljZS5vcHRpb25zLmNhc2VUeXBlID09PSBDYXNlVHlwZS5wYXNjYWxDYXNlKSB7XG4gICAgICAgICAgICAgICAgZmllbGROYW1lID0gdGl0bGVDYXNlKGZpZWxkTmFtZSk7XG4gICAgICAgICAgICAgICAgY29sdW1uRmllbGROYW1lID0gdGl0bGVDYXNlKGNvbHVtbkZpZWxkTmFtZSk7XG4gICAgICAgICAgICAgICAgcXVlcnlGaWVsZCA9IHRpdGxlQ2FzZShxdWVyeUZpZWxkKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChjb2x1bW5GaWVsZE5hbWUgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFNvcnRlcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICBjb2x1bW5JZDogY29sdW1uRmllbGROYW1lLFxuICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBjb2x1bW5EZWYuc29ydEFzYyA/ICdhc2MnIDogJ2Rlc2MnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAocXVlcnlGaWVsZCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICBvZGF0YVNvcnRlcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICBmaWVsZDogcXVlcnlGaWVsZCxcbiAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogY29sdW1uRGVmLnNvcnRBc2MgPyBTb3J0RGlyZWN0aW9uLkFTQyA6IFNvcnREaXJlY3Rpb24uREVTQ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gdHJhbnNmb3JtIHRoZSBzb3J0YnkgYXJyYXkgaW50byBhIENTViBzdHJpbmcgZm9yIE9EYXRhXG4gICAgY3VycmVudFNvcnRlcnMgPSBjdXJyZW50U29ydGVycyB8fCBbXSBhcyBDdXJyZW50U29ydGVyW107XG4gICAgY29uc3QgY3N2U3RyaW5nID0gb2RhdGFTb3J0ZXJzLm1hcCgoc29ydGVyKSA9PiB7XG4gICAgICBsZXQgc3RyID0gJyc7XG4gICAgICBpZiAoc29ydGVyICYmIHNvcnRlci5maWVsZCkge1xuICAgICAgICBjb25zdCBzb3J0RmllbGQgPSAodGhpcy5fb2RhdGFTZXJ2aWNlLm9wdGlvbnMuY2FzZVR5cGUgPT09IENhc2VUeXBlLnBhc2NhbENhc2UpID8gdGl0bGVDYXNlKHNvcnRlci5maWVsZCkgOiBzb3J0ZXIuZmllbGQ7XG4gICAgICAgIHN0ciA9IGAke3NvcnRGaWVsZH0gJHtzb3J0ZXIgJiYgc29ydGVyLmRpcmVjdGlvbiAmJiBzb3J0ZXIuZGlyZWN0aW9uLnRvTG93ZXJDYXNlKCkgfHwgJyd9YDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzdHI7XG4gICAgfSkuam9pbignLCcpO1xuXG4gICAgdGhpcy5fb2RhdGFTZXJ2aWNlLnVwZGF0ZU9wdGlvbnMoe1xuICAgICAgb3JkZXJCeTogY3N2U3RyaW5nXG4gICAgfSk7XG5cbiAgICAvLyBrZWVwIGN1cnJlbnQgU29ydGVycyBhbmQgdXBkYXRlIHRoZSBzZXJ2aWNlIG9wdGlvbnMgd2l0aCB0aGUgbmV3IHNvcnRpbmdcbiAgICB0aGlzLl9jdXJyZW50U29ydGVycyA9IGN1cnJlbnRTb3J0ZXJzO1xuXG4gICAgLy8gYnVpbGQgdGhlIE9EYXRhIHF1ZXJ5IHdoaWNoIHdlIHdpbGwgdXNlIGluIHRoZSBXZWJBUEkgY2FsbGJhY2tcbiAgICByZXR1cm4gdGhpcy5fb2RhdGFTZXJ2aWNlLmJ1aWxkUXVlcnkoKTtcbiAgfVxuXG4gIC8vXG4gIC8vIHByaXZhdGUgZnVuY3Rpb25zXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIENhc3QgcHJvdmlkZWQgZmlsdGVycyAoY291bGQgYmUgaW4gbXVsdGlwbGUgZm9ybWF0KSBpbnRvIGFuIGFycmF5IG9mIENvbHVtbkZpbHRlclxuICAgKiBAcGFyYW0gY29sdW1uRmlsdGVyc1xuICAgKi9cbiAgcHJpdmF0ZSBjYXN0RmlsdGVyVG9Db2x1bW5GaWx0ZXJzKGNvbHVtbkZpbHRlcnM6IENvbHVtbkZpbHRlcnMgfCBDdXJyZW50RmlsdGVyW10pOiBDdXJyZW50RmlsdGVyW10ge1xuICAgIC8vIGtlZXAgY3VycmVudCBmaWx0ZXJzICYgYWx3YXlzIHNhdmUgaXQgYXMgYW4gYXJyYXkgKGNvbHVtbkZpbHRlcnMgY2FuIGJlIGFuIG9iamVjdCB3aGVuIGl0IGlzIGRlYWx0IGJ5IFNsaWNrR3JpZCBGaWx0ZXIpXG4gICAgY29uc3QgZmlsdGVyc0FycmF5OiBDb2x1bW5GaWx0ZXJbXSA9ICh0eXBlb2YgY29sdW1uRmlsdGVycyA9PT0gJ29iamVjdCcpID8gT2JqZWN0LmtleXMoY29sdW1uRmlsdGVycykubWFwKGtleSA9PiBjb2x1bW5GaWx0ZXJzW2tleV0pIDogY29sdW1uRmlsdGVycztcblxuICAgIGlmICghQXJyYXkuaXNBcnJheShmaWx0ZXJzQXJyYXkpKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgcmV0dXJuIGZpbHRlcnNBcnJheS5tYXAoKGZpbHRlcikgPT4ge1xuICAgICAgY29uc3QgdG1wRmlsdGVyOiBDdXJyZW50RmlsdGVyID0geyBjb2x1bW5JZDogZmlsdGVyLmNvbHVtbklkIHx8ICcnIH07XG4gICAgICBpZiAoZmlsdGVyLm9wZXJhdG9yKSB7XG4gICAgICAgIHRtcEZpbHRlci5vcGVyYXRvciA9IGZpbHRlci5vcGVyYXRvcjtcbiAgICAgIH1cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGZpbHRlci5zZWFyY2hUZXJtcykpIHtcbiAgICAgICAgdG1wRmlsdGVyLnNlYXJjaFRlcm1zID0gZmlsdGVyLnNlYXJjaFRlcm1zO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRtcEZpbHRlcjtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgb2RhdGFRdWVyeVZlcnNpb25XcmFwcGVyKHF1ZXJ5VHlwZTogJ2RhdGVUaW1lJyB8ICdzdWJzdHJpbmcnLCB2ZXJzaW9uOiBudW1iZXIsIGZpZWxkTmFtZTogc3RyaW5nLCBzZWFyY2hWYWx1ZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBsZXQgcXVlcnkgPSAnJztcbiAgICBzd2l0Y2ggKHF1ZXJ5VHlwZSkge1xuICAgICAgY2FzZSAnZGF0ZVRpbWUnOlxuICAgICAgICBxdWVyeSA9IHZlcnNpb24gPj0gNCA/IHNlYXJjaFZhbHVlIDogYERhdGVUaW1lJyR7c2VhcmNoVmFsdWV9J2A7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc3Vic3RyaW5nJzpcbiAgICAgICAgcXVlcnkgPSB2ZXJzaW9uID49IDQgPyBgY29udGFpbnMoJHtmaWVsZE5hbWV9LCAnJHtzZWFyY2hWYWx1ZX0nKWAgOiBgc3Vic3RyaW5nb2YoJyR7c2VhcmNoVmFsdWV9JywgJHtmaWVsZE5hbWV9KWA7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4gcXVlcnk7XG4gIH1cblxuICAvKipcbiAgICogRmlsdGVyIGJ5IGEgc2VhcmNoIGRhdGUsIHRoZSBzZWFyY2hUZXJtcyBtaWdodCBiZSBhIHNpbmdsZSB2YWx1ZSBvciByYW5nZSBvZiBkYXRlcyAoMiBzZWFyY2hUZXJtcyBPUiAxIHN0cmluZyBzZXBhcmF0ZWQgYnkgMiBkb3RzIFwiZGF0ZTEuLmRhdGUyXCIpXG4gICAqIEFsc28gZGVwZW5kaW5nIG9uIHRoZSBPRGF0YSB2ZXJzaW9uIG51bWJlciwgdGhlIG91dHB1dCB3aWxsIGJlIGRpZmZlcmVudCwgcHJldmlvdXMgdmVyc2lvbiBtdXN0IHdyYXAgZGF0ZXMgd2l0aCBEYXRlVGltZVxuICAgKiAtIHZlcnNpb24gMi0zOjogRmluaXNoIGd0IERhdGVUaW1lJzIwMTktMDgtMTJUMDA6MDA6MDBaJ1xuICAgKiAtIHZlcnNpb24gNDo6IEZpbmlzaCBndCAyMDE5LTA4LTEyVDAwOjAwOjAwWlxuICAgKi9cbiAgcHJpdmF0ZSBmaWx0ZXJCeVNlYXJjaERhdGUoZmllbGROYW1lOiBzdHJpbmcsIG9wZXJhdG9yOiBPcGVyYXRvclR5cGUgfCBPcGVyYXRvclN0cmluZywgc2VhcmNoVGVybXM6IFNlYXJjaFRlcm1bXSwgdmVyc2lvbjogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBsZXQgcXVlcnkgPSAnJztcbiAgICBsZXQgc2VhcmNoVmFsdWVzOiBTZWFyY2hUZXJtW107XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoc2VhcmNoVGVybXMpICYmIHNlYXJjaFRlcm1zLmxlbmd0aCA+IDEpIHtcbiAgICAgIHNlYXJjaFZhbHVlcyA9IHNlYXJjaFRlcm1zO1xuICAgICAgaWYgKG9wZXJhdG9yICE9PSBPcGVyYXRvclR5cGUucmFuZ2VFeGNsdXNpdmUgJiYgb3BlcmF0b3IgIT09IE9wZXJhdG9yVHlwZS5yYW5nZUluY2x1c2l2ZSkge1xuICAgICAgICBvcGVyYXRvciA9IHRoaXMuX2dyaWRPcHRpb25zLmRlZmF1bHRGaWx0ZXJSYW5nZU9wZXJhdG9yO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIHNpbmdsZSBzZWFyY2ggdmFsdWVcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoc2VhcmNoVmFsdWVzKSAmJiBBcnJheS5pc0FycmF5KHNlYXJjaFRlcm1zKSAmJiBzZWFyY2hUZXJtcy5sZW5ndGggPT09IDEgJiYgc2VhcmNoVGVybXNbMF0pIHtcbiAgICAgIGNvbnN0IHNlYXJjaFZhbHVlMSA9IHRoaXMub2RhdGFRdWVyeVZlcnNpb25XcmFwcGVyKCdkYXRlVGltZScsIHZlcnNpb24sIGZpZWxkTmFtZSwgcGFyc2VVdGNEYXRlKHNlYXJjaFRlcm1zWzBdIGFzIHN0cmluZywgdHJ1ZSkpO1xuICAgICAgaWYgKHNlYXJjaFZhbHVlMSkge1xuICAgICAgICByZXR1cm4gYCR7ZmllbGROYW1lfSAke3RoaXMubWFwT2RhdGFPcGVyYXRvcihvcGVyYXRvcil9ICR7c2VhcmNoVmFsdWUxfWA7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gbXVsdGlwbGUgc2VhcmNoIHZhbHVlIChkYXRlIHJhbmdlKVxuICAgIGlmIChBcnJheS5pc0FycmF5KHNlYXJjaFZhbHVlcykgJiYgc2VhcmNoVmFsdWVzLmxlbmd0aCA9PT0gMiAmJiBzZWFyY2hWYWx1ZXNbMF0gJiYgc2VhcmNoVmFsdWVzWzFdKSB7XG4gICAgICAvLyBkYXRlIGZpZWxkIG5lZWRzIHRvIGJlIFVUQyBhbmQgd2l0aGluIERhdGVUaW1lIGZ1bmN0aW9uXG4gICAgICBjb25zdCBzZWFyY2hWYWx1ZTEgPSB0aGlzLm9kYXRhUXVlcnlWZXJzaW9uV3JhcHBlcignZGF0ZVRpbWUnLCB2ZXJzaW9uLCBmaWVsZE5hbWUsIHBhcnNlVXRjRGF0ZShzZWFyY2hWYWx1ZXNbMF0gYXMgc3RyaW5nLCB0cnVlKSk7XG4gICAgICBjb25zdCBzZWFyY2hWYWx1ZTIgPSB0aGlzLm9kYXRhUXVlcnlWZXJzaW9uV3JhcHBlcignZGF0ZVRpbWUnLCB2ZXJzaW9uLCBmaWVsZE5hbWUsIHBhcnNlVXRjRGF0ZShzZWFyY2hWYWx1ZXNbMV0gYXMgc3RyaW5nLCB0cnVlKSk7XG5cbiAgICAgIGlmIChzZWFyY2hWYWx1ZTEgJiYgc2VhcmNoVmFsdWUyKSB7XG4gICAgICAgIGlmIChvcGVyYXRvciA9PT0gT3BlcmF0b3JUeXBlLnJhbmdlSW5jbHVzaXZlKSB7XG4gICAgICAgICAgLy8gZXhhbXBsZTo6IChGaW5pc2ggPj0gRGF0ZVRpbWUnMjAxOS0wOC0xMVQwMDowMDowMFonIGFuZCBGaW5pc2ggPD0gRGF0ZVRpbWUnMjAxOS0wOS0xMlQwMDowMDowMFonKVxuICAgICAgICAgIHF1ZXJ5ID0gYCgke2ZpZWxkTmFtZX0gZ2UgJHtzZWFyY2hWYWx1ZTF9IGFuZCAke2ZpZWxkTmFtZX0gbGUgJHtzZWFyY2hWYWx1ZTJ9KWA7XG4gICAgICAgIH0gZWxzZSBpZiAob3BlcmF0b3IgPT09IE9wZXJhdG9yVHlwZS5yYW5nZUV4Y2x1c2l2ZSkge1xuICAgICAgICAgIC8vIGV4YW1wbGU6OiAoRmluaXNoID4gRGF0ZVRpbWUnMjAxOS0wOC0xMVQwMDowMDowMFonIGFuZCBGaW5pc2ggPCBEYXRlVGltZScyMDE5LTA5LTEyVDAwOjAwOjAwWicpXG4gICAgICAgICAgcXVlcnkgPSBgKCR7ZmllbGROYW1lfSBndCAke3NlYXJjaFZhbHVlMX0gYW5kICR7ZmllbGROYW1lfSBsdCAke3NlYXJjaFZhbHVlMn0pYDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcXVlcnk7XG4gIH1cblxuICAvKipcbiAgICogRmlsdGVyIGJ5IGEgcmFuZ2Ugb2Ygc2VhcmNoVGVybXMgKDIgc2VhcmNoVGVybXMgT1IgMSBzdHJpbmcgc2VwYXJhdGVkIGJ5IDIgZG90cyBcInZhbHVlMS4udmFsdWUyXCIpXG4gICAqL1xuICBwcml2YXRlIGZpbHRlckJ5U2VhcmNoVGVybVJhbmdlKGZpZWxkTmFtZTogc3RyaW5nLCBvcGVyYXRvcjogT3BlcmF0b3JUeXBlIHwgT3BlcmF0b3JTdHJpbmcsIHNlYXJjaFRlcm1zOiBTZWFyY2hUZXJtW10pIHtcbiAgICBsZXQgcXVlcnkgPSAnJztcblxuICAgIGlmIChBcnJheS5pc0FycmF5KHNlYXJjaFRlcm1zKSAmJiBzZWFyY2hUZXJtcy5sZW5ndGggPT09IDIpIHtcbiAgICAgIGlmIChvcGVyYXRvciA9PT0gT3BlcmF0b3JUeXBlLnJhbmdlSW5jbHVzaXZlKSB7XG4gICAgICAgIC8vIGV4YW1wbGU6OiAoRHVyYXRpb24gPj0gNSBhbmQgRHVyYXRpb24gPD0gMTApXG4gICAgICAgIHF1ZXJ5ID0gYCgke2ZpZWxkTmFtZX0gZ2UgJHtzZWFyY2hUZXJtc1swXX0gYW5kICR7ZmllbGROYW1lfSBsZSAke3NlYXJjaFRlcm1zWzFdfSlgO1xuICAgICAgfSBlbHNlIGlmIChvcGVyYXRvciA9PT0gT3BlcmF0b3JUeXBlLnJhbmdlRXhjbHVzaXZlKSB7XG4gICAgICAgIC8vIGV4YW1wbGU6OiAoRHVyYXRpb24gPiA1IGFuZCBEdXJhdGlvbiA8IDEwKVxuICAgICAgICBxdWVyeSA9IGAoJHtmaWVsZE5hbWV9IGd0ICR7c2VhcmNoVGVybXNbMF19IGFuZCAke2ZpZWxkTmFtZX0gbHQgJHtzZWFyY2hUZXJtc1sxXX0pYDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHF1ZXJ5O1xuICB9XG59XG4iXX0=