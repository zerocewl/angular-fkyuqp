import * as tslib_1 from "tslib";
// import common 3rd party SlickGrid plugins/libs
import 'slickgrid/plugins/slick.cellrangedecorator';
import 'slickgrid/plugins/slick.cellrangeselector';
import 'slickgrid/plugins/slick.cellselectionmodel';
import { Injectable, Optional } from '@angular/core';
import { TranslateService } from '@ngx-translate/core';
import { ExtensionName, } from '../models/index';
import { AutoTooltipExtension, CellExternalCopyManagerExtension, CellMenuExtension, CheckboxSelectorExtension, ColumnPickerExtension, ContextMenuExtension, DraggableGroupingExtension, GridMenuExtension, GroupItemMetaProviderExtension, HeaderButtonExtension, HeaderMenuExtension, RowDetailViewExtension, RowMoveManagerExtension, RowSelectionExtension, } from '../extensions/index';
import { SharedService } from './shared.service';
var ExtensionService = /** @class */ (function () {
    function ExtensionService(autoTooltipExtension, cellExternalCopyExtension, cellMenuExtension, checkboxSelectorExtension, columnPickerExtension, contextMenuExtension, draggableGroupingExtension, gridMenuExtension, groupItemMetaExtension, headerButtonExtension, headerMenuExtension, rowDetailViewExtension, rowMoveManagerExtension, rowSelectionExtension, sharedService, translate) {
        this.autoTooltipExtension = autoTooltipExtension;
        this.cellExternalCopyExtension = cellExternalCopyExtension;
        this.cellMenuExtension = cellMenuExtension;
        this.checkboxSelectorExtension = checkboxSelectorExtension;
        this.columnPickerExtension = columnPickerExtension;
        this.contextMenuExtension = contextMenuExtension;
        this.draggableGroupingExtension = draggableGroupingExtension;
        this.gridMenuExtension = gridMenuExtension;
        this.groupItemMetaExtension = groupItemMetaExtension;
        this.headerButtonExtension = headerButtonExtension;
        this.headerMenuExtension = headerMenuExtension;
        this.rowDetailViewExtension = rowDetailViewExtension;
        this.rowMoveManagerExtension = rowMoveManagerExtension;
        this.rowSelectionExtension = rowSelectionExtension;
        this.sharedService = sharedService;
        this.translate = translate;
        this._extensionCreatedList = [];
        this._extensionList = [];
    }
    /** Dispose of all the controls & plugins */
    ExtensionService.prototype.dispose = function () {
        this.sharedService.grid = null;
        this.sharedService.visibleColumns = [];
        // dispose of each control/plugin & reset the list
        this._extensionList.forEach(function (item) {
            if (item && item.class && item.class.dispose) {
                item.class.dispose();
            }
        });
        this._extensionList = [];
    };
    /** Get all columns (includes visible and non-visible) */
    ExtensionService.prototype.getAllColumns = function () {
        return this.sharedService.allColumns || [];
    };
    /** Get only visible columns */
    ExtensionService.prototype.getVisibleColumns = function () {
        return this.sharedService.visibleColumns || [];
    };
    /** Get all Extensions */
    ExtensionService.prototype.getAllExtensions = function () {
        return this._extensionList;
    };
    /**
     * Get an Extension by it's name
     *  @param name
     */
    ExtensionService.prototype.getExtensionByName = function (name) {
        return Array.isArray(this._extensionList) && this._extensionList.find(function (p) { return p.name === name; });
    };
    /**
     * Get the instance of the SlickGrid addon (control or plugin).
     * This is the raw addon coming directly from SlickGrid itself, not to confuse with Angular-Slickgrid extension
     *  @param name
     */
    ExtensionService.prototype.getSlickgridAddonInstance = function (name) {
        var extension = this.getExtensionByName(name);
        if (extension && extension.class && (extension.instance || extension.addon)) {
            if (extension.class && extension.class.getAddonInstance) {
                return extension.class.getAddonInstance();
            }
            return extension.instance;
        }
        return null;
    };
    /** Auto-resize all the column in the grid to fit the grid width */
    ExtensionService.prototype.autoResizeColumns = function () {
        this.sharedService.grid.autosizeColumns();
    };
    /** Bind/Create different Controls or Plugins after the Grid is created */
    ExtensionService.prototype.bindDifferentExtensions = function () {
        var _this = this;
        if (this.sharedService && this.sharedService.gridOptions) {
            // make sure all columns are translated before creating ColumnPicker/GridMenu Controls
            // this is to avoid having hidden columns not being translated on first load
            if (this.sharedService.gridOptions.enableTranslate) {
                // eventually deprecate the "headerKey" and use only the "nameKey"
                this.translateItems(this.sharedService.allColumns, 'headerKey', 'name');
                this.translateItems(this.sharedService.allColumns, 'nameKey', 'name');
            }
            // Auto Tooltip Plugin
            if (this.sharedService.gridOptions.enableAutoTooltip) {
                if (this.autoTooltipExtension && this.autoTooltipExtension.register) {
                    var instance = this.autoTooltipExtension.register();
                    this._extensionList.push({ name: ExtensionName.autoTooltip, class: this.autoTooltipExtension, addon: instance, instance: instance });
                }
            }
            // Cell External Copy Manager Plugin (Excel Like)
            if (this.sharedService.gridOptions.enableExcelCopyBuffer) {
                if (this.cellExternalCopyExtension && this.cellExternalCopyExtension.register) {
                    var instance = this.cellExternalCopyExtension.register();
                    this._extensionList.push({ name: ExtensionName.cellExternalCopyManager, class: this.cellExternalCopyExtension, addon: instance, instance: instance });
                }
            }
            // (Action) Cell Menu Plugin
            if (this.sharedService.gridOptions.enableCellMenu) {
                if (this.cellMenuExtension && this.cellMenuExtension.register) {
                    var instance = this.cellMenuExtension.register();
                    this._extensionList.push({ name: ExtensionName.cellMenu, class: this.cellMenuExtension, addon: instance, instance: instance });
                }
            }
            // Row Selection Plugin
            // this extension should be registered BEFORE the Checkbox Selector & Row Detail since it can be use by these 2 plugins
            if (!this.getExtensionByName(ExtensionName.rowSelection) && (this.sharedService.gridOptions.enableRowSelection || this.sharedService.gridOptions.enableCheckboxSelector || this.sharedService.gridOptions.enableRowDetailView)) {
                if (this.rowSelectionExtension && this.rowSelectionExtension.register) {
                    var instance = this.rowSelectionExtension.register();
                    this._extensionList.push({ name: ExtensionName.rowSelection, class: this.rowSelectionExtension, addon: instance, instance: instance });
                }
            }
            // Checkbox Selector Plugin
            if (this.sharedService.gridOptions.enableCheckboxSelector) {
                if (this.checkboxSelectorExtension && this.checkboxSelectorExtension.register) {
                    var rowSelectionExtension = this.getExtensionByName(ExtensionName.rowSelection);
                    this.checkboxSelectorExtension.register(rowSelectionExtension);
                    var createdExtension = this.getCreatedExtensionByName(ExtensionName.checkboxSelector); // get the instance from when it was really created earlier
                    var instance = createdExtension && createdExtension.instance;
                    this._extensionList.push({ name: ExtensionName.checkboxSelector, class: this.checkboxSelectorExtension, addon: instance, instance: instance });
                }
            }
            // Column Picker Control
            if (this.sharedService.gridOptions.enableColumnPicker) {
                if (this.columnPickerExtension && this.columnPickerExtension.register) {
                    var instance = this.columnPickerExtension.register();
                    this._extensionList.push({ name: ExtensionName.columnPicker, class: this.columnPickerExtension, addon: instance, instance: instance });
                }
            }
            // Context Menu Control
            if (this.sharedService.gridOptions.enableContextMenu) {
                if (this.contextMenuExtension && this.contextMenuExtension.register) {
                    var instance = this.contextMenuExtension.register();
                    this._extensionList.push({ name: ExtensionName.contextMenu, class: this.contextMenuExtension, addon: instance, instance: instance });
                }
            }
            // Draggable Grouping Plugin
            if (this.sharedService.gridOptions.enableDraggableGrouping) {
                if (this.draggableGroupingExtension && this.draggableGroupingExtension.register) {
                    var instance = this.draggableGroupingExtension.register();
                    this._extensionList.push({ name: ExtensionName.draggableGrouping, class: this.draggableGroupingExtension, addon: instance, instance: instance });
                }
            }
            // Grid Menu Control
            if (this.sharedService.gridOptions.enableGridMenu) {
                if (this.gridMenuExtension && this.gridMenuExtension.register) {
                    var instance = this.gridMenuExtension.register();
                    this._extensionList.push({ name: ExtensionName.gridMenu, class: this.gridMenuExtension, addon: instance, instance: instance });
                }
            }
            // Grouping Plugin
            // register the group item metadata provider to add expand/collapse group handlers
            if (this.sharedService.gridOptions.enableDraggableGrouping || this.sharedService.gridOptions.enableGrouping) {
                if (this.groupItemMetaExtension && this.groupItemMetaExtension.register) {
                    var instance = this.groupItemMetaExtension.register();
                    this._extensionList.push({ name: ExtensionName.groupItemMetaProvider, class: this.groupItemMetaExtension, addon: instance, instance: instance });
                }
            }
            // Header Button Plugin
            if (this.sharedService.gridOptions.enableHeaderButton) {
                if (this.headerButtonExtension && this.headerButtonExtension.register) {
                    var instance = this.headerButtonExtension.register();
                    this._extensionList.push({ name: ExtensionName.headerButton, class: this.headerButtonExtension, addon: instance, instance: instance });
                }
            }
            // Header Menu Plugin
            if (this.sharedService.gridOptions.enableHeaderMenu) {
                if (this.headerMenuExtension && this.headerMenuExtension.register) {
                    var instance = this.headerMenuExtension.register();
                    this._extensionList.push({ name: ExtensionName.headerMenu, class: this.headerMenuExtension, addon: instance, instance: instance });
                }
            }
            // Row Detail View Plugin
            if (this.sharedService.gridOptions.enableRowDetailView) {
                if (this.rowDetailViewExtension && this.rowDetailViewExtension.register) {
                    var rowSelectionExtension = this.getExtensionByName(ExtensionName.rowSelection);
                    this.rowDetailViewExtension.register(rowSelectionExtension);
                    var createdExtension = this.getCreatedExtensionByName(ExtensionName.rowDetailView); // get the plugin from when it was really created earlier
                    var instance = createdExtension && createdExtension.instance;
                    this._extensionList.push({ name: ExtensionName.rowDetailView, class: this.rowDetailViewExtension, addon: instance, instance: instance });
                }
            }
            // Row Move Manager Plugin
            if (this.sharedService.gridOptions.enableRowMoveManager) {
                if (this.rowMoveManagerExtension && this.rowMoveManagerExtension.register) {
                    var instance = this.rowMoveManagerExtension.register();
                    this._extensionList.push({ name: ExtensionName.rowMoveManager, class: this.rowMoveManagerExtension, addon: instance, instance: instance });
                }
            }
            // manually register other plugins
            if (this.sharedService.gridOptions.registerPlugins !== undefined) {
                if (Array.isArray(this.sharedService.gridOptions.registerPlugins)) {
                    this.sharedService.gridOptions.registerPlugins.forEach(function (plugin) {
                        var instance = _this.sharedService.grid.registerPlugin(plugin);
                        _this._extensionList.push({ name: ExtensionName.noname, class: null, addon: instance, instance: instance });
                    });
                }
                else {
                    this.sharedService.grid.registerPlugin(this.sharedService.gridOptions.registerPlugins);
                    var plugin = this.sharedService.gridOptions.registerPlugins;
                    var instance = this.sharedService.grid.registerPlugin(plugin);
                    this._extensionList.push({ name: ExtensionName.noname, class: null, addon: instance, instance: instance });
                }
            }
        }
    };
    /**
     * Bind/Create certain plugins before the Grid creation, else they might behave oddly.
     * Mostly because the column definitions might change after the grid creation
     * @param columnDefinitions
     * @param options
     */
    ExtensionService.prototype.createExtensionsBeforeGridCreation = function (columnDefinitions, options) {
        if (options.enableCheckboxSelector) {
            if (!this.getCreatedExtensionByName(ExtensionName.checkboxSelector)) {
                var checkboxInstance = this.checkboxSelectorExtension.create(columnDefinitions, options);
                this._extensionCreatedList.push({ name: ExtensionName.checkboxSelector, instance: checkboxInstance });
            }
        }
        if (options.enableRowDetailView) {
            if (!this.getCreatedExtensionByName(ExtensionName.rowDetailView)) {
                var rowDetailInstance = this.rowDetailViewExtension.create(columnDefinitions, options);
                this._extensionCreatedList.push({ name: ExtensionName.rowDetailView, instance: rowDetailInstance });
            }
        }
        if (options.enableDraggableGrouping) {
            if (!this.getCreatedExtensionByName(ExtensionName.rowDetailView)) {
                var draggableInstance = this.draggableGroupingExtension.create(options);
                options.enableColumnReorder = draggableInstance.getSetupColumnReorder;
                this._extensionCreatedList.push({ name: ExtensionName.draggableGrouping, instance: draggableInstance });
            }
        }
    };
    /** Hide a column from the grid */
    ExtensionService.prototype.hideColumn = function (column) {
        if (this.sharedService && this.sharedService.grid && this.sharedService.grid.getColumns && this.sharedService.grid.setColumns) {
            var columnIndex = this.sharedService.grid.getColumnIndex(column.id);
            this.sharedService.visibleColumns = this.removeColumnByIndex(this.sharedService.grid.getColumns(), columnIndex);
            this.sharedService.grid.setColumns(this.sharedService.visibleColumns);
        }
    };
    /** Refresh the dataset through the Backend Service */
    ExtensionService.prototype.refreshBackendDataset = function (gridOptions) {
        this.gridMenuExtension.refreshBackendDataset(gridOptions);
    };
    /**
     * Remove a column from the grid by it's index in the grid
     * @param columns input
     * @param index
     */
    ExtensionService.prototype.removeColumnByIndex = function (columns, index) {
        if (Array.isArray(columns)) {
            return columns.filter(function (el, i) { return index !== i; });
        }
        return columns;
    };
    /** Translate the Cell Menu titles, we need to loop through all column definition to re-translate them */
    ExtensionService.prototype.translateCellMenu = function () {
        if (this.cellMenuExtension && this.cellMenuExtension.translateCellMenu) {
            this.cellMenuExtension.translateCellMenu();
        }
    };
    /** Translate the Column Picker and it's last 2 checkboxes */
    ExtensionService.prototype.translateColumnPicker = function () {
        if (this.columnPickerExtension && this.columnPickerExtension.translateColumnPicker) {
            this.columnPickerExtension.translateColumnPicker();
        }
    };
    /** Translate the Context Menu titles, we need to loop through all column definition to re-translate them */
    ExtensionService.prototype.translateContextMenu = function () {
        if (this.contextMenuExtension && this.contextMenuExtension.translateContextMenu) {
            this.contextMenuExtension.translateContextMenu();
        }
    };
    /**
     * Translate the Header Menu titles, we need to loop through all column definition to re-translate them
     */
    ExtensionService.prototype.translateGridMenu = function () {
        if (this.gridMenuExtension && this.gridMenuExtension.translateGridMenu) {
            this.gridMenuExtension.translateGridMenu();
        }
    };
    /**
     * Translate the Header Menu titles, we need to loop through all column definition to re-translate them
     */
    ExtensionService.prototype.translateHeaderMenu = function () {
        if (this.headerMenuExtension && this.headerMenuExtension.translateHeaderMenu) {
            this.headerMenuExtension.translateHeaderMenu();
        }
    };
    /**
     * Translate manually the header titles.
     * We could optionally pass a locale (that will change currently loaded locale), else it will use current locale
     * @param locale to use
     * @param new column definitions (optional)
     */
    ExtensionService.prototype.translateColumnHeaders = function (locale, newColumnDefinitions) {
        if (this.sharedService && this.sharedService.gridOptions && this.sharedService.gridOptions.enableTranslate && (!this.translate || !this.translate.instant)) {
            throw new Error('[Angular-Slickgrid] requires "ngx-translate" to be installed and configured when the grid option "enableTranslate" is enabled.');
        }
        if (locale) {
            this.translate.use(locale);
        }
        var columnDefinitions = newColumnDefinitions;
        if (!columnDefinitions) {
            columnDefinitions = this.sharedService.columnDefinitions;
        }
        // eventually deprecate the "headerKey" and use only the "nameKey"
        this.translateItems(columnDefinitions, 'headerKey', 'name');
        this.translateItems(this.sharedService.allColumns, 'headerKey', 'name');
        this.translateItems(columnDefinitions, 'nameKey', 'name');
        this.translateItems(this.sharedService.allColumns, 'nameKey', 'name');
        // re-render the column headers
        this.renderColumnHeaders(columnDefinitions);
        this.gridMenuExtension.translateGridMenu();
    };
    /**
     * Render (or re-render) the column headers from column definitions.
     * calling setColumns() will trigger a grid re-render
     */
    ExtensionService.prototype.renderColumnHeaders = function (newColumnDefinitions) {
        var collection = newColumnDefinitions;
        if (!collection) {
            collection = this.sharedService.columnDefinitions;
        }
        if (Array.isArray(collection) && this.sharedService.grid && this.sharedService.grid.setColumns) {
            if (collection.length > this.sharedService.allColumns.length) {
                this.sharedService.allColumns = collection;
            }
            this.sharedService.grid.setColumns(collection);
        }
        // dispose of previous Column Picker instance, then re-register it and don't forget to overwrite previous instance ref
        if (this.sharedService.gridOptions.enableColumnPicker) {
            this.columnPickerExtension.dispose();
            var instance = this.columnPickerExtension.register();
            var extension = this.getExtensionByName(ExtensionName.columnPicker);
            if (extension) {
                extension.addon = instance;
                extension.instance = instance;
            }
        }
        // dispose of previous Grid Menu instance, then re-register it and don't forget to overwrite previous instance ref
        if (this.sharedService.gridOptions.enableGridMenu) {
            this.gridMenuExtension.dispose();
            var instance = this.gridMenuExtension.register();
            var extension = this.getExtensionByName(ExtensionName.gridMenu);
            if (extension) {
                extension.addon = instance;
                extension.instance = instance;
            }
        }
    };
    //
    // private functions
    // -------------------
    /**
     * Get an Extension that was created by calling its "create" method (there are only 3 extensions which uses this method)
     *  @param name
     */
    ExtensionService.prototype.getCreatedExtensionByName = function (name) {
        return Array.isArray(this._extensionCreatedList) && this._extensionCreatedList.find(function (p) { return p.name === name; });
    };
    /** Translate an array of items from an input key and assign translated value to the output key */
    ExtensionService.prototype.translateItems = function (items, inputKey, outputKey) {
        var e_1, _a;
        if (this.sharedService.gridOptions && this.sharedService.gridOptions.enableTranslate && (!this.translate || !this.translate.instant)) {
            throw new Error('[Angular-Slickgrid] requires "ngx-translate" to be installed and configured when the grid option "enableTranslate" is enabled.');
        }
        if (Array.isArray(items)) {
            try {
                for (var items_1 = tslib_1.__values(items), items_1_1 = items_1.next(); !items_1_1.done; items_1_1 = items_1.next()) {
                    var item = items_1_1.value;
                    if (item[inputKey]) {
                        item[outputKey] = this.translate && this.translate.currentLang && this.translate.instant(item[inputKey]);
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (items_1_1 && !items_1_1.done && (_a = items_1.return)) _a.call(items_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
    };
    ExtensionService = tslib_1.__decorate([
        Injectable(),
        tslib_1.__param(15, Optional()),
        tslib_1.__metadata("design:paramtypes", [AutoTooltipExtension,
            CellExternalCopyManagerExtension,
            CellMenuExtension,
            CheckboxSelectorExtension,
            ColumnPickerExtension,
            ContextMenuExtension,
            DraggableGroupingExtension,
            GridMenuExtension,
            GroupItemMetaProviderExtension,
            HeaderButtonExtension,
            HeaderMenuExtension,
            RowDetailViewExtension,
            RowMoveManagerExtension,
            RowSelectionExtension,
            SharedService,
            TranslateService])
    ], ExtensionService);
    return ExtensionService;
}());
export { ExtensionService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXh0ZW5zaW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLXNsaWNrZ3JpZC8iLCJzb3VyY2VzIjpbImFwcC9tb2R1bGVzL2FuZ3VsYXItc2xpY2tncmlkL3NlcnZpY2VzL2V4dGVuc2lvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxpREFBaUQ7QUFDakQsT0FBTyw0Q0FBNEMsQ0FBQztBQUNwRCxPQUFPLDJDQUEyQyxDQUFDO0FBQ25ELE9BQU8sNENBQTRDLENBQUM7QUFFcEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdkQsT0FBTyxFQUdMLGFBQWEsR0FFZCxNQUFNLGlCQUFpQixDQUFDO0FBQ3pCLE9BQU8sRUFDTCxvQkFBb0IsRUFDcEIsZ0NBQWdDLEVBQ2hDLGlCQUFpQixFQUNqQix5QkFBeUIsRUFDekIscUJBQXFCLEVBQ3JCLG9CQUFvQixFQUNwQiwwQkFBMEIsRUFDMUIsaUJBQWlCLEVBQ2pCLDhCQUE4QixFQUM5QixxQkFBcUIsRUFDckIsbUJBQW1CLEVBQ25CLHNCQUFzQixFQUN0Qix1QkFBdUIsRUFDdkIscUJBQXFCLEdBQ3RCLE1BQU0scUJBQXFCLENBQUM7QUFDN0IsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBR2pEO0lBSUUsMEJBQ1Usb0JBQTBDLEVBQzFDLHlCQUEyRCxFQUMzRCxpQkFBb0MsRUFDcEMseUJBQW9ELEVBQ3BELHFCQUE0QyxFQUM1QyxvQkFBMEMsRUFDMUMsMEJBQXNELEVBQ3RELGlCQUFvQyxFQUNwQyxzQkFBc0QsRUFDdEQscUJBQTRDLEVBQzVDLG1CQUF3QyxFQUN4QyxzQkFBOEMsRUFDOUMsdUJBQWdELEVBQ2hELHFCQUE0QyxFQUM1QyxhQUE0QixFQUNoQixTQUEyQjtRQWZ2Qyx5QkFBb0IsR0FBcEIsb0JBQW9C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QkFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbXBvcnQgY29tbW9uIDNyZCBwYXJ0eSBTbGlja0dyaWQgcGx1Z2lucy9saWJzXHJcbmltcG9ydCAnc2xpY2tncmlkL3BsdWdpbnMvc2xpY2suY2VsbHJhbmdlZGVjb3JhdG9yJztcclxuaW1wb3J0ICdzbGlja2dyaWQvcGx1Z2lucy9zbGljay5jZWxscmFuZ2VzZWxlY3Rvcic7XHJcbmltcG9ydCAnc2xpY2tncmlkL3BsdWdpbnMvc2xpY2suY2VsbHNlbGVjdGlvbm1vZGVsJztcclxuXHJcbmltcG9ydCB7IEluamVjdGFibGUsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcclxuaW1wb3J0IHtcclxuICBDb2x1bW4sXHJcbiAgRXh0ZW5zaW9uTW9kZWwsXHJcbiAgRXh0ZW5zaW9uTmFtZSxcclxuICBHcmlkT3B0aW9uLFxyXG59IGZyb20gJy4uL21vZGVscy9pbmRleCc7XHJcbmltcG9ydCB7XHJcbiAgQXV0b1Rvb2x0aXBFeHRlbnNpb24sXHJcbiAgQ2VsbEV4dGVybmFsQ29weU1hbmFnZXJFeHRlbnNpb24sXHJcbiAgQ2VsbE1lbnVFeHRlbnNpb24sXHJcbiAgQ2hlY2tib3hTZWxlY3RvckV4dGVuc2lvbixcclxuICBDb2x1bW5QaWNrZXJFeHRlbnNpb24sXHJcbiAgQ29udGV4dE1lbnVFeHRlbnNpb24sXHJcbiAgRHJhZ2dhYmxlR3JvdXBpbmdFeHRlbnNpb24sXHJcbiAgR3JpZE1lbnVFeHRlbnNpb24sXHJcbiAgR3JvdXBJdGVtTWV0YVByb3ZpZGVyRXh0ZW5zaW9uLFxyXG4gIEhlYWRlckJ1dHRvbkV4dGVuc2lvbixcclxuICBIZWFkZXJNZW51RXh0ZW5zaW9uLFxyXG4gIFJvd0RldGFpbFZpZXdFeHRlbnNpb24sXHJcbiAgUm93TW92ZU1hbmFnZXJFeHRlbnNpb24sXHJcbiAgUm93U2VsZWN0aW9uRXh0ZW5zaW9uLFxyXG59IGZyb20gJy4uL2V4dGVuc2lvbnMvaW5kZXgnO1xyXG5pbXBvcnQgeyBTaGFyZWRTZXJ2aWNlIH0gZnJvbSAnLi9zaGFyZWQuc2VydmljZSc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBFeHRlbnNpb25TZXJ2aWNlIHtcclxuICBwcml2YXRlIF9leHRlbnNpb25DcmVhdGVkTGlzdDogYW55W10gPSBbXTtcclxuICBwcml2YXRlIF9leHRlbnNpb25MaXN0OiBFeHRlbnNpb25Nb2RlbFtdID0gW107XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBhdXRvVG9vbHRpcEV4dGVuc2lvbjogQXV0b1Rvb2x0aXBFeHRlbnNpb24sXHJcbiAgICBwcml2YXRlIGNlbGxFeHRlcm5hbENvcHlFeHRlbnNpb246IENlbGxFeHRlcm5hbENvcHlNYW5hZ2VyRXh0ZW5zaW9uLFxyXG4gICAgcHJpdmF0ZSBjZWxsTWVudUV4dGVuc2lvbjogQ2VsbE1lbnVFeHRlbnNpb24sXHJcbiAgICBwcml2YXRlIGNoZWNrYm94U2VsZWN0b3JFeHRlbnNpb246IENoZWNrYm94U2VsZWN0b3JFeHRlbnNpb24sXHJcbiAgICBwcml2YXRlIGNvbHVtblBpY2tlckV4dGVuc2lvbjogQ29sdW1uUGlja2VyRXh0ZW5zaW9uLFxyXG4gICAgcHJpdmF0ZSBjb250ZXh0TWVudUV4dGVuc2lvbjogQ29udGV4dE1lbnVFeHRlbnNpb24sXHJcbiAgICBwcml2YXRlIGRyYWdnYWJsZUdyb3VwaW5nRXh0ZW5zaW9uOiBEcmFnZ2FibGVHcm91cGluZ0V4dGVuc2lvbixcclxuICAgIHByaXZhdGUgZ3JpZE1lbnVFeHRlbnNpb246IEdyaWRNZW51RXh0ZW5zaW9uLFxyXG4gICAgcHJpdmF0ZSBncm91cEl0ZW1NZXRhRXh0ZW5zaW9uOiBHcm91cEl0ZW1NZXRhUHJvdmlkZXJFeHRlbnNpb24sXHJcbiAgICBwcml2YXRlIGhlYWRlckJ1dHRvbkV4dGVuc2lvbjogSGVhZGVyQnV0dG9uRXh0ZW5zaW9uLFxyXG4gICAgcHJpdmF0ZSBoZWFkZXJNZW51RXh0ZW5zaW9uOiBIZWFkZXJNZW51RXh0ZW5zaW9uLFxyXG4gICAgcHJpdmF0ZSByb3dEZXRhaWxWaWV3RXh0ZW5zaW9uOiBSb3dEZXRhaWxWaWV3RXh0ZW5zaW9uLFxyXG4gICAgcHJpdmF0ZSByb3dNb3ZlTWFuYWdlckV4dGVuc2lvbjogUm93TW92ZU1hbmFnZXJFeHRlbnNpb24sXHJcbiAgICBwcml2YXRlIHJvd1NlbGVjdGlvbkV4dGVuc2lvbjogUm93U2VsZWN0aW9uRXh0ZW5zaW9uLFxyXG4gICAgcHJpdmF0ZSBzaGFyZWRTZXJ2aWNlOiBTaGFyZWRTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSB0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2UsXHJcbiAgKSB7IH1cclxuXHJcbiAgLyoqIERpc3Bvc2Ugb2YgYWxsIHRoZSBjb250cm9scyAmIHBsdWdpbnMgKi9cclxuICBkaXNwb3NlKCkge1xyXG4gICAgdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQgPSBudWxsO1xyXG4gICAgdGhpcy5zaGFyZWRTZXJ2aWNlLnZpc2libGVDb2x1bW5zID0gW107XHJcblxyXG4gICAgLy8gZGlzcG9zZSBvZiBlYWNoIGNvbnRyb2wvcGx1Z2luICYgcmVzZXQgdGhlIGxpc3RcclxuICAgIHRoaXMuX2V4dGVuc2lvbkxpc3QuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICBpZiAoaXRlbSAmJiBpdGVtLmNsYXNzICYmIGl0ZW0uY2xhc3MuZGlzcG9zZSkge1xyXG4gICAgICAgIGl0ZW0uY2xhc3MuZGlzcG9zZSgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX2V4dGVuc2lvbkxpc3QgPSBbXTtcclxuICB9XHJcblxyXG4gIC8qKiBHZXQgYWxsIGNvbHVtbnMgKGluY2x1ZGVzIHZpc2libGUgYW5kIG5vbi12aXNpYmxlKSAqL1xyXG4gIGdldEFsbENvbHVtbnMoKTogQ29sdW1uW10ge1xyXG4gICAgcmV0dXJuIHRoaXMuc2hhcmVkU2VydmljZS5hbGxDb2x1bW5zIHx8IFtdO1xyXG4gIH1cclxuXHJcbiAgLyoqIEdldCBvbmx5IHZpc2libGUgY29sdW1ucyAqL1xyXG4gIGdldFZpc2libGVDb2x1bW5zKCk6IENvbHVtbltdIHtcclxuICAgIHJldHVybiB0aGlzLnNoYXJlZFNlcnZpY2UudmlzaWJsZUNvbHVtbnMgfHwgW107XHJcbiAgfVxyXG5cclxuICAvKiogR2V0IGFsbCBFeHRlbnNpb25zICovXHJcbiAgZ2V0QWxsRXh0ZW5zaW9ucygpOiBFeHRlbnNpb25Nb2RlbFtdIHtcclxuICAgIHJldHVybiB0aGlzLl9leHRlbnNpb25MaXN0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGFuIEV4dGVuc2lvbiBieSBpdCdzIG5hbWVcclxuICAgKiAgQHBhcmFtIG5hbWVcclxuICAgKi9cclxuICBnZXRFeHRlbnNpb25CeU5hbWUobmFtZTogRXh0ZW5zaW9uTmFtZSk6IEV4dGVuc2lvbk1vZGVsIHwgdW5kZWZpbmVkIHtcclxuICAgIHJldHVybiBBcnJheS5pc0FycmF5KHRoaXMuX2V4dGVuc2lvbkxpc3QpICYmIHRoaXMuX2V4dGVuc2lvbkxpc3QuZmluZCgocCkgPT4gcC5uYW1lID09PSBuYW1lKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgaW5zdGFuY2Ugb2YgdGhlIFNsaWNrR3JpZCBhZGRvbiAoY29udHJvbCBvciBwbHVnaW4pLlxyXG4gICAqIFRoaXMgaXMgdGhlIHJhdyBhZGRvbiBjb21pbmcgZGlyZWN0bHkgZnJvbSBTbGlja0dyaWQgaXRzZWxmLCBub3QgdG8gY29uZnVzZSB3aXRoIEFuZ3VsYXItU2xpY2tncmlkIGV4dGVuc2lvblxyXG4gICAqICBAcGFyYW0gbmFtZVxyXG4gICAqL1xyXG4gIGdldFNsaWNrZ3JpZEFkZG9uSW5zdGFuY2UobmFtZTogRXh0ZW5zaW9uTmFtZSk6IGFueSB7XHJcbiAgICBjb25zdCBleHRlbnNpb24gPSB0aGlzLmdldEV4dGVuc2lvbkJ5TmFtZShuYW1lKTtcclxuICAgIGlmIChleHRlbnNpb24gJiYgZXh0ZW5zaW9uLmNsYXNzICYmIChleHRlbnNpb24uaW5zdGFuY2UgfHwgZXh0ZW5zaW9uLmFkZG9uKSkge1xyXG4gICAgICBpZiAoZXh0ZW5zaW9uLmNsYXNzICYmIGV4dGVuc2lvbi5jbGFzcy5nZXRBZGRvbkluc3RhbmNlKSB7XHJcbiAgICAgICAgcmV0dXJuIGV4dGVuc2lvbi5jbGFzcy5nZXRBZGRvbkluc3RhbmNlKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGV4dGVuc2lvbi5pbnN0YW5jZTtcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqIEF1dG8tcmVzaXplIGFsbCB0aGUgY29sdW1uIGluIHRoZSBncmlkIHRvIGZpdCB0aGUgZ3JpZCB3aWR0aCAqL1xyXG4gIGF1dG9SZXNpemVDb2x1bW5zKCkge1xyXG4gICAgdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQuYXV0b3NpemVDb2x1bW5zKCk7XHJcbiAgfVxyXG5cclxuICAvKiogQmluZC9DcmVhdGUgZGlmZmVyZW50IENvbnRyb2xzIG9yIFBsdWdpbnMgYWZ0ZXIgdGhlIEdyaWQgaXMgY3JlYXRlZCAqL1xyXG4gIGJpbmREaWZmZXJlbnRFeHRlbnNpb25zKCkge1xyXG4gICAgaWYgKHRoaXMuc2hhcmVkU2VydmljZSAmJiB0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMpIHtcclxuICAgICAgLy8gbWFrZSBzdXJlIGFsbCBjb2x1bW5zIGFyZSB0cmFuc2xhdGVkIGJlZm9yZSBjcmVhdGluZyBDb2x1bW5QaWNrZXIvR3JpZE1lbnUgQ29udHJvbHNcclxuICAgICAgLy8gdGhpcyBpcyB0byBhdm9pZCBoYXZpbmcgaGlkZGVuIGNvbHVtbnMgbm90IGJlaW5nIHRyYW5zbGF0ZWQgb24gZmlyc3QgbG9hZFxyXG4gICAgICBpZiAodGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLmVuYWJsZVRyYW5zbGF0ZSkge1xyXG4gICAgICAgIC8vIGV2ZW50dWFsbHkgZGVwcmVjYXRlIHRoZSBcImhlYWRlcktleVwiIGFuZCB1c2Ugb25seSB0aGUgXCJuYW1lS2V5XCJcclxuICAgICAgICB0aGlzLnRyYW5zbGF0ZUl0ZW1zKHRoaXMuc2hhcmVkU2VydmljZS5hbGxDb2x1bW5zLCAnaGVhZGVyS2V5JywgJ25hbWUnKTtcclxuICAgICAgICB0aGlzLnRyYW5zbGF0ZUl0ZW1zKHRoaXMuc2hhcmVkU2VydmljZS5hbGxDb2x1bW5zLCAnbmFtZUtleScsICduYW1lJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEF1dG8gVG9vbHRpcCBQbHVnaW5cclxuICAgICAgaWYgKHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVBdXRvVG9vbHRpcCkge1xyXG4gICAgICAgIGlmICh0aGlzLmF1dG9Ub29sdGlwRXh0ZW5zaW9uICYmIHRoaXMuYXV0b1Rvb2x0aXBFeHRlbnNpb24ucmVnaXN0ZXIpIHtcclxuICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5hdXRvVG9vbHRpcEV4dGVuc2lvbi5yZWdpc3RlcigpO1xyXG4gICAgICAgICAgdGhpcy5fZXh0ZW5zaW9uTGlzdC5wdXNoKHsgbmFtZTogRXh0ZW5zaW9uTmFtZS5hdXRvVG9vbHRpcCwgY2xhc3M6IHRoaXMuYXV0b1Rvb2x0aXBFeHRlbnNpb24sIGFkZG9uOiBpbnN0YW5jZSwgaW5zdGFuY2UgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBDZWxsIEV4dGVybmFsIENvcHkgTWFuYWdlciBQbHVnaW4gKEV4Y2VsIExpa2UpXHJcbiAgICAgIGlmICh0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlRXhjZWxDb3B5QnVmZmVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2VsbEV4dGVybmFsQ29weUV4dGVuc2lvbiAmJiB0aGlzLmNlbGxFeHRlcm5hbENvcHlFeHRlbnNpb24ucmVnaXN0ZXIpIHtcclxuICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5jZWxsRXh0ZXJuYWxDb3B5RXh0ZW5zaW9uLnJlZ2lzdGVyKCk7XHJcbiAgICAgICAgICB0aGlzLl9leHRlbnNpb25MaXN0LnB1c2goeyBuYW1lOiBFeHRlbnNpb25OYW1lLmNlbGxFeHRlcm5hbENvcHlNYW5hZ2VyLCBjbGFzczogdGhpcy5jZWxsRXh0ZXJuYWxDb3B5RXh0ZW5zaW9uLCBhZGRvbjogaW5zdGFuY2UsIGluc3RhbmNlIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gKEFjdGlvbikgQ2VsbCBNZW51IFBsdWdpblxyXG4gICAgICBpZiAodGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLmVuYWJsZUNlbGxNZW51KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2VsbE1lbnVFeHRlbnNpb24gJiYgdGhpcy5jZWxsTWVudUV4dGVuc2lvbi5yZWdpc3Rlcikge1xyXG4gICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmNlbGxNZW51RXh0ZW5zaW9uLnJlZ2lzdGVyKCk7XHJcbiAgICAgICAgICB0aGlzLl9leHRlbnNpb25MaXN0LnB1c2goeyBuYW1lOiBFeHRlbnNpb25OYW1lLmNlbGxNZW51LCBjbGFzczogdGhpcy5jZWxsTWVudUV4dGVuc2lvbiwgYWRkb246IGluc3RhbmNlLCBpbnN0YW5jZSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFJvdyBTZWxlY3Rpb24gUGx1Z2luXHJcbiAgICAgIC8vIHRoaXMgZXh0ZW5zaW9uIHNob3VsZCBiZSByZWdpc3RlcmVkIEJFRk9SRSB0aGUgQ2hlY2tib3ggU2VsZWN0b3IgJiBSb3cgRGV0YWlsIHNpbmNlIGl0IGNhbiBiZSB1c2UgYnkgdGhlc2UgMiBwbHVnaW5zXHJcbiAgICAgIGlmICghdGhpcy5nZXRFeHRlbnNpb25CeU5hbWUoRXh0ZW5zaW9uTmFtZS5yb3dTZWxlY3Rpb24pICYmICh0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlUm93U2VsZWN0aW9uIHx8IHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVDaGVja2JveFNlbGVjdG9yIHx8IHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVSb3dEZXRhaWxWaWV3KSkge1xyXG4gICAgICAgIGlmICh0aGlzLnJvd1NlbGVjdGlvbkV4dGVuc2lvbiAmJiB0aGlzLnJvd1NlbGVjdGlvbkV4dGVuc2lvbi5yZWdpc3Rlcikge1xyXG4gICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLnJvd1NlbGVjdGlvbkV4dGVuc2lvbi5yZWdpc3RlcigpO1xyXG4gICAgICAgICAgdGhpcy5fZXh0ZW5zaW9uTGlzdC5wdXNoKHsgbmFtZTogRXh0ZW5zaW9uTmFtZS5yb3dTZWxlY3Rpb24sIGNsYXNzOiB0aGlzLnJvd1NlbGVjdGlvbkV4dGVuc2lvbiwgYWRkb246IGluc3RhbmNlLCBpbnN0YW5jZSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENoZWNrYm94IFNlbGVjdG9yIFBsdWdpblxyXG4gICAgICBpZiAodGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLmVuYWJsZUNoZWNrYm94U2VsZWN0b3IpIHtcclxuICAgICAgICBpZiAodGhpcy5jaGVja2JveFNlbGVjdG9yRXh0ZW5zaW9uICYmIHRoaXMuY2hlY2tib3hTZWxlY3RvckV4dGVuc2lvbi5yZWdpc3Rlcikge1xyXG4gICAgICAgICAgY29uc3Qgcm93U2VsZWN0aW9uRXh0ZW5zaW9uID0gdGhpcy5nZXRFeHRlbnNpb25CeU5hbWUoRXh0ZW5zaW9uTmFtZS5yb3dTZWxlY3Rpb24pO1xyXG4gICAgICAgICAgdGhpcy5jaGVja2JveFNlbGVjdG9yRXh0ZW5zaW9uLnJlZ2lzdGVyKHJvd1NlbGVjdGlvbkV4dGVuc2lvbik7XHJcbiAgICAgICAgICBjb25zdCBjcmVhdGVkRXh0ZW5zaW9uID0gdGhpcy5nZXRDcmVhdGVkRXh0ZW5zaW9uQnlOYW1lKEV4dGVuc2lvbk5hbWUuY2hlY2tib3hTZWxlY3Rvcik7IC8vIGdldCB0aGUgaW5zdGFuY2UgZnJvbSB3aGVuIGl0IHdhcyByZWFsbHkgY3JlYXRlZCBlYXJsaWVyXHJcbiAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IGNyZWF0ZWRFeHRlbnNpb24gJiYgY3JlYXRlZEV4dGVuc2lvbi5pbnN0YW5jZTtcclxuICAgICAgICAgIHRoaXMuX2V4dGVuc2lvbkxpc3QucHVzaCh7IG5hbWU6IEV4dGVuc2lvbk5hbWUuY2hlY2tib3hTZWxlY3RvciwgY2xhc3M6IHRoaXMuY2hlY2tib3hTZWxlY3RvckV4dGVuc2lvbiwgYWRkb246IGluc3RhbmNlLCBpbnN0YW5jZSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENvbHVtbiBQaWNrZXIgQ29udHJvbFxyXG4gICAgICBpZiAodGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLmVuYWJsZUNvbHVtblBpY2tlcikge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbHVtblBpY2tlckV4dGVuc2lvbiAmJiB0aGlzLmNvbHVtblBpY2tlckV4dGVuc2lvbi5yZWdpc3Rlcikge1xyXG4gICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmNvbHVtblBpY2tlckV4dGVuc2lvbi5yZWdpc3RlcigpO1xyXG4gICAgICAgICAgdGhpcy5fZXh0ZW5zaW9uTGlzdC5wdXNoKHsgbmFtZTogRXh0ZW5zaW9uTmFtZS5jb2x1bW5QaWNrZXIsIGNsYXNzOiB0aGlzLmNvbHVtblBpY2tlckV4dGVuc2lvbiwgYWRkb246IGluc3RhbmNlLCBpbnN0YW5jZSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENvbnRleHQgTWVudSBDb250cm9sXHJcbiAgICAgIGlmICh0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlQ29udGV4dE1lbnUpIHtcclxuICAgICAgICBpZiAodGhpcy5jb250ZXh0TWVudUV4dGVuc2lvbiAmJiB0aGlzLmNvbnRleHRNZW51RXh0ZW5zaW9uLnJlZ2lzdGVyKSB7XHJcbiAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuY29udGV4dE1lbnVFeHRlbnNpb24ucmVnaXN0ZXIoKTtcclxuICAgICAgICAgIHRoaXMuX2V4dGVuc2lvbkxpc3QucHVzaCh7IG5hbWU6IEV4dGVuc2lvbk5hbWUuY29udGV4dE1lbnUsIGNsYXNzOiB0aGlzLmNvbnRleHRNZW51RXh0ZW5zaW9uLCBhZGRvbjogaW5zdGFuY2UsIGluc3RhbmNlIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gRHJhZ2dhYmxlIEdyb3VwaW5nIFBsdWdpblxyXG4gICAgICBpZiAodGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLmVuYWJsZURyYWdnYWJsZUdyb3VwaW5nKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZHJhZ2dhYmxlR3JvdXBpbmdFeHRlbnNpb24gJiYgdGhpcy5kcmFnZ2FibGVHcm91cGluZ0V4dGVuc2lvbi5yZWdpc3Rlcikge1xyXG4gICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmRyYWdnYWJsZUdyb3VwaW5nRXh0ZW5zaW9uLnJlZ2lzdGVyKCk7XHJcbiAgICAgICAgICB0aGlzLl9leHRlbnNpb25MaXN0LnB1c2goeyBuYW1lOiBFeHRlbnNpb25OYW1lLmRyYWdnYWJsZUdyb3VwaW5nLCBjbGFzczogdGhpcy5kcmFnZ2FibGVHcm91cGluZ0V4dGVuc2lvbiwgYWRkb246IGluc3RhbmNlLCBpbnN0YW5jZSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEdyaWQgTWVudSBDb250cm9sXHJcbiAgICAgIGlmICh0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlR3JpZE1lbnUpIHtcclxuICAgICAgICBpZiAodGhpcy5ncmlkTWVudUV4dGVuc2lvbiAmJiB0aGlzLmdyaWRNZW51RXh0ZW5zaW9uLnJlZ2lzdGVyKSB7XHJcbiAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuZ3JpZE1lbnVFeHRlbnNpb24ucmVnaXN0ZXIoKTtcclxuICAgICAgICAgIHRoaXMuX2V4dGVuc2lvbkxpc3QucHVzaCh7IG5hbWU6IEV4dGVuc2lvbk5hbWUuZ3JpZE1lbnUsIGNsYXNzOiB0aGlzLmdyaWRNZW51RXh0ZW5zaW9uLCBhZGRvbjogaW5zdGFuY2UsIGluc3RhbmNlIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gR3JvdXBpbmcgUGx1Z2luXHJcbiAgICAgIC8vIHJlZ2lzdGVyIHRoZSBncm91cCBpdGVtIG1ldGFkYXRhIHByb3ZpZGVyIHRvIGFkZCBleHBhbmQvY29sbGFwc2UgZ3JvdXAgaGFuZGxlcnNcclxuICAgICAgaWYgKHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVEcmFnZ2FibGVHcm91cGluZyB8fCB0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlR3JvdXBpbmcpIHtcclxuICAgICAgICBpZiAodGhpcy5ncm91cEl0ZW1NZXRhRXh0ZW5zaW9uICYmIHRoaXMuZ3JvdXBJdGVtTWV0YUV4dGVuc2lvbi5yZWdpc3Rlcikge1xyXG4gICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmdyb3VwSXRlbU1ldGFFeHRlbnNpb24ucmVnaXN0ZXIoKTtcclxuICAgICAgICAgIHRoaXMuX2V4dGVuc2lvbkxpc3QucHVzaCh7IG5hbWU6IEV4dGVuc2lvbk5hbWUuZ3JvdXBJdGVtTWV0YVByb3ZpZGVyLCBjbGFzczogdGhpcy5ncm91cEl0ZW1NZXRhRXh0ZW5zaW9uLCBhZGRvbjogaW5zdGFuY2UsIGluc3RhbmNlIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gSGVhZGVyIEJ1dHRvbiBQbHVnaW5cclxuICAgICAgaWYgKHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVIZWFkZXJCdXR0b24pIHtcclxuICAgICAgICBpZiAodGhpcy5oZWFkZXJCdXR0b25FeHRlbnNpb24gJiYgdGhpcy5oZWFkZXJCdXR0b25FeHRlbnNpb24ucmVnaXN0ZXIpIHtcclxuICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5oZWFkZXJCdXR0b25FeHRlbnNpb24ucmVnaXN0ZXIoKTtcclxuICAgICAgICAgIHRoaXMuX2V4dGVuc2lvbkxpc3QucHVzaCh7IG5hbWU6IEV4dGVuc2lvbk5hbWUuaGVhZGVyQnV0dG9uLCBjbGFzczogdGhpcy5oZWFkZXJCdXR0b25FeHRlbnNpb24sIGFkZG9uOiBpbnN0YW5jZSwgaW5zdGFuY2UgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBIZWFkZXIgTWVudSBQbHVnaW5cclxuICAgICAgaWYgKHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVIZWFkZXJNZW51KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaGVhZGVyTWVudUV4dGVuc2lvbiAmJiB0aGlzLmhlYWRlck1lbnVFeHRlbnNpb24ucmVnaXN0ZXIpIHtcclxuICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5oZWFkZXJNZW51RXh0ZW5zaW9uLnJlZ2lzdGVyKCk7XHJcbiAgICAgICAgICB0aGlzLl9leHRlbnNpb25MaXN0LnB1c2goeyBuYW1lOiBFeHRlbnNpb25OYW1lLmhlYWRlck1lbnUsIGNsYXNzOiB0aGlzLmhlYWRlck1lbnVFeHRlbnNpb24sIGFkZG9uOiBpbnN0YW5jZSwgaW5zdGFuY2UgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBSb3cgRGV0YWlsIFZpZXcgUGx1Z2luXHJcbiAgICAgIGlmICh0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlUm93RGV0YWlsVmlldykge1xyXG4gICAgICAgIGlmICh0aGlzLnJvd0RldGFpbFZpZXdFeHRlbnNpb24gJiYgdGhpcy5yb3dEZXRhaWxWaWV3RXh0ZW5zaW9uLnJlZ2lzdGVyKSB7XHJcbiAgICAgICAgICBjb25zdCByb3dTZWxlY3Rpb25FeHRlbnNpb24gPSB0aGlzLmdldEV4dGVuc2lvbkJ5TmFtZShFeHRlbnNpb25OYW1lLnJvd1NlbGVjdGlvbik7XHJcbiAgICAgICAgICB0aGlzLnJvd0RldGFpbFZpZXdFeHRlbnNpb24ucmVnaXN0ZXIocm93U2VsZWN0aW9uRXh0ZW5zaW9uKTtcclxuICAgICAgICAgIGNvbnN0IGNyZWF0ZWRFeHRlbnNpb24gPSB0aGlzLmdldENyZWF0ZWRFeHRlbnNpb25CeU5hbWUoRXh0ZW5zaW9uTmFtZS5yb3dEZXRhaWxWaWV3KTsgLy8gZ2V0IHRoZSBwbHVnaW4gZnJvbSB3aGVuIGl0IHdhcyByZWFsbHkgY3JlYXRlZCBlYXJsaWVyXHJcbiAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IGNyZWF0ZWRFeHRlbnNpb24gJiYgY3JlYXRlZEV4dGVuc2lvbi5pbnN0YW5jZTtcclxuICAgICAgICAgIHRoaXMuX2V4dGVuc2lvbkxpc3QucHVzaCh7IG5hbWU6IEV4dGVuc2lvbk5hbWUucm93RGV0YWlsVmlldywgY2xhc3M6IHRoaXMucm93RGV0YWlsVmlld0V4dGVuc2lvbiwgYWRkb246IGluc3RhbmNlLCBpbnN0YW5jZSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFJvdyBNb3ZlIE1hbmFnZXIgUGx1Z2luXHJcbiAgICAgIGlmICh0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlUm93TW92ZU1hbmFnZXIpIHtcclxuICAgICAgICBpZiAodGhpcy5yb3dNb3ZlTWFuYWdlckV4dGVuc2lvbiAmJiB0aGlzLnJvd01vdmVNYW5hZ2VyRXh0ZW5zaW9uLnJlZ2lzdGVyKSB7XHJcbiAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMucm93TW92ZU1hbmFnZXJFeHRlbnNpb24ucmVnaXN0ZXIoKTtcclxuICAgICAgICAgIHRoaXMuX2V4dGVuc2lvbkxpc3QucHVzaCh7IG5hbWU6IEV4dGVuc2lvbk5hbWUucm93TW92ZU1hbmFnZXIsIGNsYXNzOiB0aGlzLnJvd01vdmVNYW5hZ2VyRXh0ZW5zaW9uLCBhZGRvbjogaW5zdGFuY2UsIGluc3RhbmNlIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gbWFudWFsbHkgcmVnaXN0ZXIgb3RoZXIgcGx1Z2luc1xyXG4gICAgICBpZiAodGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLnJlZ2lzdGVyUGx1Z2lucyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLnJlZ2lzdGVyUGx1Z2lucykpIHtcclxuICAgICAgICAgIHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5yZWdpc3RlclBsdWdpbnMuZm9yRWFjaCgocGx1Z2luKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQucmVnaXN0ZXJQbHVnaW4ocGx1Z2luKTtcclxuICAgICAgICAgICAgdGhpcy5fZXh0ZW5zaW9uTGlzdC5wdXNoKHsgbmFtZTogRXh0ZW5zaW9uTmFtZS5ub25hbWUsIGNsYXNzOiBudWxsLCBhZGRvbjogaW5zdGFuY2UsIGluc3RhbmNlIH0pO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuc2hhcmVkU2VydmljZS5ncmlkLnJlZ2lzdGVyUGx1Z2luKHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5yZWdpc3RlclBsdWdpbnMpO1xyXG4gICAgICAgICAgY29uc3QgcGx1Z2luID0gdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLnJlZ2lzdGVyUGx1Z2lucztcclxuICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQucmVnaXN0ZXJQbHVnaW4ocGx1Z2luKTtcclxuICAgICAgICAgIHRoaXMuX2V4dGVuc2lvbkxpc3QucHVzaCh7IG5hbWU6IEV4dGVuc2lvbk5hbWUubm9uYW1lLCBjbGFzczogbnVsbCwgYWRkb246IGluc3RhbmNlLCBpbnN0YW5jZSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEJpbmQvQ3JlYXRlIGNlcnRhaW4gcGx1Z2lucyBiZWZvcmUgdGhlIEdyaWQgY3JlYXRpb24sIGVsc2UgdGhleSBtaWdodCBiZWhhdmUgb2RkbHkuXHJcbiAgICogTW9zdGx5IGJlY2F1c2UgdGhlIGNvbHVtbiBkZWZpbml0aW9ucyBtaWdodCBjaGFuZ2UgYWZ0ZXIgdGhlIGdyaWQgY3JlYXRpb25cclxuICAgKiBAcGFyYW0gY29sdW1uRGVmaW5pdGlvbnNcclxuICAgKiBAcGFyYW0gb3B0aW9uc1xyXG4gICAqL1xyXG4gIGNyZWF0ZUV4dGVuc2lvbnNCZWZvcmVHcmlkQ3JlYXRpb24oY29sdW1uRGVmaW5pdGlvbnM6IENvbHVtbltdLCBvcHRpb25zOiBHcmlkT3B0aW9uKSB7XHJcbiAgICBpZiAob3B0aW9ucy5lbmFibGVDaGVja2JveFNlbGVjdG9yKSB7XHJcbiAgICAgIGlmICghdGhpcy5nZXRDcmVhdGVkRXh0ZW5zaW9uQnlOYW1lKEV4dGVuc2lvbk5hbWUuY2hlY2tib3hTZWxlY3RvcikpIHtcclxuICAgICAgICBjb25zdCBjaGVja2JveEluc3RhbmNlID0gdGhpcy5jaGVja2JveFNlbGVjdG9yRXh0ZW5zaW9uLmNyZWF0ZShjb2x1bW5EZWZpbml0aW9ucywgb3B0aW9ucyk7XHJcbiAgICAgICAgdGhpcy5fZXh0ZW5zaW9uQ3JlYXRlZExpc3QucHVzaCh7IG5hbWU6IEV4dGVuc2lvbk5hbWUuY2hlY2tib3hTZWxlY3RvciwgaW5zdGFuY2U6IGNoZWNrYm94SW5zdGFuY2UgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChvcHRpb25zLmVuYWJsZVJvd0RldGFpbFZpZXcpIHtcclxuICAgICAgaWYgKCF0aGlzLmdldENyZWF0ZWRFeHRlbnNpb25CeU5hbWUoRXh0ZW5zaW9uTmFtZS5yb3dEZXRhaWxWaWV3KSkge1xyXG4gICAgICAgIGNvbnN0IHJvd0RldGFpbEluc3RhbmNlID0gdGhpcy5yb3dEZXRhaWxWaWV3RXh0ZW5zaW9uLmNyZWF0ZShjb2x1bW5EZWZpbml0aW9ucywgb3B0aW9ucyk7XHJcbiAgICAgICAgdGhpcy5fZXh0ZW5zaW9uQ3JlYXRlZExpc3QucHVzaCh7IG5hbWU6IEV4dGVuc2lvbk5hbWUucm93RGV0YWlsVmlldywgaW5zdGFuY2U6IHJvd0RldGFpbEluc3RhbmNlIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAob3B0aW9ucy5lbmFibGVEcmFnZ2FibGVHcm91cGluZykge1xyXG4gICAgICBpZiAoIXRoaXMuZ2V0Q3JlYXRlZEV4dGVuc2lvbkJ5TmFtZShFeHRlbnNpb25OYW1lLnJvd0RldGFpbFZpZXcpKSB7XHJcbiAgICAgICAgY29uc3QgZHJhZ2dhYmxlSW5zdGFuY2UgPSB0aGlzLmRyYWdnYWJsZUdyb3VwaW5nRXh0ZW5zaW9uLmNyZWF0ZShvcHRpb25zKTtcclxuICAgICAgICBvcHRpb25zLmVuYWJsZUNvbHVtblJlb3JkZXIgPSBkcmFnZ2FibGVJbnN0YW5jZS5nZXRTZXR1cENvbHVtblJlb3JkZXI7XHJcbiAgICAgICAgdGhpcy5fZXh0ZW5zaW9uQ3JlYXRlZExpc3QucHVzaCh7IG5hbWU6IEV4dGVuc2lvbk5hbWUuZHJhZ2dhYmxlR3JvdXBpbmcsIGluc3RhbmNlOiBkcmFnZ2FibGVJbnN0YW5jZSB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqIEhpZGUgYSBjb2x1bW4gZnJvbSB0aGUgZ3JpZCAqL1xyXG4gIGhpZGVDb2x1bW4oY29sdW1uOiBDb2x1bW4pIHtcclxuICAgIGlmICh0aGlzLnNoYXJlZFNlcnZpY2UgJiYgdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQgJiYgdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQuZ2V0Q29sdW1ucyAmJiB0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZC5zZXRDb2x1bW5zKSB7XHJcbiAgICAgIGNvbnN0IGNvbHVtbkluZGV4ID0gdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQuZ2V0Q29sdW1uSW5kZXgoY29sdW1uLmlkKTtcclxuICAgICAgdGhpcy5zaGFyZWRTZXJ2aWNlLnZpc2libGVDb2x1bW5zID0gdGhpcy5yZW1vdmVDb2x1bW5CeUluZGV4KHRoaXMuc2hhcmVkU2VydmljZS5ncmlkLmdldENvbHVtbnMoKSwgY29sdW1uSW5kZXgpO1xyXG4gICAgICB0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZC5zZXRDb2x1bW5zKHRoaXMuc2hhcmVkU2VydmljZS52aXNpYmxlQ29sdW1ucyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKiogUmVmcmVzaCB0aGUgZGF0YXNldCB0aHJvdWdoIHRoZSBCYWNrZW5kIFNlcnZpY2UgKi9cclxuICByZWZyZXNoQmFja2VuZERhdGFzZXQoZ3JpZE9wdGlvbnM/OiBHcmlkT3B0aW9uKSB7XHJcbiAgICB0aGlzLmdyaWRNZW51RXh0ZW5zaW9uLnJlZnJlc2hCYWNrZW5kRGF0YXNldChncmlkT3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmUgYSBjb2x1bW4gZnJvbSB0aGUgZ3JpZCBieSBpdCdzIGluZGV4IGluIHRoZSBncmlkXHJcbiAgICogQHBhcmFtIGNvbHVtbnMgaW5wdXRcclxuICAgKiBAcGFyYW0gaW5kZXhcclxuICAgKi9cclxuICByZW1vdmVDb2x1bW5CeUluZGV4KGNvbHVtbnM6IENvbHVtbltdLCBpbmRleDogbnVtYmVyKTogQ29sdW1uW10ge1xyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoY29sdW1ucykpIHtcclxuICAgICAgcmV0dXJuIGNvbHVtbnMuZmlsdGVyKChlbDogQ29sdW1uLCBpOiBudW1iZXIpID0+IGluZGV4ICE9PSBpKTtcclxuICAgIH1cclxuICAgIHJldHVybiBjb2x1bW5zO1xyXG4gIH1cclxuXHJcbiAgLyoqIFRyYW5zbGF0ZSB0aGUgQ2VsbCBNZW51IHRpdGxlcywgd2UgbmVlZCB0byBsb29wIHRocm91Z2ggYWxsIGNvbHVtbiBkZWZpbml0aW9uIHRvIHJlLXRyYW5zbGF0ZSB0aGVtICovXHJcbiAgdHJhbnNsYXRlQ2VsbE1lbnUoKSB7XHJcbiAgICBpZiAodGhpcy5jZWxsTWVudUV4dGVuc2lvbiAmJiB0aGlzLmNlbGxNZW51RXh0ZW5zaW9uLnRyYW5zbGF0ZUNlbGxNZW51KSB7XHJcbiAgICAgIHRoaXMuY2VsbE1lbnVFeHRlbnNpb24udHJhbnNsYXRlQ2VsbE1lbnUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKiBUcmFuc2xhdGUgdGhlIENvbHVtbiBQaWNrZXIgYW5kIGl0J3MgbGFzdCAyIGNoZWNrYm94ZXMgKi9cclxuICB0cmFuc2xhdGVDb2x1bW5QaWNrZXIoKSB7XHJcbiAgICBpZiAodGhpcy5jb2x1bW5QaWNrZXJFeHRlbnNpb24gJiYgdGhpcy5jb2x1bW5QaWNrZXJFeHRlbnNpb24udHJhbnNsYXRlQ29sdW1uUGlja2VyKSB7XHJcbiAgICAgIHRoaXMuY29sdW1uUGlja2VyRXh0ZW5zaW9uLnRyYW5zbGF0ZUNvbHVtblBpY2tlcigpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqIFRyYW5zbGF0ZSB0aGUgQ29udGV4dCBNZW51IHRpdGxlcywgd2UgbmVlZCB0byBsb29wIHRocm91Z2ggYWxsIGNvbHVtbiBkZWZpbml0aW9uIHRvIHJlLXRyYW5zbGF0ZSB0aGVtICovXHJcbiAgdHJhbnNsYXRlQ29udGV4dE1lbnUoKSB7XHJcbiAgICBpZiAodGhpcy5jb250ZXh0TWVudUV4dGVuc2lvbiAmJiB0aGlzLmNvbnRleHRNZW51RXh0ZW5zaW9uLnRyYW5zbGF0ZUNvbnRleHRNZW51KSB7XHJcbiAgICAgIHRoaXMuY29udGV4dE1lbnVFeHRlbnNpb24udHJhbnNsYXRlQ29udGV4dE1lbnUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRyYW5zbGF0ZSB0aGUgSGVhZGVyIE1lbnUgdGl0bGVzLCB3ZSBuZWVkIHRvIGxvb3AgdGhyb3VnaCBhbGwgY29sdW1uIGRlZmluaXRpb24gdG8gcmUtdHJhbnNsYXRlIHRoZW1cclxuICAgKi9cclxuICB0cmFuc2xhdGVHcmlkTWVudSgpIHtcclxuICAgIGlmICh0aGlzLmdyaWRNZW51RXh0ZW5zaW9uICYmIHRoaXMuZ3JpZE1lbnVFeHRlbnNpb24udHJhbnNsYXRlR3JpZE1lbnUpIHtcclxuICAgICAgdGhpcy5ncmlkTWVudUV4dGVuc2lvbi50cmFuc2xhdGVHcmlkTWVudSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVHJhbnNsYXRlIHRoZSBIZWFkZXIgTWVudSB0aXRsZXMsIHdlIG5lZWQgdG8gbG9vcCB0aHJvdWdoIGFsbCBjb2x1bW4gZGVmaW5pdGlvbiB0byByZS10cmFuc2xhdGUgdGhlbVxyXG4gICAqL1xyXG4gIHRyYW5zbGF0ZUhlYWRlck1lbnUoKSB7XHJcbiAgICBpZiAodGhpcy5oZWFkZXJNZW51RXh0ZW5zaW9uICYmIHRoaXMuaGVhZGVyTWVudUV4dGVuc2lvbi50cmFuc2xhdGVIZWFkZXJNZW51KSB7XHJcbiAgICAgIHRoaXMuaGVhZGVyTWVudUV4dGVuc2lvbi50cmFuc2xhdGVIZWFkZXJNZW51KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUcmFuc2xhdGUgbWFudWFsbHkgdGhlIGhlYWRlciB0aXRsZXMuXHJcbiAgICogV2UgY291bGQgb3B0aW9uYWxseSBwYXNzIGEgbG9jYWxlICh0aGF0IHdpbGwgY2hhbmdlIGN1cnJlbnRseSBsb2FkZWQgbG9jYWxlKSwgZWxzZSBpdCB3aWxsIHVzZSBjdXJyZW50IGxvY2FsZVxyXG4gICAqIEBwYXJhbSBsb2NhbGUgdG8gdXNlXHJcbiAgICogQHBhcmFtIG5ldyBjb2x1bW4gZGVmaW5pdGlvbnMgKG9wdGlvbmFsKVxyXG4gICAqL1xyXG4gIHRyYW5zbGF0ZUNvbHVtbkhlYWRlcnMobG9jYWxlPzogYm9vbGVhbiB8IHN0cmluZywgbmV3Q29sdW1uRGVmaW5pdGlvbnM/OiBDb2x1bW5bXSkge1xyXG4gICAgaWYgKHRoaXMuc2hhcmVkU2VydmljZSAmJiB0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMgJiYgdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLmVuYWJsZVRyYW5zbGF0ZSAmJiAoIXRoaXMudHJhbnNsYXRlIHx8ICF0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tBbmd1bGFyLVNsaWNrZ3JpZF0gcmVxdWlyZXMgXCJuZ3gtdHJhbnNsYXRlXCIgdG8gYmUgaW5zdGFsbGVkIGFuZCBjb25maWd1cmVkIHdoZW4gdGhlIGdyaWQgb3B0aW9uIFwiZW5hYmxlVHJhbnNsYXRlXCIgaXMgZW5hYmxlZC4nKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobG9jYWxlKSB7XHJcbiAgICAgIHRoaXMudHJhbnNsYXRlLnVzZShsb2NhbGUgYXMgc3RyaW5nKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgY29sdW1uRGVmaW5pdGlvbnMgPSBuZXdDb2x1bW5EZWZpbml0aW9ucztcclxuICAgIGlmICghY29sdW1uRGVmaW5pdGlvbnMpIHtcclxuICAgICAgY29sdW1uRGVmaW5pdGlvbnMgPSB0aGlzLnNoYXJlZFNlcnZpY2UuY29sdW1uRGVmaW5pdGlvbnM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZXZlbnR1YWxseSBkZXByZWNhdGUgdGhlIFwiaGVhZGVyS2V5XCIgYW5kIHVzZSBvbmx5IHRoZSBcIm5hbWVLZXlcIlxyXG4gICAgdGhpcy50cmFuc2xhdGVJdGVtcyhjb2x1bW5EZWZpbml0aW9ucywgJ2hlYWRlcktleScsICduYW1lJyk7XHJcbiAgICB0aGlzLnRyYW5zbGF0ZUl0ZW1zKHRoaXMuc2hhcmVkU2VydmljZS5hbGxDb2x1bW5zLCAnaGVhZGVyS2V5JywgJ25hbWUnKTtcclxuICAgIHRoaXMudHJhbnNsYXRlSXRlbXMoY29sdW1uRGVmaW5pdGlvbnMsICduYW1lS2V5JywgJ25hbWUnKTtcclxuICAgIHRoaXMudHJhbnNsYXRlSXRlbXModGhpcy5zaGFyZWRTZXJ2aWNlLmFsbENvbHVtbnMsICduYW1lS2V5JywgJ25hbWUnKTtcclxuXHJcbiAgICAvLyByZS1yZW5kZXIgdGhlIGNvbHVtbiBoZWFkZXJzXHJcbiAgICB0aGlzLnJlbmRlckNvbHVtbkhlYWRlcnMoY29sdW1uRGVmaW5pdGlvbnMpO1xyXG4gICAgdGhpcy5ncmlkTWVudUV4dGVuc2lvbi50cmFuc2xhdGVHcmlkTWVudSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVuZGVyIChvciByZS1yZW5kZXIpIHRoZSBjb2x1bW4gaGVhZGVycyBmcm9tIGNvbHVtbiBkZWZpbml0aW9ucy5cclxuICAgKiBjYWxsaW5nIHNldENvbHVtbnMoKSB3aWxsIHRyaWdnZXIgYSBncmlkIHJlLXJlbmRlclxyXG4gICAqL1xyXG4gIHJlbmRlckNvbHVtbkhlYWRlcnMobmV3Q29sdW1uRGVmaW5pdGlvbnM/OiBDb2x1bW5bXSkge1xyXG4gICAgbGV0IGNvbGxlY3Rpb24gPSBuZXdDb2x1bW5EZWZpbml0aW9ucztcclxuICAgIGlmICghY29sbGVjdGlvbikge1xyXG4gICAgICBjb2xsZWN0aW9uID0gdGhpcy5zaGFyZWRTZXJ2aWNlLmNvbHVtbkRlZmluaXRpb25zO1xyXG4gICAgfVxyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoY29sbGVjdGlvbikgJiYgdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQgJiYgdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQuc2V0Q29sdW1ucykge1xyXG4gICAgICBpZiAoY29sbGVjdGlvbi5sZW5ndGggPiB0aGlzLnNoYXJlZFNlcnZpY2UuYWxsQ29sdW1ucy5sZW5ndGgpIHtcclxuICAgICAgICB0aGlzLnNoYXJlZFNlcnZpY2UuYWxsQ29sdW1ucyA9IGNvbGxlY3Rpb247XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQuc2V0Q29sdW1ucyhjb2xsZWN0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBkaXNwb3NlIG9mIHByZXZpb3VzIENvbHVtbiBQaWNrZXIgaW5zdGFuY2UsIHRoZW4gcmUtcmVnaXN0ZXIgaXQgYW5kIGRvbid0IGZvcmdldCB0byBvdmVyd3JpdGUgcHJldmlvdXMgaW5zdGFuY2UgcmVmXHJcbiAgICBpZiAodGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLmVuYWJsZUNvbHVtblBpY2tlcikge1xyXG4gICAgICB0aGlzLmNvbHVtblBpY2tlckV4dGVuc2lvbi5kaXNwb3NlKCk7XHJcbiAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5jb2x1bW5QaWNrZXJFeHRlbnNpb24ucmVnaXN0ZXIoKTtcclxuICAgICAgY29uc3QgZXh0ZW5zaW9uID0gdGhpcy5nZXRFeHRlbnNpb25CeU5hbWUoRXh0ZW5zaW9uTmFtZS5jb2x1bW5QaWNrZXIpO1xyXG4gICAgICBpZiAoZXh0ZW5zaW9uKSB7XHJcbiAgICAgICAgZXh0ZW5zaW9uLmFkZG9uID0gaW5zdGFuY2U7XHJcbiAgICAgICAgZXh0ZW5zaW9uLmluc3RhbmNlID0gaW5zdGFuY2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBkaXNwb3NlIG9mIHByZXZpb3VzIEdyaWQgTWVudSBpbnN0YW5jZSwgdGhlbiByZS1yZWdpc3RlciBpdCBhbmQgZG9uJ3QgZm9yZ2V0IHRvIG92ZXJ3cml0ZSBwcmV2aW91cyBpbnN0YW5jZSByZWZcclxuICAgIGlmICh0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlR3JpZE1lbnUpIHtcclxuICAgICAgdGhpcy5ncmlkTWVudUV4dGVuc2lvbi5kaXNwb3NlKCk7XHJcbiAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5ncmlkTWVudUV4dGVuc2lvbi5yZWdpc3RlcigpO1xyXG4gICAgICBjb25zdCBleHRlbnNpb24gPSB0aGlzLmdldEV4dGVuc2lvbkJ5TmFtZShFeHRlbnNpb25OYW1lLmdyaWRNZW51KTtcclxuICAgICAgaWYgKGV4dGVuc2lvbikge1xyXG4gICAgICAgIGV4dGVuc2lvbi5hZGRvbiA9IGluc3RhbmNlO1xyXG4gICAgICAgIGV4dGVuc2lvbi5pbnN0YW5jZSA9IGluc3RhbmNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvL1xyXG4gIC8vIHByaXZhdGUgZnVuY3Rpb25zXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgYW4gRXh0ZW5zaW9uIHRoYXQgd2FzIGNyZWF0ZWQgYnkgY2FsbGluZyBpdHMgXCJjcmVhdGVcIiBtZXRob2QgKHRoZXJlIGFyZSBvbmx5IDMgZXh0ZW5zaW9ucyB3aGljaCB1c2VzIHRoaXMgbWV0aG9kKVxyXG4gICAqICBAcGFyYW0gbmFtZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0Q3JlYXRlZEV4dGVuc2lvbkJ5TmFtZShuYW1lOiBFeHRlbnNpb25OYW1lKTogRXh0ZW5zaW9uTW9kZWwgfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuIEFycmF5LmlzQXJyYXkodGhpcy5fZXh0ZW5zaW9uQ3JlYXRlZExpc3QpICYmIHRoaXMuX2V4dGVuc2lvbkNyZWF0ZWRMaXN0LmZpbmQoKHApID0+IHAubmFtZSA9PT0gbmFtZSk7XHJcbiAgfVxyXG5cclxuICAvKiogVHJhbnNsYXRlIGFuIGFycmF5IG9mIGl0ZW1zIGZyb20gYW4gaW5wdXQga2V5IGFuZCBhc3NpZ24gdHJhbnNsYXRlZCB2YWx1ZSB0byB0aGUgb3V0cHV0IGtleSAqL1xyXG4gIHByaXZhdGUgdHJhbnNsYXRlSXRlbXMoaXRlbXM6IGFueVtdLCBpbnB1dEtleTogc3RyaW5nLCBvdXRwdXRLZXk6IHN0cmluZykge1xyXG4gICAgaWYgKHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucyAmJiB0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlVHJhbnNsYXRlICYmICghdGhpcy50cmFuc2xhdGUgfHwgIXRoaXMudHJhbnNsYXRlLmluc3RhbnQpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignW0FuZ3VsYXItU2xpY2tncmlkXSByZXF1aXJlcyBcIm5neC10cmFuc2xhdGVcIiB0byBiZSBpbnN0YWxsZWQgYW5kIGNvbmZpZ3VyZWQgd2hlbiB0aGUgZ3JpZCBvcHRpb24gXCJlbmFibGVUcmFuc2xhdGVcIiBpcyBlbmFibGVkLicpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChBcnJheS5pc0FycmF5KGl0ZW1zKSkge1xyXG4gICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpIHtcclxuICAgICAgICBpZiAoaXRlbVtpbnB1dEtleV0pIHtcclxuICAgICAgICAgIGl0ZW1bb3V0cHV0S2V5XSA9IHRoaXMudHJhbnNsYXRlICYmIHRoaXMudHJhbnNsYXRlLmN1cnJlbnRMYW5nICYmIHRoaXMudHJhbnNsYXRlLmluc3RhbnQoaXRlbVtpbnB1dEtleV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=