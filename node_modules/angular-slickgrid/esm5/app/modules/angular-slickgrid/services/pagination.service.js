import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { isObservable, Subject } from 'rxjs';
import * as isequal_ from 'lodash.isequal';
var isequal = isequal_; // patch to fix rollup to work
import { FilterService } from './filter.service';
import { GridService } from './grid.service';
import { SharedService } from './shared.service';
import { executeBackendProcessesCallback, onBackendError } from './backend-utilities';
import { unsubscribeAllObservables } from './utilities';
var PaginationService = /** @class */ (function () {
    /** Constructor */
    function PaginationService(filterService, gridService, sharedService) {
        this.filterService = filterService;
        this.gridService = gridService;
        this.sharedService = sharedService;
        this._initialized = false;
        this._isLocalGrid = true;
        this._dataFrom = 1;
        this._dataTo = 1;
        this._pageCount = 1;
        this._pageNumber = 1;
        this._totalItems = 0;
        this._eventHandler = new Slick.EventHandler();
        this._subscriptions = [];
        this.onPaginationChanged = new Subject();
        this.onPaginationVisibilityChanged = new Subject();
    }
    Object.defineProperty(PaginationService.prototype, "paginationOptions", {
        get: function () {
            return this._paginationOptions;
        },
        set: function (paginationOptions) {
            this._paginationOptions = paginationOptions;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationService.prototype, "availablePageSizes", {
        get: function () {
            return this._availablePageSizes;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationService.prototype, "dataFrom", {
        get: function () {
            return this._dataFrom;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationService.prototype, "dataTo", {
        get: function () {
            return this._dataTo;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationService.prototype, "itemsPerPage", {
        get: function () {
            return this._itemsPerPage;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationService.prototype, "pageCount", {
        get: function () {
            return this._pageCount;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationService.prototype, "pageNumber", {
        get: function () {
            return this._pageNumber;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PaginationService.prototype, "totalItems", {
        get: function () {
            return this._totalItems;
        },
        set: function (totalItems) {
            this._totalItems = totalItems;
            if (this._initialized) {
                this.refreshPagination();
            }
        },
        enumerable: true,
        configurable: true
    });
    PaginationService.prototype.init = function (grid, dataView, paginationOptions, backendServiceApi) {
        var _this = this;
        this._availablePageSizes = paginationOptions.pageSizes;
        this.dataView = dataView;
        this.grid = grid;
        this._backendServiceApi = backendServiceApi;
        this._paginationOptions = paginationOptions;
        this._isLocalGrid = !backendServiceApi;
        this._pageNumber = paginationOptions.pageNumber || 1;
        if (backendServiceApi && (!backendServiceApi.service || !backendServiceApi.process)) {
            throw new Error("BackendServiceApi requires the following 2 properties \"process\" and \"service\" to be defined.");
        }
        if (this._isLocalGrid && this.dataView) {
            this.dataView.onPagingInfoChanged.subscribe(function (e, pagingInfo) {
                if (_this._totalItems !== pagingInfo.totalRows) {
                    _this._totalItems = pagingInfo.totalRows;
                    _this._paginationOptions.totalItems = _this._totalItems;
                    _this.refreshPagination(false, false);
                }
            });
            dataView.setRefreshHints({ isFilterUnchanged: true });
            dataView.setPagingOptions({ pageSize: this.paginationOptions.pageSize, pageNum: (this._pageNumber - 1) }); // dataView page starts at 0 instead of 1
        }
        // Subscribe to Filter Clear & Changed and go back to page 1 when that happen
        this._subscriptions.push(this.filterService.onFilterChanged.subscribe(function () { return _this.resetPagination(); }));
        this._subscriptions.push(this.filterService.onFilterCleared.subscribe(function () { return _this.resetPagination(); }));
        // Subscribe to any dataview row count changed so that when Adding/Deleting item(s) through the DataView
        // that would trigger a refresh of the pagination numbers
        if (this.dataView) {
            this._subscriptions.push(this.gridService.onItemAdded.subscribe(function (items) { return _this.processOnItemAddedOrRemoved(items, true); }));
            this._subscriptions.push(this.gridService.onItemDeleted.subscribe(function (items) { return _this.processOnItemAddedOrRemoved(items, false); }));
        }
        this.refreshPagination(false, false);
        this._initialized = true;
    };
    PaginationService.prototype.dispose = function () {
        this._initialized = false;
        // unsubscribe all SlickGrid events
        this._eventHandler.unsubscribeAll();
        // also unsubscribe all Angular Subscriptions
        this._subscriptions = unsubscribeAllObservables(this._subscriptions);
    };
    PaginationService.prototype.getCurrentPageNumber = function () {
        return this._pageNumber;
    };
    PaginationService.prototype.getCurrentPagination = function () {
        return {
            pageNumber: this._pageNumber,
            pageSize: this._itemsPerPage,
            pageSizes: this._availablePageSizes,
        };
    };
    PaginationService.prototype.getFullPagination = function () {
        return {
            pageCount: this._pageCount,
            pageNumber: this._pageNumber,
            pageSize: this._itemsPerPage,
            pageSizes: this._availablePageSizes,
            totalItems: this._totalItems,
            dataFrom: this._dataFrom,
            dataTo: this._dataTo,
        };
    };
    PaginationService.prototype.getCurrentItemPerPage = function () {
        return this._itemsPerPage;
    };
    PaginationService.prototype.changeItemPerPage = function (itemsPerPage, event) {
        this._pageNumber = 1;
        this._pageCount = Math.ceil(this._totalItems / itemsPerPage);
        this._itemsPerPage = itemsPerPage;
        return this.processOnPageChanged(this._pageNumber, event);
    };
    PaginationService.prototype.goToFirstPage = function (event) {
        this._pageNumber = 1;
        return this.processOnPageChanged(this._pageNumber, event);
    };
    PaginationService.prototype.goToLastPage = function (event) {
        this._pageNumber = this._pageCount || 1;
        return this.processOnPageChanged(this._pageNumber, event);
    };
    PaginationService.prototype.goToNextPage = function (event) {
        if (this._pageNumber < this._pageCount) {
            this._pageNumber++;
            return this.processOnPageChanged(this._pageNumber, event);
        }
        else {
            return new Promise(function (resolve) { return resolve(false); });
        }
    };
    PaginationService.prototype.goToPageNumber = function (pageNumber, event) {
        var previousPageNumber = this._pageNumber;
        if (pageNumber < 1) {
            this._pageNumber = 1;
        }
        else if (pageNumber > this._pageCount) {
            this._pageNumber = this._pageCount;
        }
        else {
            this._pageNumber = pageNumber;
        }
        if (this._pageNumber !== previousPageNumber) {
            return this.processOnPageChanged(this._pageNumber, event);
        }
        else {
            return new Promise(function (resolve) { return resolve(false); });
        }
    };
    PaginationService.prototype.goToPreviousPage = function (event) {
        if (this._pageNumber > 1) {
            this._pageNumber--;
            return this.processOnPageChanged(this._pageNumber, event);
        }
        else {
            return new Promise(function (resolve) { return resolve(false); });
        }
    };
    PaginationService.prototype.refreshPagination = function (isPageNumberReset, triggerChangedEvent) {
        if (isPageNumberReset === void 0) { isPageNumberReset = false; }
        if (triggerChangedEvent === void 0) { triggerChangedEvent = true; }
        var previousPagination = tslib_1.__assign({}, this.getCurrentPagination());
        if (this._paginationOptions) {
            var pagination = this._paginationOptions;
            // set the number of items per page if not already set
            if (!this._itemsPerPage) {
                if (this._isLocalGrid) {
                    this._itemsPerPage = pagination.pageSize;
                }
                else {
                    this._itemsPerPage = +((this._backendServiceApi && this._backendServiceApi.options && this._backendServiceApi.options.paginationOptions && this._backendServiceApi.options.paginationOptions.first) ? this._backendServiceApi.options.paginationOptions.first : pagination.pageSize);
                }
            }
            // if totalItems changed, we should always go back to the first page and recalculation the From-To indexes
            if (isPageNumberReset || this._totalItems !== pagination.totalItems) {
                if (isPageNumberReset) {
                    this._pageNumber = 1;
                    this.paginationOptions.pageNumber = 1;
                }
                else if (!this._initialized && pagination.pageNumber && pagination.pageNumber > 1) {
                    this._pageNumber = pagination.pageNumber || 1;
                }
                // when page number is set to 1 then also reset the "offset" of backend service
                if (this._pageNumber === 1 && this._backendServiceApi) {
                    this._backendServiceApi.service.resetPaginationOptions();
                }
            }
            // calculate and refresh the multiple properties of the pagination UI
            this._availablePageSizes = pagination.pageSizes;
            if (!this._totalItems && pagination.totalItems) {
                this._totalItems = pagination.totalItems;
            }
            this.recalculateFromToIndexes();
        }
        this._pageCount = Math.ceil(this._totalItems / this._itemsPerPage);
        var currentPagination = this.getCurrentPagination();
        this.sharedService.currentPagination = currentPagination;
        if (triggerChangedEvent && !isequal(previousPagination, currentPagination)) {
            this.onPaginationChanged.next(currentPagination);
        }
    };
    PaginationService.prototype.processOnPageChanged = function (pageNumber, event) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            _this.recalculateFromToIndexes();
            if (_this._isLocalGrid && _this.dataView) {
                _this.dataView.setPagingOptions({ pageSize: _this._itemsPerPage, pageNum: (pageNumber - 1) }); // dataView page starts at 0 instead of 1
                _this.onPaginationChanged.next(_this.getFullPagination());
            }
            else {
                var itemsPerPage = +_this._itemsPerPage;
                // keep start time & end timestamps & return it after process execution
                var startTime_1 = new Date();
                // run any pre-process, if defined, for example a spinner
                if (_this._backendServiceApi.preProcess) {
                    _this._backendServiceApi.preProcess();
                }
                var query = _this._backendServiceApi.service.processOnPaginationChanged(event, { newPage: pageNumber, pageSize: itemsPerPage });
                // the processes can be Promises or an Observables (like HttpClient)
                var process_1 = _this._backendServiceApi.process(query);
                if (process_1 instanceof Promise) {
                    process_1
                        .then(function (processResult) {
                        resolve(executeBackendProcessesCallback(startTime_1, processResult, _this._backendServiceApi, _this._totalItems));
                    })
                        .catch(function (error) {
                        onBackendError(error, _this._backendServiceApi);
                        reject(process_1);
                    });
                }
                else if (isObservable(process_1)) {
                    process_1.subscribe(function (processResult) {
                        resolve(executeBackendProcessesCallback(startTime_1, processResult, _this._backendServiceApi, _this._totalItems));
                    }, function (error) {
                        onBackendError(error, _this._backendServiceApi);
                        reject(process_1);
                    });
                }
                _this.onPaginationChanged.next(_this.getFullPagination());
            }
        });
    };
    PaginationService.prototype.recalculateFromToIndexes = function () {
        if (this._totalItems === 0) {
            this._dataFrom = 0;
            this._dataTo = 1;
            this._pageNumber = 0;
        }
        else {
            this._dataFrom = this._pageNumber > 1 ? ((this._pageNumber * this._itemsPerPage) - this._itemsPerPage + 1) : 1;
            this._dataTo = (this._totalItems < this._itemsPerPage) ? this._totalItems : ((this._pageNumber || 1) * this._itemsPerPage);
            if (this._dataTo > this._totalItems) {
                this._dataTo = this._totalItems;
            }
        }
        if (this._totalItems > 0 && this._pageNumber === 0) {
            this._pageNumber = 1;
        }
        // do a final check on the From/To and make sure they are not over or below min/max acceptable values
        if (this._dataTo > this._totalItems) {
            this._dataTo = this._totalItems;
        }
        else if (this._totalItems < this._itemsPerPage) {
            this._dataTo = this._totalItems;
        }
    };
    /** Reset the Pagination to first page and recalculate necessary numbers */
    PaginationService.prototype.resetPagination = function (triggerChangedEvent) {
        if (triggerChangedEvent === void 0) { triggerChangedEvent = true; }
        if (this._isLocalGrid) {
            // on a local grid we also need to reset the DataView paging to 1st page
            this.dataView.setPagingOptions({ pageSize: this._itemsPerPage, pageNum: 0 });
        }
        this.refreshPagination(true, triggerChangedEvent);
    };
    /**
     * Toggle the Pagination (show/hide), it will use the visible if defined else it will automatically inverse when called without argument
     *
     * IMPORTANT NOTE:
     * The Pagination must be created on initial page load, then only after can you toggle it.
     * Basically this method WILL NOT WORK to show the Pagination if it was not there from the start.
     */
    PaginationService.prototype.togglePaginationVisibility = function (visible) {
        if (this.grid && this.sharedService && this.sharedService.gridOptions) {
            var isVisible = visible !== undefined ? visible : !this.sharedService.gridOptions.enablePagination;
            this.sharedService.gridOptions.enablePagination = isVisible;
            this.onPaginationVisibilityChanged.next({ visible: isVisible });
            // make sure to reset the Pagination and go back to first page to avoid any issues with Pagination being offset
            if (isVisible) {
                this.goToFirstPage();
            }
            // when using a local grid, we can reset the DataView pagination by changing its page size
            // page size of 0 would show all, hence cancel the pagination
            if (this._isLocalGrid) {
                var pageSize = visible ? this._itemsPerPage : 0;
                this.dataView.setPagingOptions({ pageSize: pageSize, pageNum: 0 });
            }
        }
    };
    // --
    // private functions
    // --------------------
    /**
     * When item is added or removed, we will refresh the numbers on the pagination however we won't trigger a backend change
     * This will have a side effect though, which is that the "To" count won't be matching the "items per page" count,
     * that is a necessary side effect to avoid triggering a backend query just to refresh the paging,
     * basically we assume that this offset is fine for the time being,
     * until user does an action which will refresh the data hence the pagination which will then become normal again
     */
    PaginationService.prototype.processOnItemAddedOrRemoved = function (items, isItemAdded) {
        if (isItemAdded === void 0) { isItemAdded = true; }
        if (items !== null) {
            var previousDataTo = this._dataTo;
            var itemCount = Array.isArray(items) ? items.length : 1;
            var itemCountWithDirection = isItemAdded ? +itemCount : -itemCount;
            // refresh the total count in the pagination and in the UI
            this._totalItems += itemCountWithDirection;
            this.recalculateFromToIndexes();
            // finally refresh the "To" count and we know it might be different than the "items per page" count
            // but this is necessary since we don't want an actual backend refresh
            this._dataTo = previousDataTo + itemCountWithDirection;
            this.onPaginationChanged.next(this.getFullPagination());
        }
    };
    PaginationService = tslib_1.__decorate([
        Injectable(),
        tslib_1.__metadata("design:paramtypes", [FilterService, GridService, SharedService])
    ], PaginationService);
    return PaginationService;
}());
export { PaginationService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnaW5hdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci1zbGlja2dyaWQvIiwic291cmNlcyI6WyJhcHAvbW9kdWxlcy9hbmd1bGFyLXNsaWNrZ3JpZC9zZXJ2aWNlcy9wYWdpbmF0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFnQixZQUFZLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNELE9BQU8sS0FBSyxRQUFRLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsSUFBTSxPQUFPLEdBQUcsUUFBUSxDQUFDLENBQUMsOEJBQThCO0FBR3hELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2pELE9BQU8sRUFBRSwrQkFBK0IsRUFBRSxjQUFjLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RixPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFNeEQ7SUFvQkUsa0JBQWtCO0lBQ2xCLDJCQUFvQixhQUE0QixFQUFVLFdBQXdCLEVBQVUsYUFBNEI7UUFBcEcsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFBVSxnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUFVLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBcEJoSCxpQkFBWSxHQUFHLEtBQUssQ0FBQztRQUNyQixpQkFBWSxHQUFHLElBQUksQ0FBQztRQUVwQixjQUFTLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsWUFBTyxHQUFHLENBQUMsQ0FBQztRQUVaLGVBQVUsR0FBRyxDQUFDLENBQUM7UUFDZixnQkFBVyxHQUFHLENBQUMsQ0FBQztRQUNoQixnQkFBVyxHQUFHLENBQUMs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MUQsSUFBSSxDQUFDLFdBQVcsSUFBSSxzQkFBc0IsQ0FBQztZQUMzQyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztZQUVoQyxtR0FBbUc7WUFDbkcsc0VBQXNFO1lBQ3RFLElBQUksQ0FBQyxPQUFPLEdBQUcsY0FBYyxHQUFHLHNCQUFzQixDQUFDO1lBQ3ZELElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUMsQ0FBQztTQUN6RDtJQUNILENBQUM7SUF2WFUsaUJBQWlCO1FBRDdCLFVBQVUsRUFBRTtpREFzQndCLGFBQWEsRUFBdUIsV0FBVyxFQUF5QixhQUFhO09BckI3RyxpQkFBaUIsQ0F3WDdCO0lBQUQsd0JBQUM7Q0FBQSxBQXhYRCxJQXdYQztTQXhYWSxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiwgaXNPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCAqIGFzIGlzZXF1YWxfIGZyb20gJ2xvZGFzaC5pc2VxdWFsJztcclxuY29uc3QgaXNlcXVhbCA9IGlzZXF1YWxfOyAvLyBwYXRjaCB0byBmaXggcm9sbHVwIHRvIHdvcmtcclxuXHJcbmltcG9ydCB7IEJhY2tlbmRTZXJ2aWNlQXBpLCBDdXJyZW50UGFnaW5hdGlvbiwgR3JhcGhxbFJlc3VsdCwgR3JhcGhxbFBhZ2luYXRlZFJlc3VsdCwgR3JpZE9wdGlvbiwgUGFnaW5hdGlvbiwgU2VydmljZVBhZ2luYXRpb24gfSBmcm9tICcuLi9tb2RlbHMnO1xyXG5pbXBvcnQgeyBGaWx0ZXJTZXJ2aWNlIH0gZnJvbSAnLi9maWx0ZXIuc2VydmljZSc7XHJcbmltcG9ydCB7IEdyaWRTZXJ2aWNlIH0gZnJvbSAnLi9ncmlkLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBTaGFyZWRTZXJ2aWNlIH0gZnJvbSAnLi9zaGFyZWQuc2VydmljZSc7XHJcbmltcG9ydCB7IGV4ZWN1dGVCYWNrZW5kUHJvY2Vzc2VzQ2FsbGJhY2ssIG9uQmFja2VuZEVycm9yIH0gZnJvbSAnLi9iYWNrZW5kLXV0aWxpdGllcyc7XHJcbmltcG9ydCB7IHVuc3Vic2NyaWJlQWxsT2JzZXJ2YWJsZXMgfSBmcm9tICcuL3V0aWxpdGllcyc7XHJcblxyXG4vLyB1c2luZyBleHRlcm5hbCBub24tdHlwZWQganMgbGlicmFyaWVzXHJcbmRlY2xhcmUgdmFyIFNsaWNrOiBhbnk7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBQYWdpbmF0aW9uU2VydmljZSB7XHJcbiAgcHJpdmF0ZSBfaW5pdGlhbGl6ZWQgPSBmYWxzZTtcclxuICBwcml2YXRlIF9pc0xvY2FsR3JpZCA9IHRydWU7XHJcbiAgcHJpdmF0ZSBfYmFja2VuZFNlcnZpY2VBcGk6IEJhY2tlbmRTZXJ2aWNlQXBpO1xyXG4gIHByaXZhdGUgX2RhdGFGcm9tID0gMTtcclxuICBwcml2YXRlIF9kYXRhVG8gPSAxO1xyXG4gIHByaXZhdGUgX2l0ZW1zUGVyUGFnZTogbnVtYmVyO1xyXG4gIHByaXZhdGUgX3BhZ2VDb3VudCA9IDE7XHJcbiAgcHJpdmF0ZSBfcGFnZU51bWJlciA9IDE7XHJcbiAgcHJpdmF0ZSBfdG90YWxJdGVtcyA9IDA7XHJcbiAgcHJpdmF0ZSBfYXZhaWxhYmxlUGFnZVNpemVzOiBudW1iZXJbXTtcclxuICBwcml2YXRlIF9ldmVudEhhbmRsZXIgPSBuZXcgU2xpY2suRXZlbnRIYW5kbGVyKCk7XHJcbiAgcHJpdmF0ZSBfcGFnaW5hdGlvbk9wdGlvbnM6IFBhZ2luYXRpb247XHJcbiAgcHJpdmF0ZSBfc3Vic2NyaXB0aW9uczogU3Vic2NyaXB0aW9uW10gPSBbXTtcclxuICBvblBhZ2luYXRpb25DaGFuZ2VkID0gbmV3IFN1YmplY3Q8U2VydmljZVBhZ2luYXRpb24+KCk7XHJcbiAgb25QYWdpbmF0aW9uVmlzaWJpbGl0eUNoYW5nZWQgPSBuZXcgU3ViamVjdDx7IHZpc2libGU6IGJvb2xlYW4gfT4oKTtcclxuXHJcbiAgZGF0YVZpZXc6IGFueTtcclxuICBncmlkOiBhbnk7XHJcblxyXG4gIC8qKiBDb25zdHJ1Y3RvciAqL1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZmlsdGVyU2VydmljZTogRmlsdGVyU2VydmljZSwgcHJpdmF0ZSBncmlkU2VydmljZTogR3JpZFNlcnZpY2UsIHByaXZhdGUgc2hhcmVkU2VydmljZTogU2hhcmVkU2VydmljZSkgeyB9XHJcblxyXG4gIGdldCBwYWdpbmF0aW9uT3B0aW9ucygpOiBQYWdpbmF0aW9uIHtcclxuICAgIHJldHVybiB0aGlzLl9wYWdpbmF0aW9uT3B0aW9ucztcclxuICB9XHJcbiAgc2V0IHBhZ2luYXRpb25PcHRpb25zKHBhZ2luYXRpb25PcHRpb25zOiBQYWdpbmF0aW9uKSB7XHJcbiAgICB0aGlzLl9wYWdpbmF0aW9uT3B0aW9ucyA9IHBhZ2luYXRpb25PcHRpb25zO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGF2YWlsYWJsZVBhZ2VTaXplcygpOiBudW1iZXJbXSB7XHJcbiAgICByZXR1cm4gdGhpcy5fYXZhaWxhYmxlUGFnZVNpemVzO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGRhdGFGcm9tKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5fZGF0YUZyb207XHJcbiAgfVxyXG5cclxuICBnZXQgZGF0YVRvKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5fZGF0YVRvO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGl0ZW1zUGVyUGFnZSgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX2l0ZW1zUGVyUGFnZTtcclxuICB9XHJcblxyXG4gIGdldCBwYWdlQ291bnQoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLl9wYWdlQ291bnQ7XHJcbiAgfVxyXG5cclxuICBnZXQgcGFnZU51bWJlcigpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX3BhZ2VOdW1iZXI7XHJcbiAgfVxyXG5cclxuICBzZXQgdG90YWxJdGVtcyh0b3RhbEl0ZW1zOiBudW1iZXIpIHtcclxuICAgIHRoaXMuX3RvdGFsSXRlbXMgPSB0b3RhbEl0ZW1zO1xyXG4gICAgaWYgKHRoaXMuX2luaXRpYWxpemVkKSB7XHJcbiAgICAgIHRoaXMucmVmcmVzaFBhZ2luYXRpb24oKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldCB0b3RhbEl0ZW1zKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5fdG90YWxJdGVtcztcclxuICB9XHJcblxyXG4gIGluaXQoZ3JpZDogYW55LCBkYXRhVmlldzogYW55LCBwYWdpbmF0aW9uT3B0aW9uczogUGFnaW5hdGlvbiwgYmFja2VuZFNlcnZpY2VBcGk/OiBCYWNrZW5kU2VydmljZUFwaSkge1xyXG4gICAgdGhpcy5fYXZhaWxhYmxlUGFnZVNpemVzID0gcGFnaW5hdGlvbk9wdGlvbnMucGFnZVNpemVzO1xyXG4gICAgdGhpcy5kYXRhVmlldyA9IGRhdGFWaWV3O1xyXG4gICAgdGhpcy5ncmlkID0gZ3JpZDtcclxuICAgIHRoaXMuX2JhY2tlbmRTZXJ2aWNlQXBpID0gYmFja2VuZFNlcnZpY2VBcGk7XHJcbiAgICB0aGlzLl9wYWdpbmF0aW9uT3B0aW9ucyA9IHBhZ2luYXRpb25PcHRpb25zO1xyXG4gICAgdGhpcy5faXNMb2NhbEdyaWQgPSAhYmFja2VuZFNlcnZpY2VBcGk7XHJcbiAgICB0aGlzLl9wYWdlTnVtYmVyID0gcGFnaW5hdGlvbk9wdGlvbnMucGFnZU51bWJlciB8fCAxO1xyXG5cclxuICAgIGlmIChiYWNrZW5kU2VydmljZUFwaSAmJiAoIWJhY2tlbmRTZXJ2aWNlQXBpLnNlcnZpY2UgfHwgIWJhY2tlbmRTZXJ2aWNlQXBpLnByb2Nlc3MpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQmFja2VuZFNlcnZpY2VBcGkgcmVxdWlyZXMgdGhlIGZvbGxvd2luZyAyIHByb3BlcnRpZXMgXCJwcm9jZXNzXCIgYW5kIFwic2VydmljZVwiIHRvIGJlIGRlZmluZWQuYCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuX2lzTG9jYWxHcmlkICYmIHRoaXMuZGF0YVZpZXcpIHtcclxuICAgICAgdGhpcy5kYXRhVmlldy5vblBhZ2luZ0luZm9DaGFuZ2VkLnN1YnNjcmliZSgoZSwgcGFnaW5nSW5mbykgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLl90b3RhbEl0ZW1zICE9PSBwYWdpbmdJbmZvLnRvdGFsUm93cykge1xyXG4gICAgICAgICAgdGhpcy5fdG90YWxJdGVtcyA9IHBhZ2luZ0luZm8udG90YWxSb3dzO1xyXG4gICAgICAgICAgdGhpcy5fcGFnaW5hdGlvbk9wdGlvbnMudG90YWxJdGVtcyA9IHRoaXMuX3RvdGFsSXRlbXM7XHJcbiAgICAgICAgICB0aGlzLnJlZnJlc2hQYWdpbmF0aW9uKGZhbHNlLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgZGF0YVZpZXcuc2V0UmVmcmVzaEhpbnRzKHsgaXNGaWx0ZXJVbmNoYW5nZWQ6IHRydWUgfSk7XHJcbiAgICAgIGRhdGFWaWV3LnNldFBhZ2luZ09wdGlvbnMoeyBwYWdlU2l6ZTogdGhpcy5wYWdpbmF0aW9uT3B0aW9ucy5wYWdlU2l6ZSwgcGFnZU51bTogKHRoaXMuX3BhZ2VOdW1iZXIgLSAxKSB9KTsgLy8gZGF0YVZpZXcgcGFnZSBzdGFydHMgYXQgMCBpbnN0ZWFkIG9mIDFcclxuICAgIH1cclxuXHJcbiAgICAvLyBTdWJzY3JpYmUgdG8gRmlsdGVyIENsZWFyICYgQ2hhbmdlZCBhbmQgZ28gYmFjayB0byBwYWdlIDEgd2hlbiB0aGF0IGhhcHBlblxyXG4gICAgdGhpcy5fc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMuZmlsdGVyU2VydmljZS5vbkZpbHRlckNoYW5nZWQuc3Vic2NyaWJlKCgpID0+IHRoaXMucmVzZXRQYWdpbmF0aW9uKCkpKTtcclxuICAgIHRoaXMuX3N1YnNjcmlwdGlvbnMucHVzaCh0aGlzLmZpbHRlclNlcnZpY2Uub25GaWx0ZXJDbGVhcmVkLnN1YnNjcmliZSgoKSA9PiB0aGlzLnJlc2V0UGFnaW5hdGlvbigpKSk7XHJcblxyXG4gICAgLy8gU3Vic2NyaWJlIHRvIGFueSBkYXRhdmlldyByb3cgY291bnQgY2hhbmdlZCBzbyB0aGF0IHdoZW4gQWRkaW5nL0RlbGV0aW5nIGl0ZW0ocykgdGhyb3VnaCB0aGUgRGF0YVZpZXdcclxuICAgIC8vIHRoYXQgd291bGQgdHJpZ2dlciBhIHJlZnJlc2ggb2YgdGhlIHBhZ2luYXRpb24gbnVtYmVyc1xyXG4gICAgaWYgKHRoaXMuZGF0YVZpZXcpIHtcclxuICAgICAgdGhpcy5fc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMuZ3JpZFNlcnZpY2Uub25JdGVtQWRkZWQuc3Vic2NyaWJlKChpdGVtczogYW55IHwgYW55W10pID0+IHRoaXMucHJvY2Vzc09uSXRlbUFkZGVkT3JSZW1vdmVkKGl0ZW1zLCB0cnVlKSkpO1xyXG4gICAgICB0aGlzLl9zdWJzY3JpcHRpb25zLnB1c2godGhpcy5ncmlkU2VydmljZS5vbkl0ZW1EZWxldGVkLnN1YnNjcmliZSgoaXRlbXM6IGFueSB8IGFueVtdKSA9PiB0aGlzLnByb2Nlc3NPbkl0ZW1BZGRlZE9yUmVtb3ZlZChpdGVtcywgZmFsc2UpKSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5yZWZyZXNoUGFnaW5hdGlvbihmYWxzZSwgZmFsc2UpO1xyXG4gICAgdGhpcy5faW5pdGlhbGl6ZWQgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIHRoaXMuX2luaXRpYWxpemVkID0gZmFsc2U7XHJcblxyXG4gICAgLy8gdW5zdWJzY3JpYmUgYWxsIFNsaWNrR3JpZCBldmVudHNcclxuICAgIHRoaXMuX2V2ZW50SGFuZGxlci51bnN1YnNjcmliZUFsbCgpO1xyXG5cclxuICAgIC8vIGFsc28gdW5zdWJzY3JpYmUgYWxsIEFuZ3VsYXIgU3Vic2NyaXB0aW9uc1xyXG4gICAgdGhpcy5fc3Vic2NyaXB0aW9ucyA9IHVuc3Vic2NyaWJlQWxsT2JzZXJ2YWJsZXModGhpcy5fc3Vic2NyaXB0aW9ucyk7XHJcbiAgfVxyXG5cclxuICBnZXRDdXJyZW50UGFnZU51bWJlcigpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX3BhZ2VOdW1iZXI7XHJcbiAgfVxyXG5cclxuICBnZXRDdXJyZW50UGFnaW5hdGlvbigpOiBDdXJyZW50UGFnaW5hdGlvbiAmIHsgcGFnZVNpemVzOiBudW1iZXJbXSB9IHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHBhZ2VOdW1iZXI6IHRoaXMuX3BhZ2VOdW1iZXIsXHJcbiAgICAgIHBhZ2VTaXplOiB0aGlzLl9pdGVtc1BlclBhZ2UsXHJcbiAgICAgIHBhZ2VTaXplczogdGhpcy5fYXZhaWxhYmxlUGFnZVNpemVzLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGdldEZ1bGxQYWdpbmF0aW9uKCk6IFNlcnZpY2VQYWdpbmF0aW9uIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHBhZ2VDb3VudDogdGhpcy5fcGFnZUNvdW50LFxyXG4gICAgICBwYWdlTnVtYmVyOiB0aGlzLl9wYWdlTnVtYmVyLFxyXG4gICAgICBwYWdlU2l6ZTogdGhpcy5faXRlbXNQZXJQYWdlLFxyXG4gICAgICBwYWdlU2l6ZXM6IHRoaXMuX2F2YWlsYWJsZVBhZ2VTaXplcyxcclxuICAgICAgdG90YWxJdGVtczogdGhpcy5fdG90YWxJdGVtcyxcclxuICAgICAgZGF0YUZyb206IHRoaXMuX2RhdGFGcm9tLFxyXG4gICAgICBkYXRhVG86IHRoaXMuX2RhdGFUbyxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBnZXRDdXJyZW50SXRlbVBlclBhZ2UoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLl9pdGVtc1BlclBhZ2U7XHJcbiAgfVxyXG5cclxuICBjaGFuZ2VJdGVtUGVyUGFnZShpdGVtc1BlclBhZ2U6IG51bWJlciwgZXZlbnQ/OiBhbnkpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgdGhpcy5fcGFnZU51bWJlciA9IDE7XHJcbiAgICB0aGlzLl9wYWdlQ291bnQgPSBNYXRoLmNlaWwodGhpcy5fdG90YWxJdGVtcyAvIGl0ZW1zUGVyUGFnZSk7XHJcbiAgICB0aGlzLl9pdGVtc1BlclBhZ2UgPSBpdGVtc1BlclBhZ2U7XHJcbiAgICByZXR1cm4gdGhpcy5wcm9jZXNzT25QYWdlQ2hhbmdlZCh0aGlzLl9wYWdlTnVtYmVyLCBldmVudCk7XHJcbiAgfVxyXG5cclxuICBnb1RvRmlyc3RQYWdlKGV2ZW50PzogYW55KTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHRoaXMuX3BhZ2VOdW1iZXIgPSAxO1xyXG4gICAgcmV0dXJuIHRoaXMucHJvY2Vzc09uUGFnZUNoYW5nZWQodGhpcy5fcGFnZU51bWJlciwgZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgZ29Ub0xhc3RQYWdlKGV2ZW50PzogYW55KTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHRoaXMuX3BhZ2VOdW1iZXIgPSB0aGlzLl9wYWdlQ291bnQgfHwgMTtcclxuICAgIHJldHVybiB0aGlzLnByb2Nlc3NPblBhZ2VDaGFuZ2VkKHRoaXMuX3BhZ2VOdW1iZXIsIGV2ZW50KTtcclxuICB9XHJcblxyXG4gIGdvVG9OZXh0UGFnZShldmVudD86IGFueSk6IFByb21pc2U8YW55PiB7XHJcbiAgICBpZiAodGhpcy5fcGFnZU51bWJlciA8IHRoaXMuX3BhZ2VDb3VudCkge1xyXG4gICAgICB0aGlzLl9wYWdlTnVtYmVyKys7XHJcbiAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NPblBhZ2VDaGFuZ2VkKHRoaXMuX3BhZ2VOdW1iZXIsIGV2ZW50KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHJlc29sdmUoZmFsc2UpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdvVG9QYWdlTnVtYmVyKHBhZ2VOdW1iZXI6IG51bWJlciwgZXZlbnQ/OiBhbnkpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgY29uc3QgcHJldmlvdXNQYWdlTnVtYmVyID0gdGhpcy5fcGFnZU51bWJlcjtcclxuXHJcbiAgICBpZiAocGFnZU51bWJlciA8IDEpIHtcclxuICAgICAgdGhpcy5fcGFnZU51bWJlciA9IDE7XHJcbiAgICB9IGVsc2UgaWYgKHBhZ2VOdW1iZXIgPiB0aGlzLl9wYWdlQ291bnQpIHtcclxuICAgICAgdGhpcy5fcGFnZU51bWJlciA9IHRoaXMuX3BhZ2VDb3VudDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX3BhZ2VOdW1iZXIgPSBwYWdlTnVtYmVyO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLl9wYWdlTnVtYmVyICE9PSBwcmV2aW91c1BhZ2VOdW1iZXIpIHtcclxuICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc09uUGFnZUNoYW5nZWQodGhpcy5fcGFnZU51bWJlciwgZXZlbnQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gcmVzb2x2ZShmYWxzZSkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ29Ub1ByZXZpb3VzUGFnZShldmVudD86IGFueSk6IFByb21pc2U8YW55PiB7XHJcbiAgICBpZiAodGhpcy5fcGFnZU51bWJlciA+IDEpIHtcclxuICAgICAgdGhpcy5fcGFnZU51bWJlci0tO1xyXG4gICAgICByZXR1cm4gdGhpcy5wcm9jZXNzT25QYWdlQ2hhbmdlZCh0aGlzLl9wYWdlTnVtYmVyLCBldmVudCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiByZXNvbHZlKGZhbHNlKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZWZyZXNoUGFnaW5hdGlvbihpc1BhZ2VOdW1iZXJSZXNldDogYm9vbGVhbiA9IGZhbHNlLCB0cmlnZ2VyQ2hhbmdlZEV2ZW50ID0gdHJ1ZSkge1xyXG4gICAgY29uc3QgcHJldmlvdXNQYWdpbmF0aW9uID0geyAuLi50aGlzLmdldEN1cnJlbnRQYWdpbmF0aW9uKCkgfTtcclxuXHJcbiAgICBpZiAodGhpcy5fcGFnaW5hdGlvbk9wdGlvbnMpIHtcclxuICAgICAgY29uc3QgcGFnaW5hdGlvbiA9IHRoaXMuX3BhZ2luYXRpb25PcHRpb25zO1xyXG5cclxuICAgICAgLy8gc2V0IHRoZSBudW1iZXIgb2YgaXRlbXMgcGVyIHBhZ2UgaWYgbm90IGFscmVhZHkgc2V0XHJcbiAgICAgIGlmICghdGhpcy5faXRlbXNQZXJQYWdlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2lzTG9jYWxHcmlkKSB7XHJcbiAgICAgICAgICB0aGlzLl9pdGVtc1BlclBhZ2UgPSBwYWdpbmF0aW9uLnBhZ2VTaXplO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLl9pdGVtc1BlclBhZ2UgPSArKCh0aGlzLl9iYWNrZW5kU2VydmljZUFwaSAmJiB0aGlzLl9iYWNrZW5kU2VydmljZUFwaS5vcHRpb25zICYmIHRoaXMuX2JhY2tlbmRTZXJ2aWNlQXBpLm9wdGlvbnMucGFnaW5hdGlvbk9wdGlvbnMgJiYgdGhpcy5fYmFja2VuZFNlcnZpY2VBcGkub3B0aW9ucy5wYWdpbmF0aW9uT3B0aW9ucy5maXJzdCkgPyB0aGlzLl9iYWNrZW5kU2VydmljZUFwaS5vcHRpb25zLnBhZ2luYXRpb25PcHRpb25zLmZpcnN0IDogcGFnaW5hdGlvbi5wYWdlU2l6ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBpZiB0b3RhbEl0ZW1zIGNoYW5nZWQsIHdlIHNob3VsZCBhbHdheXMgZ28gYmFjayB0byB0aGUgZmlyc3QgcGFnZSBhbmQgcmVjYWxjdWxhdGlvbiB0aGUgRnJvbS1UbyBpbmRleGVzXHJcbiAgICAgIGlmIChpc1BhZ2VOdW1iZXJSZXNldCB8fCB0aGlzLl90b3RhbEl0ZW1zICE9PSBwYWdpbmF0aW9uLnRvdGFsSXRlbXMpIHtcclxuICAgICAgICBpZiAoaXNQYWdlTnVtYmVyUmVzZXQpIHtcclxuICAgICAgICAgIHRoaXMuX3BhZ2VOdW1iZXIgPSAxO1xyXG4gICAgICAgICAgdGhpcy5wYWdpbmF0aW9uT3B0aW9ucy5wYWdlTnVtYmVyID0gMTtcclxuICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLl9pbml0aWFsaXplZCAmJiBwYWdpbmF0aW9uLnBhZ2VOdW1iZXIgJiYgcGFnaW5hdGlvbi5wYWdlTnVtYmVyID4gMSkge1xyXG4gICAgICAgICAgdGhpcy5fcGFnZU51bWJlciA9IHBhZ2luYXRpb24ucGFnZU51bWJlciB8fCAxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gd2hlbiBwYWdlIG51bWJlciBpcyBzZXQgdG8gMSB0aGVuIGFsc28gcmVzZXQgdGhlIFwib2Zmc2V0XCIgb2YgYmFja2VuZCBzZXJ2aWNlXHJcbiAgICAgICAgaWYgKHRoaXMuX3BhZ2VOdW1iZXIgPT09IDEgJiYgdGhpcy5fYmFja2VuZFNlcnZpY2VBcGkpIHtcclxuICAgICAgICAgIHRoaXMuX2JhY2tlbmRTZXJ2aWNlQXBpLnNlcnZpY2UucmVzZXRQYWdpbmF0aW9uT3B0aW9ucygpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gY2FsY3VsYXRlIGFuZCByZWZyZXNoIHRoZSBtdWx0aXBsZSBwcm9wZXJ0aWVzIG9mIHRoZSBwYWdpbmF0aW9uIFVJXHJcbiAgICAgIHRoaXMuX2F2YWlsYWJsZVBhZ2VTaXplcyA9IHBhZ2luYXRpb24ucGFnZVNpemVzO1xyXG4gICAgICBpZiAoIXRoaXMuX3RvdGFsSXRlbXMgJiYgcGFnaW5hdGlvbi50b3RhbEl0ZW1zKSB7XHJcbiAgICAgICAgdGhpcy5fdG90YWxJdGVtcyA9IHBhZ2luYXRpb24udG90YWxJdGVtcztcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnJlY2FsY3VsYXRlRnJvbVRvSW5kZXhlcygpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5fcGFnZUNvdW50ID0gTWF0aC5jZWlsKHRoaXMuX3RvdGFsSXRlbXMgLyB0aGlzLl9pdGVtc1BlclBhZ2UpO1xyXG4gICAgY29uc3QgY3VycmVudFBhZ2luYXRpb24gPSB0aGlzLmdldEN1cnJlbnRQYWdpbmF0aW9uKCk7XHJcbiAgICB0aGlzLnNoYXJlZFNlcnZpY2UuY3VycmVudFBhZ2luYXRpb24gPSBjdXJyZW50UGFnaW5hdGlvbjtcclxuXHJcbiAgICBpZiAodHJpZ2dlckNoYW5nZWRFdmVudCAmJiAhaXNlcXVhbChwcmV2aW91c1BhZ2luYXRpb24sIGN1cnJlbnRQYWdpbmF0aW9uKSkge1xyXG4gICAgICB0aGlzLm9uUGFnaW5hdGlvbkNoYW5nZWQubmV4dChjdXJyZW50UGFnaW5hdGlvbik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcm9jZXNzT25QYWdlQ2hhbmdlZChwYWdlTnVtYmVyOiBudW1iZXIsIGV2ZW50PzogRXZlbnQgfCB1bmRlZmluZWQpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgdGhpcy5yZWNhbGN1bGF0ZUZyb21Ub0luZGV4ZXMoKTtcclxuXHJcbiAgICAgIGlmICh0aGlzLl9pc0xvY2FsR3JpZCAmJiB0aGlzLmRhdGFWaWV3KSB7XHJcbiAgICAgICAgdGhpcy5kYXRhVmlldy5zZXRQYWdpbmdPcHRpb25zKHsgcGFnZVNpemU6IHRoaXMuX2l0ZW1zUGVyUGFnZSwgcGFnZU51bTogKHBhZ2VOdW1iZXIgLSAxKSB9KTsgLy8gZGF0YVZpZXcgcGFnZSBzdGFydHMgYXQgMCBpbnN0ZWFkIG9mIDFcclxuICAgICAgICB0aGlzLm9uUGFnaW5hdGlvbkNoYW5nZWQubmV4dCh0aGlzLmdldEZ1bGxQYWdpbmF0aW9uKCkpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IGl0ZW1zUGVyUGFnZSA9ICt0aGlzLl9pdGVtc1BlclBhZ2U7XHJcblxyXG4gICAgICAgIC8vIGtlZXAgc3RhcnQgdGltZSAmIGVuZCB0aW1lc3RhbXBzICYgcmV0dXJuIGl0IGFmdGVyIHByb2Nlc3MgZXhlY3V0aW9uXHJcbiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gbmV3IERhdGUoKTtcclxuXHJcbiAgICAgICAgLy8gcnVuIGFueSBwcmUtcHJvY2VzcywgaWYgZGVmaW5lZCwgZm9yIGV4YW1wbGUgYSBzcGlubmVyXHJcbiAgICAgICAgaWYgKHRoaXMuX2JhY2tlbmRTZXJ2aWNlQXBpLnByZVByb2Nlc3MpIHtcclxuICAgICAgICAgIHRoaXMuX2JhY2tlbmRTZXJ2aWNlQXBpLnByZVByb2Nlc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5fYmFja2VuZFNlcnZpY2VBcGkuc2VydmljZS5wcm9jZXNzT25QYWdpbmF0aW9uQ2hhbmdlZChldmVudCwgeyBuZXdQYWdlOiBwYWdlTnVtYmVyLCBwYWdlU2l6ZTogaXRlbXNQZXJQYWdlIH0pO1xyXG5cclxuICAgICAgICAvLyB0aGUgcHJvY2Vzc2VzIGNhbiBiZSBQcm9taXNlcyBvciBhbiBPYnNlcnZhYmxlcyAobGlrZSBIdHRwQ2xpZW50KVxyXG4gICAgICAgIGNvbnN0IHByb2Nlc3MgPSB0aGlzLl9iYWNrZW5kU2VydmljZUFwaS5wcm9jZXNzKHF1ZXJ5KTtcclxuICAgICAgICBpZiAocHJvY2VzcyBpbnN0YW5jZW9mIFByb21pc2UpIHtcclxuICAgICAgICAgIHByb2Nlc3NcclxuICAgICAgICAgICAgLnRoZW4oKHByb2Nlc3NSZXN1bHQ6IEdyYXBocWxSZXN1bHQgfCBHcmFwaHFsUGFnaW5hdGVkUmVzdWx0IHwgYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZShleGVjdXRlQmFja2VuZFByb2Nlc3Nlc0NhbGxiYWNrKHN0YXJ0VGltZSwgcHJvY2Vzc1Jlc3VsdCwgdGhpcy5fYmFja2VuZFNlcnZpY2VBcGksIHRoaXMuX3RvdGFsSXRlbXMpKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgIG9uQmFja2VuZEVycm9yKGVycm9yLCB0aGlzLl9iYWNrZW5kU2VydmljZUFwaSk7XHJcbiAgICAgICAgICAgICAgcmVqZWN0KHByb2Nlc3MpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2UgaWYgKGlzT2JzZXJ2YWJsZShwcm9jZXNzKSkge1xyXG4gICAgICAgICAgcHJvY2Vzcy5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgIChwcm9jZXNzUmVzdWx0OiBHcmFwaHFsUmVzdWx0IHwgR3JhcGhxbFBhZ2luYXRlZFJlc3VsdCB8IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgIHJlc29sdmUoZXhlY3V0ZUJhY2tlbmRQcm9jZXNzZXNDYWxsYmFjayhzdGFydFRpbWUsIHByb2Nlc3NSZXN1bHQsIHRoaXMuX2JhY2tlbmRTZXJ2aWNlQXBpLCB0aGlzLl90b3RhbEl0ZW1zKSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgb25CYWNrZW5kRXJyb3IoZXJyb3IsIHRoaXMuX2JhY2tlbmRTZXJ2aWNlQXBpKTtcclxuICAgICAgICAgICAgICByZWplY3QocHJvY2Vzcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMub25QYWdpbmF0aW9uQ2hhbmdlZC5uZXh0KHRoaXMuZ2V0RnVsbFBhZ2luYXRpb24oKSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmVjYWxjdWxhdGVGcm9tVG9JbmRleGVzKCkge1xyXG4gICAgaWYgKHRoaXMuX3RvdGFsSXRlbXMgPT09IDApIHtcclxuICAgICAgdGhpcy5fZGF0YUZyb20gPSAwO1xyXG4gICAgICB0aGlzLl9kYXRhVG8gPSAxO1xyXG4gICAgICB0aGlzLl9wYWdlTnVtYmVyID0gMDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2RhdGFGcm9tID0gdGhpcy5fcGFnZU51bWJlciA+IDEgPyAoKHRoaXMuX3BhZ2VOdW1iZXIgKiB0aGlzLl9pdGVtc1BlclBhZ2UpIC0gdGhpcy5faXRlbXNQZXJQYWdlICsgMSkgOiAxO1xyXG4gICAgICB0aGlzLl9kYXRhVG8gPSAodGhpcy5fdG90YWxJdGVtcyA8IHRoaXMuX2l0ZW1zUGVyUGFnZSkgPyB0aGlzLl90b3RhbEl0ZW1zIDogKCh0aGlzLl9wYWdlTnVtYmVyIHx8IDEpICogdGhpcy5faXRlbXNQZXJQYWdlKTtcclxuICAgICAgaWYgKHRoaXMuX2RhdGFUbyA+IHRoaXMuX3RvdGFsSXRlbXMpIHtcclxuICAgICAgICB0aGlzLl9kYXRhVG8gPSB0aGlzLl90b3RhbEl0ZW1zO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5fdG90YWxJdGVtcyA+IDAgJiYgdGhpcy5fcGFnZU51bWJlciA9PT0gMCkge1xyXG4gICAgICB0aGlzLl9wYWdlTnVtYmVyID0gMTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBkbyBhIGZpbmFsIGNoZWNrIG9uIHRoZSBGcm9tL1RvIGFuZCBtYWtlIHN1cmUgdGhleSBhcmUgbm90IG92ZXIgb3IgYmVsb3cgbWluL21heCBhY2NlcHRhYmxlIHZhbHVlc1xyXG4gICAgaWYgKHRoaXMuX2RhdGFUbyA+IHRoaXMuX3RvdGFsSXRlbXMpIHtcclxuICAgICAgdGhpcy5fZGF0YVRvID0gdGhpcy5fdG90YWxJdGVtcztcclxuICAgIH0gZWxzZSBpZiAodGhpcy5fdG90YWxJdGVtcyA8IHRoaXMuX2l0ZW1zUGVyUGFnZSkge1xyXG4gICAgICB0aGlzLl9kYXRhVG8gPSB0aGlzLl90b3RhbEl0ZW1zO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqIFJlc2V0IHRoZSBQYWdpbmF0aW9uIHRvIGZpcnN0IHBhZ2UgYW5kIHJlY2FsY3VsYXRlIG5lY2Vzc2FyeSBudW1iZXJzICovXHJcbiAgcmVzZXRQYWdpbmF0aW9uKHRyaWdnZXJDaGFuZ2VkRXZlbnQgPSB0cnVlKSB7XHJcbiAgICBpZiAodGhpcy5faXNMb2NhbEdyaWQpIHtcclxuICAgICAgLy8gb24gYSBsb2NhbCBncmlkIHdlIGFsc28gbmVlZCB0byByZXNldCB0aGUgRGF0YVZpZXcgcGFnaW5nIHRvIDFzdCBwYWdlXHJcbiAgICAgIHRoaXMuZGF0YVZpZXcuc2V0UGFnaW5nT3B0aW9ucyh7IHBhZ2VTaXplOiB0aGlzLl9pdGVtc1BlclBhZ2UsIHBhZ2VOdW06IDAgfSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnJlZnJlc2hQYWdpbmF0aW9uKHRydWUsIHRyaWdnZXJDaGFuZ2VkRXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVG9nZ2xlIHRoZSBQYWdpbmF0aW9uIChzaG93L2hpZGUpLCBpdCB3aWxsIHVzZSB0aGUgdmlzaWJsZSBpZiBkZWZpbmVkIGVsc2UgaXQgd2lsbCBhdXRvbWF0aWNhbGx5IGludmVyc2Ugd2hlbiBjYWxsZWQgd2l0aG91dCBhcmd1bWVudFxyXG4gICAqXHJcbiAgICogSU1QT1JUQU5UIE5PVEU6XHJcbiAgICogVGhlIFBhZ2luYXRpb24gbXVzdCBiZSBjcmVhdGVkIG9uIGluaXRpYWwgcGFnZSBsb2FkLCB0aGVuIG9ubHkgYWZ0ZXIgY2FuIHlvdSB0b2dnbGUgaXQuXHJcbiAgICogQmFzaWNhbGx5IHRoaXMgbWV0aG9kIFdJTEwgTk9UIFdPUksgdG8gc2hvdyB0aGUgUGFnaW5hdGlvbiBpZiBpdCB3YXMgbm90IHRoZXJlIGZyb20gdGhlIHN0YXJ0LlxyXG4gICAqL1xyXG4gIHRvZ2dsZVBhZ2luYXRpb25WaXNpYmlsaXR5KHZpc2libGU/OiBib29sZWFuKSB7XHJcbiAgICBpZiAodGhpcy5ncmlkICYmIHRoaXMuc2hhcmVkU2VydmljZSAmJiB0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMpIHtcclxuICAgICAgY29uc3QgaXNWaXNpYmxlID0gdmlzaWJsZSAhPT0gdW5kZWZpbmVkID8gdmlzaWJsZSA6ICF0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlUGFnaW5hdGlvbjtcclxuICAgICAgdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLmVuYWJsZVBhZ2luYXRpb24gPSBpc1Zpc2libGU7XHJcbiAgICAgIHRoaXMub25QYWdpbmF0aW9uVmlzaWJpbGl0eUNoYW5nZWQubmV4dCh7IHZpc2libGU6IGlzVmlzaWJsZSB9KTtcclxuXHJcbiAgICAgIC8vIG1ha2Ugc3VyZSB0byByZXNldCB0aGUgUGFnaW5hdGlvbiBhbmQgZ28gYmFjayB0byBmaXJzdCBwYWdlIHRvIGF2b2lkIGFueSBpc3N1ZXMgd2l0aCBQYWdpbmF0aW9uIGJlaW5nIG9mZnNldFxyXG4gICAgICBpZiAoaXNWaXNpYmxlKSB7XHJcbiAgICAgICAgdGhpcy5nb1RvRmlyc3RQYWdlKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIHdoZW4gdXNpbmcgYSBsb2NhbCBncmlkLCB3ZSBjYW4gcmVzZXQgdGhlIERhdGFWaWV3IHBhZ2luYXRpb24gYnkgY2hhbmdpbmcgaXRzIHBhZ2Ugc2l6ZVxyXG4gICAgICAvLyBwYWdlIHNpemUgb2YgMCB3b3VsZCBzaG93IGFsbCwgaGVuY2UgY2FuY2VsIHRoZSBwYWdpbmF0aW9uXHJcbiAgICAgIGlmICh0aGlzLl9pc0xvY2FsR3JpZCkge1xyXG4gICAgICAgIGNvbnN0IHBhZ2VTaXplID0gdmlzaWJsZSA/IHRoaXMuX2l0ZW1zUGVyUGFnZSA6IDA7XHJcbiAgICAgICAgdGhpcy5kYXRhVmlldy5zZXRQYWdpbmdPcHRpb25zKHsgcGFnZVNpemUsIHBhZ2VOdW06IDAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIC0tXHJcbiAgLy8gcHJpdmF0ZSBmdW5jdGlvbnNcclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAvKipcclxuICAgKiBXaGVuIGl0ZW0gaXMgYWRkZWQgb3IgcmVtb3ZlZCwgd2Ugd2lsbCByZWZyZXNoIHRoZSBudW1iZXJzIG9uIHRoZSBwYWdpbmF0aW9uIGhvd2V2ZXIgd2Ugd29uJ3QgdHJpZ2dlciBhIGJhY2tlbmQgY2hhbmdlXHJcbiAgICogVGhpcyB3aWxsIGhhdmUgYSBzaWRlIGVmZmVjdCB0aG91Z2gsIHdoaWNoIGlzIHRoYXQgdGhlIFwiVG9cIiBjb3VudCB3b24ndCBiZSBtYXRjaGluZyB0aGUgXCJpdGVtcyBwZXIgcGFnZVwiIGNvdW50LFxyXG4gICAqIHRoYXQgaXMgYSBuZWNlc3Nhcnkgc2lkZSBlZmZlY3QgdG8gYXZvaWQgdHJpZ2dlcmluZyBhIGJhY2tlbmQgcXVlcnkganVzdCB0byByZWZyZXNoIHRoZSBwYWdpbmcsXHJcbiAgICogYmFzaWNhbGx5IHdlIGFzc3VtZSB0aGF0IHRoaXMgb2Zmc2V0IGlzIGZpbmUgZm9yIHRoZSB0aW1lIGJlaW5nLFxyXG4gICAqIHVudGlsIHVzZXIgZG9lcyBhbiBhY3Rpb24gd2hpY2ggd2lsbCByZWZyZXNoIHRoZSBkYXRhIGhlbmNlIHRoZSBwYWdpbmF0aW9uIHdoaWNoIHdpbGwgdGhlbiBiZWNvbWUgbm9ybWFsIGFnYWluXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBwcm9jZXNzT25JdGVtQWRkZWRPclJlbW92ZWQoaXRlbXM6IGFueSB8IGFueVtdLCBpc0l0ZW1BZGRlZCA9IHRydWUpIHtcclxuICAgIGlmIChpdGVtcyAhPT0gbnVsbCkge1xyXG4gICAgICBjb25zdCBwcmV2aW91c0RhdGFUbyA9IHRoaXMuX2RhdGFUbztcclxuICAgICAgY29uc3QgaXRlbUNvdW50ID0gQXJyYXkuaXNBcnJheShpdGVtcykgPyBpdGVtcy5sZW5ndGggOiAxO1xyXG4gICAgICBjb25zdCBpdGVtQ291bnRXaXRoRGlyZWN0aW9uID0gaXNJdGVtQWRkZWQgPyAraXRlbUNvdW50IDogLWl0ZW1Db3VudDtcclxuXHJcbiAgICAgIC8vIHJlZnJlc2ggdGhlIHRvdGFsIGNvdW50IGluIHRoZSBwYWdpbmF0aW9uIGFuZCBpbiB0aGUgVUlcclxuICAgICAgdGhpcy5fdG90YWxJdGVtcyArPSBpdGVtQ291bnRXaXRoRGlyZWN0aW9uO1xyXG4gICAgICB0aGlzLnJlY2FsY3VsYXRlRnJvbVRvSW5kZXhlcygpO1xyXG5cclxuICAgICAgLy8gZmluYWxseSByZWZyZXNoIHRoZSBcIlRvXCIgY291bnQgYW5kIHdlIGtub3cgaXQgbWlnaHQgYmUgZGlmZmVyZW50IHRoYW4gdGhlIFwiaXRlbXMgcGVyIHBhZ2VcIiBjb3VudFxyXG4gICAgICAvLyBidXQgdGhpcyBpcyBuZWNlc3Nhcnkgc2luY2Ugd2UgZG9uJ3Qgd2FudCBhbiBhY3R1YWwgYmFja2VuZCByZWZyZXNoXHJcbiAgICAgIHRoaXMuX2RhdGFUbyA9IHByZXZpb3VzRGF0YVRvICsgaXRlbUNvdW50V2l0aERpcmVjdGlvbjtcclxuICAgICAgdGhpcy5vblBhZ2luYXRpb25DaGFuZ2VkLm5leHQodGhpcy5nZXRGdWxsUGFnaW5hdGlvbigpKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19