import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { isObservable, Subject } from 'rxjs';
import * as isequal_ from 'lodash.isequal';
const isequal = isequal_; // patch to fix rollup to work
import { FilterService } from './filter.service';
import { GridService } from './grid.service';
import { SharedService } from './shared.service';
import { executeBackendProcessesCallback, onBackendError } from './backend-utilities';
import { unsubscribeAllObservables } from './utilities';
let PaginationService = class PaginationService {
    /** Constructor */
    constructor(filterService, gridService, sharedService) {
        this.filterService = filterService;
        this.gridService = gridService;
        this.sharedService = sharedService;
        this._initialized = false;
        this._isLocalGrid = true;
        this._dataFrom = 1;
        this._dataTo = 1;
        this._pageCount = 1;
        this._pageNumber = 1;
        this._totalItems = 0;
        this._eventHandler = new Slick.EventHandler();
        this._subscriptions = [];
        this.onPaginationChanged = new Subject();
        this.onPaginationVisibilityChanged = new Subject();
    }
    get paginationOptions() {
        return this._paginationOptions;
    }
    set paginationOptions(paginationOptions) {
        this._paginationOptions = paginationOptions;
    }
    get availablePageSizes() {
        return this._availablePageSizes;
    }
    get dataFrom() {
        return this._dataFrom;
    }
    get dataTo() {
        return this._dataTo;
    }
    get itemsPerPage() {
        return this._itemsPerPage;
    }
    get pageCount() {
        return this._pageCount;
    }
    get pageNumber() {
        return this._pageNumber;
    }
    set totalItems(totalItems) {
        this._totalItems = totalItems;
        if (this._initialized) {
            this.refreshPagination();
        }
    }
    get totalItems() {
        return this._totalItems;
    }
    init(grid, dataView, paginationOptions, backendServiceApi) {
        this._availablePageSizes = paginationOptions.pageSizes;
        this.dataView = dataView;
        this.grid = grid;
        this._backendServiceApi = backendServiceApi;
        this._paginationOptions = paginationOptions;
        this._isLocalGrid = !backendServiceApi;
        this._pageNumber = paginationOptions.pageNumber || 1;
        if (backendServiceApi && (!backendServiceApi.service || !backendServiceApi.process)) {
            throw new Error(`BackendServiceApi requires the following 2 properties "process" and "service" to be defined.`);
        }
        if (this._isLocalGrid && this.dataView) {
            this.dataView.onPagingInfoChanged.subscribe((e, pagingInfo) => {
                if (this._totalItems !== pagingInfo.totalRows) {
                    this._totalItems = pagingInfo.totalRows;
                    this._paginationOptions.totalItems = this._totalItems;
                    this.refreshPagination(false, false);
                }
            });
            dataView.setRefreshHints({ isFilterUnchanged: true });
            dataView.setPagingOptions({ pageSize: this.paginationOptions.pageSize, pageNum: (this._pageNumber - 1) }); // dataView page starts at 0 instead of 1
        }
        // Subscribe to Filter Clear & Changed and go back to page 1 when that happen
        this._subscriptions.push(this.filterService.onFilterChanged.subscribe(() => this.resetPagination()));
        this._subscriptions.push(this.filterService.onFilterCleared.subscribe(() => this.resetPagination()));
        // Subscribe to any dataview row count changed so that when Adding/Deleting item(s) through the DataView
        // that would trigger a refresh of the pagination numbers
        if (this.dataView) {
            this._subscriptions.push(this.gridService.onItemAdded.subscribe((items) => this.processOnItemAddedOrRemoved(items, true)));
            this._subscriptions.push(this.gridService.onItemDeleted.subscribe((items) => this.processOnItemAddedOrRemoved(items, false)));
        }
        this.refreshPagination(false, false);
        this._initialized = true;
    }
    dispose() {
        this._initialized = false;
        // unsubscribe all SlickGrid events
        this._eventHandler.unsubscribeAll();
        // also unsubscribe all Angular Subscriptions
        this._subscriptions = unsubscribeAllObservables(this._subscriptions);
    }
    getCurrentPageNumber() {
        return this._pageNumber;
    }
    getCurrentPagination() {
        return {
            pageNumber: this._pageNumber,
            pageSize: this._itemsPerPage,
            pageSizes: this._availablePageSizes,
        };
    }
    getFullPagination() {
        return {
            pageCount: this._pageCount,
            pageNumber: this._pageNumber,
            pageSize: this._itemsPerPage,
            pageSizes: this._availablePageSizes,
            totalItems: this._totalItems,
            dataFrom: this._dataFrom,
            dataTo: this._dataTo,
        };
    }
    getCurrentItemPerPage() {
        return this._itemsPerPage;
    }
    changeItemPerPage(itemsPerPage, event) {
        this._pageNumber = 1;
        this._pageCount = Math.ceil(this._totalItems / itemsPerPage);
        this._itemsPerPage = itemsPerPage;
        return this.processOnPageChanged(this._pageNumber, event);
    }
    goToFirstPage(event) {
        this._pageNumber = 1;
        return this.processOnPageChanged(this._pageNumber, event);
    }
    goToLastPage(event) {
        this._pageNumber = this._pageCount || 1;
        return this.processOnPageChanged(this._pageNumber, event);
    }
    goToNextPage(event) {
        if (this._pageNumber < this._pageCount) {
            this._pageNumber++;
            return this.processOnPageChanged(this._pageNumber, event);
        }
        else {
            return new Promise(resolve => resolve(false));
        }
    }
    goToPageNumber(pageNumber, event) {
        const previousPageNumber = this._pageNumber;
        if (pageNumber < 1) {
            this._pageNumber = 1;
        }
        else if (pageNumber > this._pageCount) {
            this._pageNumber = this._pageCount;
        }
        else {
            this._pageNumber = pageNumber;
        }
        if (this._pageNumber !== previousPageNumber) {
            return this.processOnPageChanged(this._pageNumber, event);
        }
        else {
            return new Promise(resolve => resolve(false));
        }
    }
    goToPreviousPage(event) {
        if (this._pageNumber > 1) {
            this._pageNumber--;
            return this.processOnPageChanged(this._pageNumber, event);
        }
        else {
            return new Promise(resolve => resolve(false));
        }
    }
    refreshPagination(isPageNumberReset = false, triggerChangedEvent = true) {
        const previousPagination = Object.assign({}, this.getCurrentPagination());
        if (this._paginationOptions) {
            const pagination = this._paginationOptions;
            // set the number of items per page if not already set
            if (!this._itemsPerPage) {
                if (this._isLocalGrid) {
                    this._itemsPerPage = pagination.pageSize;
                }
                else {
                    this._itemsPerPage = +((this._backendServiceApi && this._backendServiceApi.options && this._backendServiceApi.options.paginationOptions && this._backendServiceApi.options.paginationOptions.first) ? this._backendServiceApi.options.paginationOptions.first : pagination.pageSize);
                }
            }
            // if totalItems changed, we should always go back to the first page and recalculation the From-To indexes
            if (isPageNumberReset || this._totalItems !== pagination.totalItems) {
                if (isPageNumberReset) {
                    this._pageNumber = 1;
                    this.paginationOptions.pageNumber = 1;
                }
                else if (!this._initialized && pagination.pageNumber && pagination.pageNumber > 1) {
                    this._pageNumber = pagination.pageNumber || 1;
                }
                // when page number is set to 1 then also reset the "offset" of backend service
                if (this._pageNumber === 1 && this._backendServiceApi) {
                    this._backendServiceApi.service.resetPaginationOptions();
                }
            }
            // calculate and refresh the multiple properties of the pagination UI
            this._availablePageSizes = pagination.pageSizes;
            if (!this._totalItems && pagination.totalItems) {
                this._totalItems = pagination.totalItems;
            }
            this.recalculateFromToIndexes();
        }
        this._pageCount = Math.ceil(this._totalItems / this._itemsPerPage);
        const currentPagination = this.getCurrentPagination();
        this.sharedService.currentPagination = currentPagination;
        if (triggerChangedEvent && !isequal(previousPagination, currentPagination)) {
            this.onPaginationChanged.next(currentPagination);
        }
    }
    processOnPageChanged(pageNumber, event) {
        return new Promise((resolve, reject) => {
            this.recalculateFromToIndexes();
            if (this._isLocalGrid && this.dataView) {
                this.dataView.setPagingOptions({ pageSize: this._itemsPerPage, pageNum: (pageNumber - 1) }); // dataView page starts at 0 instead of 1
                this.onPaginationChanged.next(this.getFullPagination());
            }
            else {
                const itemsPerPage = +this._itemsPerPage;
                // keep start time & end timestamps & return it after process execution
                const startTime = new Date();
                // run any pre-process, if defined, for example a spinner
                if (this._backendServiceApi.preProcess) {
                    this._backendServiceApi.preProcess();
                }
                const query = this._backendServiceApi.service.processOnPaginationChanged(event, { newPage: pageNumber, pageSize: itemsPerPage });
                // the processes can be Promises or an Observables (like HttpClient)
                const process = this._backendServiceApi.process(query);
                if (process instanceof Promise) {
                    process
                        .then((processResult) => {
                        resolve(executeBackendProcessesCallback(startTime, processResult, this._backendServiceApi, this._totalItems));
                    })
                        .catch((error) => {
                        onBackendError(error, this._backendServiceApi);
                        reject(process);
                    });
                }
                else if (isObservable(process)) {
                    process.subscribe((processResult) => {
                        resolve(executeBackendProcessesCallback(startTime, processResult, this._backendServiceApi, this._totalItems));
                    }, (error) => {
                        onBackendError(error, this._backendServiceApi);
                        reject(process);
                    });
                }
                this.onPaginationChanged.next(this.getFullPagination());
            }
        });
    }
    recalculateFromToIndexes() {
        if (this._totalItems === 0) {
            this._dataFrom = 0;
            this._dataTo = 1;
            this._pageNumber = 0;
        }
        else {
            this._dataFrom = this._pageNumber > 1 ? ((this._pageNumber * this._itemsPerPage) - this._itemsPerPage + 1) : 1;
            this._dataTo = (this._totalItems < this._itemsPerPage) ? this._totalItems : ((this._pageNumber || 1) * this._itemsPerPage);
            if (this._dataTo > this._totalItems) {
                this._dataTo = this._totalItems;
            }
        }
        if (this._totalItems > 0 && this._pageNumber === 0) {
            this._pageNumber = 1;
        }
        // do a final check on the From/To and make sure they are not over or below min/max acceptable values
        if (this._dataTo > this._totalItems) {
            this._dataTo = this._totalItems;
        }
        else if (this._totalItems < this._itemsPerPage) {
            this._dataTo = this._totalItems;
        }
    }
    /** Reset the Pagination to first page and recalculate necessary numbers */
    resetPagination(triggerChangedEvent = true) {
        if (this._isLocalGrid) {
            // on a local grid we also need to reset the DataView paging to 1st page
            this.dataView.setPagingOptions({ pageSize: this._itemsPerPage, pageNum: 0 });
        }
        this.refreshPagination(true, triggerChangedEvent);
    }
    /**
     * Toggle the Pagination (show/hide), it will use the visible if defined else it will automatically inverse when called without argument
     *
     * IMPORTANT NOTE:
     * The Pagination must be created on initial page load, then only after can you toggle it.
     * Basically this method WILL NOT WORK to show the Pagination if it was not there from the start.
     */
    togglePaginationVisibility(visible) {
        if (this.grid && this.sharedService && this.sharedService.gridOptions) {
            const isVisible = visible !== undefined ? visible : !this.sharedService.gridOptions.enablePagination;
            this.sharedService.gridOptions.enablePagination = isVisible;
            this.onPaginationVisibilityChanged.next({ visible: isVisible });
            // make sure to reset the Pagination and go back to first page to avoid any issues with Pagination being offset
            if (isVisible) {
                this.goToFirstPage();
            }
            // when using a local grid, we can reset the DataView pagination by changing its page size
            // page size of 0 would show all, hence cancel the pagination
            if (this._isLocalGrid) {
                const pageSize = visible ? this._itemsPerPage : 0;
                this.dataView.setPagingOptions({ pageSize, pageNum: 0 });
            }
        }
    }
    // --
    // private functions
    // --------------------
    /**
     * When item is added or removed, we will refresh the numbers on the pagination however we won't trigger a backend change
     * This will have a side effect though, which is that the "To" count won't be matching the "items per page" count,
     * that is a necessary side effect to avoid triggering a backend query just to refresh the paging,
     * basically we assume that this offset is fine for the time being,
     * until user does an action which will refresh the data hence the pagination which will then become normal again
     */
    processOnItemAddedOrRemoved(items, isItemAdded = true) {
        if (items !== null) {
            const previousDataTo = this._dataTo;
            const itemCount = Array.isArray(items) ? items.length : 1;
            const itemCountWithDirection = isItemAdded ? +itemCount : -itemCount;
            // refresh the total count in the pagination and in the UI
            this._totalItems += itemCountWithDirection;
            this.recalculateFromToIndexes();
            // finally refresh the "To" count and we know it might be different than the "items per page" count
            // but this is necessary since we don't want an actual backend refresh
            this._dataTo = previousDataTo + itemCountWithDirection;
            this.onPaginationChanged.next(this.getFullPagination());
        }
    }
};
PaginationService = tslib_1.__decorate([
    Injectable(),
    tslib_1.__metadata("design:paramtypes", [FilterService, GridService, SharedService])
], PaginationService);
export { PaginationService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnaW5hdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci1zbGlja2dyaWQvIiwic291cmNlcyI6WyJhcHAvbW9kdWxlcy9hbmd1bGFyLXNsaWNrZ3JpZC9zZXJ2aWNlcy9wYWdpbmF0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFnQixZQUFZLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNELE9BQU8sS0FBSyxRQUFRLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsTUFBTSxPQUFPLEdBQUcsUUFBUSxDQUFDLENBQUMsOEJBQThCO0FBR3hELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2pELE9BQU8sRUFBRSwrQkFBK0IsRUFBRSxjQUFjLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RixPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFNeEQsSUFBYSxpQkFBaUIsR0FBOUIsTUFBYSxpQkFBaUI7SUFvQjVCLGtCQUFrQjtJQUNsQixZQUFvQixhQUE0QixFQUFVLFdBQXdCLEVBQVUsYUFBNEI7UUFBcEcsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFBVSxnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUFVLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBcEJoSCxpQkFBWSxHQUFHLEtBQUssQ0FBQztRQUNyQixpQkFBWSxHQUFHLElBQUksQ0FBQztRQUVwQixjQUFTLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsWUFBTyxHQUFHLENBQUMsQ0FBQztRQUVaLGVBQVUsR0FBRyxDQUFDLENBQUM7UUFDZixnQkFBVyxHQUFHLENB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RUFBRTs2Q0FzQndCLGFBQWEsRUFBdUIsV0FBVyxFQUF5QixhQUFhO0dBckI3RyxpQkFBaUIsQ0F3WDdCO1NBeFhZLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uLCBpc09ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0ICogYXMgaXNlcXVhbF8gZnJvbSAnbG9kYXNoLmlzZXF1YWwnO1xyXG5jb25zdCBpc2VxdWFsID0gaXNlcXVhbF87IC8vIHBhdGNoIHRvIGZpeCByb2xsdXAgdG8gd29ya1xyXG5cclxuaW1wb3J0IHsgQmFja2VuZFNlcnZpY2VBcGksIEN1cnJlbnRQYWdpbmF0aW9uLCBHcmFwaHFsUmVzdWx0LCBHcmFwaHFsUGFnaW5hdGVkUmVzdWx0LCBHcmlkT3B0aW9uLCBQYWdpbmF0aW9uLCBTZXJ2aWNlUGFnaW5hdGlvbiB9IGZyb20gJy4uL21vZGVscyc7XHJcbmltcG9ydCB7IEZpbHRlclNlcnZpY2UgfSBmcm9tICcuL2ZpbHRlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgR3JpZFNlcnZpY2UgfSBmcm9tICcuL2dyaWQuc2VydmljZSc7XHJcbmltcG9ydCB7IFNoYXJlZFNlcnZpY2UgfSBmcm9tICcuL3NoYXJlZC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgZXhlY3V0ZUJhY2tlbmRQcm9jZXNzZXNDYWxsYmFjaywgb25CYWNrZW5kRXJyb3IgfSBmcm9tICcuL2JhY2tlbmQtdXRpbGl0aWVzJztcclxuaW1wb3J0IHsgdW5zdWJzY3JpYmVBbGxPYnNlcnZhYmxlcyB9IGZyb20gJy4vdXRpbGl0aWVzJztcclxuXHJcbi8vIHVzaW5nIGV4dGVybmFsIG5vbi10eXBlZCBqcyBsaWJyYXJpZXNcclxuZGVjbGFyZSB2YXIgU2xpY2s6IGFueTtcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFBhZ2luYXRpb25TZXJ2aWNlIHtcclxuICBwcml2YXRlIF9pbml0aWFsaXplZCA9IGZhbHNlO1xyXG4gIHByaXZhdGUgX2lzTG9jYWxHcmlkID0gdHJ1ZTtcclxuICBwcml2YXRlIF9iYWNrZW5kU2VydmljZUFwaTogQmFja2VuZFNlcnZpY2VBcGk7XHJcbiAgcHJpdmF0ZSBfZGF0YUZyb20gPSAxO1xyXG4gIHByaXZhdGUgX2RhdGFUbyA9IDE7XHJcbiAgcHJpdmF0ZSBfaXRlbXNQZXJQYWdlOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBfcGFnZUNvdW50ID0gMTtcclxuICBwcml2YXRlIF9wYWdlTnVtYmVyID0gMTtcclxuICBwcml2YXRlIF90b3RhbEl0ZW1zID0gMDtcclxuICBwcml2YXRlIF9hdmFpbGFibGVQYWdlU2l6ZXM6IG51bWJlcltdO1xyXG4gIHByaXZhdGUgX2V2ZW50SGFuZGxlciA9IG5ldyBTbGljay5FdmVudEhhbmRsZXIoKTtcclxuICBwcml2YXRlIF9wYWdpbmF0aW9uT3B0aW9uczogUGFnaW5hdGlvbjtcclxuICBwcml2YXRlIF9zdWJzY3JpcHRpb25zOiBTdWJzY3JpcHRpb25bXSA9IFtdO1xyXG4gIG9uUGFnaW5hdGlvbkNoYW5nZWQgPSBuZXcgU3ViamVjdDxTZXJ2aWNlUGFnaW5hdGlvbj4oKTtcclxuICBvblBhZ2luYXRpb25WaXNpYmlsaXR5Q2hhbmdlZCA9IG5ldyBTdWJqZWN0PHsgdmlzaWJsZTogYm9vbGVhbiB9PigpO1xyXG5cclxuICBkYXRhVmlldzogYW55O1xyXG4gIGdyaWQ6IGFueTtcclxuXHJcbiAgLyoqIENvbnN0cnVjdG9yICovXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBmaWx0ZXJTZXJ2aWNlOiBGaWx0ZXJTZXJ2aWNlLCBwcml2YXRlIGdyaWRTZXJ2aWNlOiBHcmlkU2VydmljZSwgcHJpdmF0ZSBzaGFyZWRTZXJ2aWNlOiBTaGFyZWRTZXJ2aWNlKSB7IH1cclxuXHJcbiAgZ2V0IHBhZ2luYXRpb25PcHRpb25zKCk6IFBhZ2luYXRpb24ge1xyXG4gICAgcmV0dXJuIHRoaXMuX3BhZ2luYXRpb25PcHRpb25zO1xyXG4gIH1cclxuICBzZXQgcGFnaW5hdGlvbk9wdGlvbnMocGFnaW5hdGlvbk9wdGlvbnM6IFBhZ2luYXRpb24pIHtcclxuICAgIHRoaXMuX3BhZ2luYXRpb25PcHRpb25zID0gcGFnaW5hdGlvbk9wdGlvbnM7XHJcbiAgfVxyXG5cclxuICBnZXQgYXZhaWxhYmxlUGFnZVNpemVzKCk6IG51bWJlcltdIHtcclxuICAgIHJldHVybiB0aGlzLl9hdmFpbGFibGVQYWdlU2l6ZXM7XHJcbiAgfVxyXG5cclxuICBnZXQgZGF0YUZyb20oKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLl9kYXRhRnJvbTtcclxuICB9XHJcblxyXG4gIGdldCBkYXRhVG8oKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLl9kYXRhVG87XHJcbiAgfVxyXG5cclxuICBnZXQgaXRlbXNQZXJQYWdlKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5faXRlbXNQZXJQYWdlO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHBhZ2VDb3VudCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX3BhZ2VDb3VudDtcclxuICB9XHJcblxyXG4gIGdldCBwYWdlTnVtYmVyKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5fcGFnZU51bWJlcjtcclxuICB9XHJcblxyXG4gIHNldCB0b3RhbEl0ZW1zKHRvdGFsSXRlbXM6IG51bWJlcikge1xyXG4gICAgdGhpcy5fdG90YWxJdGVtcyA9IHRvdGFsSXRlbXM7XHJcbiAgICBpZiAodGhpcy5faW5pdGlhbGl6ZWQpIHtcclxuICAgICAgdGhpcy5yZWZyZXNoUGFnaW5hdGlvbigpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0IHRvdGFsSXRlbXMoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLl90b3RhbEl0ZW1zO1xyXG4gIH1cclxuXHJcbiAgaW5pdChncmlkOiBhbnksIGRhdGFWaWV3OiBhbnksIHBhZ2luYXRpb25PcHRpb25zOiBQYWdpbmF0aW9uLCBiYWNrZW5kU2VydmljZUFwaT86IEJhY2tlbmRTZXJ2aWNlQXBpKSB7XHJcbiAgICB0aGlzLl9hdmFpbGFibGVQYWdlU2l6ZXMgPSBwYWdpbmF0aW9uT3B0aW9ucy5wYWdlU2l6ZXM7XHJcbiAgICB0aGlzLmRhdGFWaWV3ID0gZGF0YVZpZXc7XHJcbiAgICB0aGlzLmdyaWQgPSBncmlkO1xyXG4gICAgdGhpcy5fYmFja2VuZFNlcnZpY2VBcGkgPSBiYWNrZW5kU2VydmljZUFwaTtcclxuICAgIHRoaXMuX3BhZ2luYXRpb25PcHRpb25zID0gcGFnaW5hdGlvbk9wdGlvbnM7XHJcbiAgICB0aGlzLl9pc0xvY2FsR3JpZCA9ICFiYWNrZW5kU2VydmljZUFwaTtcclxuICAgIHRoaXMuX3BhZ2VOdW1iZXIgPSBwYWdpbmF0aW9uT3B0aW9ucy5wYWdlTnVtYmVyIHx8IDE7XHJcblxyXG4gICAgaWYgKGJhY2tlbmRTZXJ2aWNlQXBpICYmICghYmFja2VuZFNlcnZpY2VBcGkuc2VydmljZSB8fCAhYmFja2VuZFNlcnZpY2VBcGkucHJvY2VzcykpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBCYWNrZW5kU2VydmljZUFwaSByZXF1aXJlcyB0aGUgZm9sbG93aW5nIDIgcHJvcGVydGllcyBcInByb2Nlc3NcIiBhbmQgXCJzZXJ2aWNlXCIgdG8gYmUgZGVmaW5lZC5gKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5faXNMb2NhbEdyaWQgJiYgdGhpcy5kYXRhVmlldykge1xyXG4gICAgICB0aGlzLmRhdGFWaWV3Lm9uUGFnaW5nSW5mb0NoYW5nZWQuc3Vic2NyaWJlKChlLCBwYWdpbmdJbmZvKSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3RvdGFsSXRlbXMgIT09IHBhZ2luZ0luZm8udG90YWxSb3dzKSB7XHJcbiAgICAgICAgICB0aGlzLl90b3RhbEl0ZW1zID0gcGFnaW5nSW5mby50b3RhbFJvd3M7XHJcbiAgICAgICAgICB0aGlzLl9wYWdpbmF0aW9uT3B0aW9ucy50b3RhbEl0ZW1zID0gdGhpcy5fdG90YWxJdGVtcztcclxuICAgICAgICAgIHRoaXMucmVmcmVzaFBhZ2luYXRpb24oZmFsc2UsIGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICBkYXRhVmlldy5zZXRSZWZyZXNoSGludHMoeyBpc0ZpbHRlclVuY2hhbmdlZDogdHJ1ZSB9KTtcclxuICAgICAgZGF0YVZpZXcuc2V0UGFnaW5nT3B0aW9ucyh7IHBhZ2VTaXplOiB0aGlzLnBhZ2luYXRpb25PcHRpb25zLnBhZ2VTaXplLCBwYWdlTnVtOiAodGhpcy5fcGFnZU51bWJlciAtIDEpIH0pOyAvLyBkYXRhVmlldyBwYWdlIHN0YXJ0cyBhdCAwIGluc3RlYWQgb2YgMVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFN1YnNjcmliZSB0byBGaWx0ZXIgQ2xlYXIgJiBDaGFuZ2VkIGFuZCBnbyBiYWNrIHRvIHBhZ2UgMSB3aGVuIHRoYXQgaGFwcGVuXHJcbiAgICB0aGlzLl9zdWJzY3JpcHRpb25zLnB1c2godGhpcy5maWx0ZXJTZXJ2aWNlLm9uRmlsdGVyQ2hhbmdlZC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5yZXNldFBhZ2luYXRpb24oKSkpO1xyXG4gICAgdGhpcy5fc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMuZmlsdGVyU2VydmljZS5vbkZpbHRlckNsZWFyZWQuc3Vic2NyaWJlKCgpID0+IHRoaXMucmVzZXRQYWdpbmF0aW9uKCkpKTtcclxuXHJcbiAgICAvLyBTdWJzY3JpYmUgdG8gYW55IGRhdGF2aWV3IHJvdyBjb3VudCBjaGFuZ2VkIHNvIHRoYXQgd2hlbiBBZGRpbmcvRGVsZXRpbmcgaXRlbShzKSB0aHJvdWdoIHRoZSBEYXRhVmlld1xyXG4gICAgLy8gdGhhdCB3b3VsZCB0cmlnZ2VyIGEgcmVmcmVzaCBvZiB0aGUgcGFnaW5hdGlvbiBudW1iZXJzXHJcbiAgICBpZiAodGhpcy5kYXRhVmlldykge1xyXG4gICAgICB0aGlzLl9zdWJzY3JpcHRpb25zLnB1c2godGhpcy5ncmlkU2VydmljZS5vbkl0ZW1BZGRlZC5zdWJzY3JpYmUoKGl0ZW1zOiBhbnkgfCBhbnlbXSkgPT4gdGhpcy5wcm9jZXNzT25JdGVtQWRkZWRPclJlbW92ZWQoaXRlbXMsIHRydWUpKSk7XHJcbiAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbnMucHVzaCh0aGlzLmdyaWRTZXJ2aWNlLm9uSXRlbURlbGV0ZWQuc3Vic2NyaWJlKChpdGVtczogYW55IHwgYW55W10pID0+IHRoaXMucHJvY2Vzc09uSXRlbUFkZGVkT3JSZW1vdmVkKGl0ZW1zLCBmYWxzZSkpKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnJlZnJlc2hQYWdpbmF0aW9uKGZhbHNlLCBmYWxzZSk7XHJcbiAgICB0aGlzLl9pbml0aWFsaXplZCA9IHRydWU7XHJcbiAgfVxyXG5cclxuICBkaXNwb3NlKCkge1xyXG4gICAgdGhpcy5faW5pdGlhbGl6ZWQgPSBmYWxzZTtcclxuXHJcbiAgICAvLyB1bnN1YnNjcmliZSBhbGwgU2xpY2tHcmlkIGV2ZW50c1xyXG4gICAgdGhpcy5fZXZlbnRIYW5kbGVyLnVuc3Vic2NyaWJlQWxsKCk7XHJcblxyXG4gICAgLy8gYWxzbyB1bnN1YnNjcmliZSBhbGwgQW5ndWxhciBTdWJzY3JpcHRpb25zXHJcbiAgICB0aGlzLl9zdWJzY3JpcHRpb25zID0gdW5zdWJzY3JpYmVBbGxPYnNlcnZhYmxlcyh0aGlzLl9zdWJzY3JpcHRpb25zKTtcclxuICB9XHJcblxyXG4gIGdldEN1cnJlbnRQYWdlTnVtYmVyKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5fcGFnZU51bWJlcjtcclxuICB9XHJcblxyXG4gIGdldEN1cnJlbnRQYWdpbmF0aW9uKCk6IEN1cnJlbnRQYWdpbmF0aW9uICYgeyBwYWdlU2l6ZXM6IG51bWJlcltdIH0ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcGFnZU51bWJlcjogdGhpcy5fcGFnZU51bWJlcixcclxuICAgICAgcGFnZVNpemU6IHRoaXMuX2l0ZW1zUGVyUGFnZSxcclxuICAgICAgcGFnZVNpemVzOiB0aGlzLl9hdmFpbGFibGVQYWdlU2l6ZXMsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0RnVsbFBhZ2luYXRpb24oKTogU2VydmljZVBhZ2luYXRpb24ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcGFnZUNvdW50OiB0aGlzLl9wYWdlQ291bnQsXHJcbiAgICAgIHBhZ2VOdW1iZXI6IHRoaXMuX3BhZ2VOdW1iZXIsXHJcbiAgICAgIHBhZ2VTaXplOiB0aGlzLl9pdGVtc1BlclBhZ2UsXHJcbiAgICAgIHBhZ2VTaXplczogdGhpcy5fYXZhaWxhYmxlUGFnZVNpemVzLFxyXG4gICAgICB0b3RhbEl0ZW1zOiB0aGlzLl90b3RhbEl0ZW1zLFxyXG4gICAgICBkYXRhRnJvbTogdGhpcy5fZGF0YUZyb20sXHJcbiAgICAgIGRhdGFUbzogdGhpcy5fZGF0YVRvLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGdldEN1cnJlbnRJdGVtUGVyUGFnZSgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX2l0ZW1zUGVyUGFnZTtcclxuICB9XHJcblxyXG4gIGNoYW5nZUl0ZW1QZXJQYWdlKGl0ZW1zUGVyUGFnZTogbnVtYmVyLCBldmVudD86IGFueSk6IFByb21pc2U8YW55PiB7XHJcbiAgICB0aGlzLl9wYWdlTnVtYmVyID0gMTtcclxuICAgIHRoaXMuX3BhZ2VDb3VudCA9IE1hdGguY2VpbCh0aGlzLl90b3RhbEl0ZW1zIC8gaXRlbXNQZXJQYWdlKTtcclxuICAgIHRoaXMuX2l0ZW1zUGVyUGFnZSA9IGl0ZW1zUGVyUGFnZTtcclxuICAgIHJldHVybiB0aGlzLnByb2Nlc3NPblBhZ2VDaGFuZ2VkKHRoaXMuX3BhZ2VOdW1iZXIsIGV2ZW50KTtcclxuICB9XHJcblxyXG4gIGdvVG9GaXJzdFBhZ2UoZXZlbnQ/OiBhbnkpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgdGhpcy5fcGFnZU51bWJlciA9IDE7XHJcbiAgICByZXR1cm4gdGhpcy5wcm9jZXNzT25QYWdlQ2hhbmdlZCh0aGlzLl9wYWdlTnVtYmVyLCBldmVudCk7XHJcbiAgfVxyXG5cclxuICBnb1RvTGFzdFBhZ2UoZXZlbnQ/OiBhbnkpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgdGhpcy5fcGFnZU51bWJlciA9IHRoaXMuX3BhZ2VDb3VudCB8fCAxO1xyXG4gICAgcmV0dXJuIHRoaXMucHJvY2Vzc09uUGFnZUNoYW5nZWQodGhpcy5fcGFnZU51bWJlciwgZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgZ29Ub05leHRQYWdlKGV2ZW50PzogYW55KTogUHJvbWlzZTxhbnk+IHtcclxuICAgIGlmICh0aGlzLl9wYWdlTnVtYmVyIDwgdGhpcy5fcGFnZUNvdW50KSB7XHJcbiAgICAgIHRoaXMuX3BhZ2VOdW1iZXIrKztcclxuICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc09uUGFnZUNoYW5nZWQodGhpcy5fcGFnZU51bWJlciwgZXZlbnQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gcmVzb2x2ZShmYWxzZSkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ29Ub1BhZ2VOdW1iZXIocGFnZU51bWJlcjogbnVtYmVyLCBldmVudD86IGFueSk6IFByb21pc2U8YW55PiB7XHJcbiAgICBjb25zdCBwcmV2aW91c1BhZ2VOdW1iZXIgPSB0aGlzLl9wYWdlTnVtYmVyO1xyXG5cclxuICAgIGlmIChwYWdlTnVtYmVyIDwgMSkge1xyXG4gICAgICB0aGlzLl9wYWdlTnVtYmVyID0gMTtcclxuICAgIH0gZWxzZSBpZiAocGFnZU51bWJlciA+IHRoaXMuX3BhZ2VDb3VudCkge1xyXG4gICAgICB0aGlzLl9wYWdlTnVtYmVyID0gdGhpcy5fcGFnZUNvdW50O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fcGFnZU51bWJlciA9IHBhZ2VOdW1iZXI7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuX3BhZ2VOdW1iZXIgIT09IHByZXZpb3VzUGFnZU51bWJlcikge1xyXG4gICAgICByZXR1cm4gdGhpcy5wcm9jZXNzT25QYWdlQ2hhbmdlZCh0aGlzLl9wYWdlTnVtYmVyLCBldmVudCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiByZXNvbHZlKGZhbHNlKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnb1RvUHJldmlvdXNQYWdlKGV2ZW50PzogYW55KTogUHJvbWlzZTxhbnk+IHtcclxuICAgIGlmICh0aGlzLl9wYWdlTnVtYmVyID4gMSkge1xyXG4gICAgICB0aGlzLl9wYWdlTnVtYmVyLS07XHJcbiAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NPblBhZ2VDaGFuZ2VkKHRoaXMuX3BhZ2VOdW1iZXIsIGV2ZW50KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHJlc29sdmUoZmFsc2UpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlZnJlc2hQYWdpbmF0aW9uKGlzUGFnZU51bWJlclJlc2V0OiBib29sZWFuID0gZmFsc2UsIHRyaWdnZXJDaGFuZ2VkRXZlbnQgPSB0cnVlKSB7XHJcbiAgICBjb25zdCBwcmV2aW91c1BhZ2luYXRpb24gPSB7IC4uLnRoaXMuZ2V0Q3VycmVudFBhZ2luYXRpb24oKSB9O1xyXG5cclxuICAgIGlmICh0aGlzLl9wYWdpbmF0aW9uT3B0aW9ucykge1xyXG4gICAgICBjb25zdCBwYWdpbmF0aW9uID0gdGhpcy5fcGFnaW5hdGlvbk9wdGlvbnM7XHJcblxyXG4gICAgICAvLyBzZXQgdGhlIG51bWJlciBvZiBpdGVtcyBwZXIgcGFnZSBpZiBub3QgYWxyZWFkeSBzZXRcclxuICAgICAgaWYgKCF0aGlzLl9pdGVtc1BlclBhZ2UpIHtcclxuICAgICAgICBpZiAodGhpcy5faXNMb2NhbEdyaWQpIHtcclxuICAgICAgICAgIHRoaXMuX2l0ZW1zUGVyUGFnZSA9IHBhZ2luYXRpb24ucGFnZVNpemU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuX2l0ZW1zUGVyUGFnZSA9ICsoKHRoaXMuX2JhY2tlbmRTZXJ2aWNlQXBpICYmIHRoaXMuX2JhY2tlbmRTZXJ2aWNlQXBpLm9wdGlvbnMgJiYgdGhpcy5fYmFja2VuZFNlcnZpY2VBcGkub3B0aW9ucy5wYWdpbmF0aW9uT3B0aW9ucyAmJiB0aGlzLl9iYWNrZW5kU2VydmljZUFwaS5vcHRpb25zLnBhZ2luYXRpb25PcHRpb25zLmZpcnN0KSA/IHRoaXMuX2JhY2tlbmRTZXJ2aWNlQXBpLm9wdGlvbnMucGFnaW5hdGlvbk9wdGlvbnMuZmlyc3QgOiBwYWdpbmF0aW9uLnBhZ2VTaXplKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIGlmIHRvdGFsSXRlbXMgY2hhbmdlZCwgd2Ugc2hvdWxkIGFsd2F5cyBnbyBiYWNrIHRvIHRoZSBmaXJzdCBwYWdlIGFuZCByZWNhbGN1bGF0aW9uIHRoZSBGcm9tLVRvIGluZGV4ZXNcclxuICAgICAgaWYgKGlzUGFnZU51bWJlclJlc2V0IHx8IHRoaXMuX3RvdGFsSXRlbXMgIT09IHBhZ2luYXRpb24udG90YWxJdGVtcykge1xyXG4gICAgICAgIGlmIChpc1BhZ2VOdW1iZXJSZXNldCkge1xyXG4gICAgICAgICAgdGhpcy5fcGFnZU51bWJlciA9IDE7XHJcbiAgICAgICAgICB0aGlzLnBhZ2luYXRpb25PcHRpb25zLnBhZ2VOdW1iZXIgPSAxO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuX2luaXRpYWxpemVkICYmIHBhZ2luYXRpb24ucGFnZU51bWJlciAmJiBwYWdpbmF0aW9uLnBhZ2VOdW1iZXIgPiAxKSB7XHJcbiAgICAgICAgICB0aGlzLl9wYWdlTnVtYmVyID0gcGFnaW5hdGlvbi5wYWdlTnVtYmVyIHx8IDE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyB3aGVuIHBhZ2UgbnVtYmVyIGlzIHNldCB0byAxIHRoZW4gYWxzbyByZXNldCB0aGUgXCJvZmZzZXRcIiBvZiBiYWNrZW5kIHNlcnZpY2VcclxuICAgICAgICBpZiAodGhpcy5fcGFnZU51bWJlciA9PT0gMSAmJiB0aGlzLl9iYWNrZW5kU2VydmljZUFwaSkge1xyXG4gICAgICAgICAgdGhpcy5fYmFja2VuZFNlcnZpY2VBcGkuc2VydmljZS5yZXNldFBhZ2luYXRpb25PcHRpb25zKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBjYWxjdWxhdGUgYW5kIHJlZnJlc2ggdGhlIG11bHRpcGxlIHByb3BlcnRpZXMgb2YgdGhlIHBhZ2luYXRpb24gVUlcclxuICAgICAgdGhpcy5fYXZhaWxhYmxlUGFnZVNpemVzID0gcGFnaW5hdGlvbi5wYWdlU2l6ZXM7XHJcbiAgICAgIGlmICghdGhpcy5fdG90YWxJdGVtcyAmJiBwYWdpbmF0aW9uLnRvdGFsSXRlbXMpIHtcclxuICAgICAgICB0aGlzLl90b3RhbEl0ZW1zID0gcGFnaW5hdGlvbi50b3RhbEl0ZW1zO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMucmVjYWxjdWxhdGVGcm9tVG9JbmRleGVzKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9wYWdlQ291bnQgPSBNYXRoLmNlaWwodGhpcy5fdG90YWxJdGVtcyAvIHRoaXMuX2l0ZW1zUGVyUGFnZSk7XHJcbiAgICBjb25zdCBjdXJyZW50UGFnaW5hdGlvbiA9IHRoaXMuZ2V0Q3VycmVudFBhZ2luYXRpb24oKTtcclxuICAgIHRoaXMuc2hhcmVkU2VydmljZS5jdXJyZW50UGFnaW5hdGlvbiA9IGN1cnJlbnRQYWdpbmF0aW9uO1xyXG5cclxuICAgIGlmICh0cmlnZ2VyQ2hhbmdlZEV2ZW50ICYmICFpc2VxdWFsKHByZXZpb3VzUGFnaW5hdGlvbiwgY3VycmVudFBhZ2luYXRpb24pKSB7XHJcbiAgICAgIHRoaXMub25QYWdpbmF0aW9uQ2hhbmdlZC5uZXh0KGN1cnJlbnRQYWdpbmF0aW9uKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByb2Nlc3NPblBhZ2VDaGFuZ2VkKHBhZ2VOdW1iZXI6IG51bWJlciwgZXZlbnQ/OiBFdmVudCB8IHVuZGVmaW5lZCk6IFByb21pc2U8YW55PiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICB0aGlzLnJlY2FsY3VsYXRlRnJvbVRvSW5kZXhlcygpO1xyXG5cclxuICAgICAgaWYgKHRoaXMuX2lzTG9jYWxHcmlkICYmIHRoaXMuZGF0YVZpZXcpIHtcclxuICAgICAgICB0aGlzLmRhdGFWaWV3LnNldFBhZ2luZ09wdGlvbnMoeyBwYWdlU2l6ZTogdGhpcy5faXRlbXNQZXJQYWdlLCBwYWdlTnVtOiAocGFnZU51bWJlciAtIDEpIH0pOyAvLyBkYXRhVmlldyBwYWdlIHN0YXJ0cyBhdCAwIGluc3RlYWQgb2YgMVxyXG4gICAgICAgIHRoaXMub25QYWdpbmF0aW9uQ2hhbmdlZC5uZXh0KHRoaXMuZ2V0RnVsbFBhZ2luYXRpb24oKSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgaXRlbXNQZXJQYWdlID0gK3RoaXMuX2l0ZW1zUGVyUGFnZTtcclxuXHJcbiAgICAgICAgLy8ga2VlcCBzdGFydCB0aW1lICYgZW5kIHRpbWVzdGFtcHMgJiByZXR1cm4gaXQgYWZ0ZXIgcHJvY2VzcyBleGVjdXRpb25cclxuICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSgpO1xyXG5cclxuICAgICAgICAvLyBydW4gYW55IHByZS1wcm9jZXNzLCBpZiBkZWZpbmVkLCBmb3IgZXhhbXBsZSBhIHNwaW5uZXJcclxuICAgICAgICBpZiAodGhpcy5fYmFja2VuZFNlcnZpY2VBcGkucHJlUHJvY2Vzcykge1xyXG4gICAgICAgICAgdGhpcy5fYmFja2VuZFNlcnZpY2VBcGkucHJlUHJvY2VzcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcXVlcnkgPSB0aGlzLl9iYWNrZW5kU2VydmljZUFwaS5zZXJ2aWNlLnByb2Nlc3NPblBhZ2luYXRpb25DaGFuZ2VkKGV2ZW50LCB7IG5ld1BhZ2U6IHBhZ2VOdW1iZXIsIHBhZ2VTaXplOiBpdGVtc1BlclBhZ2UgfSk7XHJcblxyXG4gICAgICAgIC8vIHRoZSBwcm9jZXNzZXMgY2FuIGJlIFByb21pc2VzIG9yIGFuIE9ic2VydmFibGVzIChsaWtlIEh0dHBDbGllbnQpXHJcbiAgICAgICAgY29uc3QgcHJvY2VzcyA9IHRoaXMuX2JhY2tlbmRTZXJ2aWNlQXBpLnByb2Nlc3MocXVlcnkpO1xyXG4gICAgICAgIGlmIChwcm9jZXNzIGluc3RhbmNlb2YgUHJvbWlzZSkge1xyXG4gICAgICAgICAgcHJvY2Vzc1xyXG4gICAgICAgICAgICAudGhlbigocHJvY2Vzc1Jlc3VsdDogR3JhcGhxbFJlc3VsdCB8IEdyYXBocWxQYWdpbmF0ZWRSZXN1bHQgfCBhbnkpID0+IHtcclxuICAgICAgICAgICAgICByZXNvbHZlKGV4ZWN1dGVCYWNrZW5kUHJvY2Vzc2VzQ2FsbGJhY2soc3RhcnRUaW1lLCBwcm9jZXNzUmVzdWx0LCB0aGlzLl9iYWNrZW5kU2VydmljZUFwaSwgdGhpcy5fdG90YWxJdGVtcykpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgb25CYWNrZW5kRXJyb3IoZXJyb3IsIHRoaXMuX2JhY2tlbmRTZXJ2aWNlQXBpKTtcclxuICAgICAgICAgICAgICByZWplY3QocHJvY2Vzcyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoaXNPYnNlcnZhYmxlKHByb2Nlc3MpKSB7XHJcbiAgICAgICAgICBwcm9jZXNzLnN1YnNjcmliZShcclxuICAgICAgICAgICAgKHByb2Nlc3NSZXN1bHQ6IEdyYXBocWxSZXN1bHQgfCBHcmFwaHFsUGFnaW5hdGVkUmVzdWx0IHwgYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZShleGVjdXRlQmFja2VuZFByb2Nlc3Nlc0NhbGxiYWNrKHN0YXJ0VGltZSwgcHJvY2Vzc1Jlc3VsdCwgdGhpcy5fYmFja2VuZFNlcnZpY2VBcGksIHRoaXMuX3RvdGFsSXRlbXMpKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICBvbkJhY2tlbmRFcnJvcihlcnJvciwgdGhpcy5fYmFja2VuZFNlcnZpY2VBcGkpO1xyXG4gICAgICAgICAgICAgIHJlamVjdChwcm9jZXNzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5vblBhZ2luYXRpb25DaGFuZ2VkLm5leHQodGhpcy5nZXRGdWxsUGFnaW5hdGlvbigpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZWNhbGN1bGF0ZUZyb21Ub0luZGV4ZXMoKSB7XHJcbiAgICBpZiAodGhpcy5fdG90YWxJdGVtcyA9PT0gMCkge1xyXG4gICAgICB0aGlzLl9kYXRhRnJvbSA9IDA7XHJcbiAgICAgIHRoaXMuX2RhdGFUbyA9IDE7XHJcbiAgICAgIHRoaXMuX3BhZ2VOdW1iZXIgPSAwO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fZGF0YUZyb20gPSB0aGlzLl9wYWdlTnVtYmVyID4gMSA/ICgodGhpcy5fcGFnZU51bWJlciAqIHRoaXMuX2l0ZW1zUGVyUGFnZSkgLSB0aGlzLl9pdGVtc1BlclBhZ2UgKyAxKSA6IDE7XHJcbiAgICAgIHRoaXMuX2RhdGFUbyA9ICh0aGlzLl90b3RhbEl0ZW1zIDwgdGhpcy5faXRlbXNQZXJQYWdlKSA/IHRoaXMuX3RvdGFsSXRlbXMgOiAoKHRoaXMuX3BhZ2VOdW1iZXIgfHwgMSkgKiB0aGlzLl9pdGVtc1BlclBhZ2UpO1xyXG4gICAgICBpZiAodGhpcy5fZGF0YVRvID4gdGhpcy5fdG90YWxJdGVtcykge1xyXG4gICAgICAgIHRoaXMuX2RhdGFUbyA9IHRoaXMuX3RvdGFsSXRlbXM7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh0aGlzLl90b3RhbEl0ZW1zID4gMCAmJiB0aGlzLl9wYWdlTnVtYmVyID09PSAwKSB7XHJcbiAgICAgIHRoaXMuX3BhZ2VOdW1iZXIgPSAxO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGRvIGEgZmluYWwgY2hlY2sgb24gdGhlIEZyb20vVG8gYW5kIG1ha2Ugc3VyZSB0aGV5IGFyZSBub3Qgb3ZlciBvciBiZWxvdyBtaW4vbWF4IGFjY2VwdGFibGUgdmFsdWVzXHJcbiAgICBpZiAodGhpcy5fZGF0YVRvID4gdGhpcy5fdG90YWxJdGVtcykge1xyXG4gICAgICB0aGlzLl9kYXRhVG8gPSB0aGlzLl90b3RhbEl0ZW1zO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLl90b3RhbEl0ZW1zIDwgdGhpcy5faXRlbXNQZXJQYWdlKSB7XHJcbiAgICAgIHRoaXMuX2RhdGFUbyA9IHRoaXMuX3RvdGFsSXRlbXM7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKiogUmVzZXQgdGhlIFBhZ2luYXRpb24gdG8gZmlyc3QgcGFnZSBhbmQgcmVjYWxjdWxhdGUgbmVjZXNzYXJ5IG51bWJlcnMgKi9cclxuICByZXNldFBhZ2luYXRpb24odHJpZ2dlckNoYW5nZWRFdmVudCA9IHRydWUpIHtcclxuICAgIGlmICh0aGlzLl9pc0xvY2FsR3JpZCkge1xyXG4gICAgICAvLyBvbiBhIGxvY2FsIGdyaWQgd2UgYWxzbyBuZWVkIHRvIHJlc2V0IHRoZSBEYXRhVmlldyBwYWdpbmcgdG8gMXN0IHBhZ2VcclxuICAgICAgdGhpcy5kYXRhVmlldy5zZXRQYWdpbmdPcHRpb25zKHsgcGFnZVNpemU6IHRoaXMuX2l0ZW1zUGVyUGFnZSwgcGFnZU51bTogMCB9KTtcclxuICAgIH1cclxuICAgIHRoaXMucmVmcmVzaFBhZ2luYXRpb24odHJ1ZSwgdHJpZ2dlckNoYW5nZWRFdmVudCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUb2dnbGUgdGhlIFBhZ2luYXRpb24gKHNob3cvaGlkZSksIGl0IHdpbGwgdXNlIHRoZSB2aXNpYmxlIGlmIGRlZmluZWQgZWxzZSBpdCB3aWxsIGF1dG9tYXRpY2FsbHkgaW52ZXJzZSB3aGVuIGNhbGxlZCB3aXRob3V0IGFyZ3VtZW50XHJcbiAgICpcclxuICAgKiBJTVBPUlRBTlQgTk9URTpcclxuICAgKiBUaGUgUGFnaW5hdGlvbiBtdXN0IGJlIGNyZWF0ZWQgb24gaW5pdGlhbCBwYWdlIGxvYWQsIHRoZW4gb25seSBhZnRlciBjYW4geW91IHRvZ2dsZSBpdC5cclxuICAgKiBCYXNpY2FsbHkgdGhpcyBtZXRob2QgV0lMTCBOT1QgV09SSyB0byBzaG93IHRoZSBQYWdpbmF0aW9uIGlmIGl0IHdhcyBub3QgdGhlcmUgZnJvbSB0aGUgc3RhcnQuXHJcbiAgICovXHJcbiAgdG9nZ2xlUGFnaW5hdGlvblZpc2liaWxpdHkodmlzaWJsZT86IGJvb2xlYW4pIHtcclxuICAgIGlmICh0aGlzLmdyaWQgJiYgdGhpcy5zaGFyZWRTZXJ2aWNlICYmIHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucykge1xyXG4gICAgICBjb25zdCBpc1Zpc2libGUgPSB2aXNpYmxlICE9PSB1bmRlZmluZWQgPyB2aXNpYmxlIDogIXRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVQYWdpbmF0aW9uO1xyXG4gICAgICB0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlUGFnaW5hdGlvbiA9IGlzVmlzaWJsZTtcclxuICAgICAgdGhpcy5vblBhZ2luYXRpb25WaXNpYmlsaXR5Q2hhbmdlZC5uZXh0KHsgdmlzaWJsZTogaXNWaXNpYmxlIH0pO1xyXG5cclxuICAgICAgLy8gbWFrZSBzdXJlIHRvIHJlc2V0IHRoZSBQYWdpbmF0aW9uIGFuZCBnbyBiYWNrIHRvIGZpcnN0IHBhZ2UgdG8gYXZvaWQgYW55IGlzc3VlcyB3aXRoIFBhZ2luYXRpb24gYmVpbmcgb2Zmc2V0XHJcbiAgICAgIGlmIChpc1Zpc2libGUpIHtcclxuICAgICAgICB0aGlzLmdvVG9GaXJzdFBhZ2UoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gd2hlbiB1c2luZyBhIGxvY2FsIGdyaWQsIHdlIGNhbiByZXNldCB0aGUgRGF0YVZpZXcgcGFnaW5hdGlvbiBieSBjaGFuZ2luZyBpdHMgcGFnZSBzaXplXHJcbiAgICAgIC8vIHBhZ2Ugc2l6ZSBvZiAwIHdvdWxkIHNob3cgYWxsLCBoZW5jZSBjYW5jZWwgdGhlIHBhZ2luYXRpb25cclxuICAgICAgaWYgKHRoaXMuX2lzTG9jYWxHcmlkKSB7XHJcbiAgICAgICAgY29uc3QgcGFnZVNpemUgPSB2aXNpYmxlID8gdGhpcy5faXRlbXNQZXJQYWdlIDogMDtcclxuICAgICAgICB0aGlzLmRhdGFWaWV3LnNldFBhZ2luZ09wdGlvbnMoeyBwYWdlU2l6ZSwgcGFnZU51bTogMCB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gLS1cclxuICAvLyBwcml2YXRlIGZ1bmN0aW9uc1xyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIC8qKlxyXG4gICAqIFdoZW4gaXRlbSBpcyBhZGRlZCBvciByZW1vdmVkLCB3ZSB3aWxsIHJlZnJlc2ggdGhlIG51bWJlcnMgb24gdGhlIHBhZ2luYXRpb24gaG93ZXZlciB3ZSB3b24ndCB0cmlnZ2VyIGEgYmFja2VuZCBjaGFuZ2VcclxuICAgKiBUaGlzIHdpbGwgaGF2ZSBhIHNpZGUgZWZmZWN0IHRob3VnaCwgd2hpY2ggaXMgdGhhdCB0aGUgXCJUb1wiIGNvdW50IHdvbid0IGJlIG1hdGNoaW5nIHRoZSBcIml0ZW1zIHBlciBwYWdlXCIgY291bnQsXHJcbiAgICogdGhhdCBpcyBhIG5lY2Vzc2FyeSBzaWRlIGVmZmVjdCB0byBhdm9pZCB0cmlnZ2VyaW5nIGEgYmFja2VuZCBxdWVyeSBqdXN0IHRvIHJlZnJlc2ggdGhlIHBhZ2luZyxcclxuICAgKiBiYXNpY2FsbHkgd2UgYXNzdW1lIHRoYXQgdGhpcyBvZmZzZXQgaXMgZmluZSBmb3IgdGhlIHRpbWUgYmVpbmcsXHJcbiAgICogdW50aWwgdXNlciBkb2VzIGFuIGFjdGlvbiB3aGljaCB3aWxsIHJlZnJlc2ggdGhlIGRhdGEgaGVuY2UgdGhlIHBhZ2luYXRpb24gd2hpY2ggd2lsbCB0aGVuIGJlY29tZSBub3JtYWwgYWdhaW5cclxuICAgKi9cclxuICBwcml2YXRlIHByb2Nlc3NPbkl0ZW1BZGRlZE9yUmVtb3ZlZChpdGVtczogYW55IHwgYW55W10sIGlzSXRlbUFkZGVkID0gdHJ1ZSkge1xyXG4gICAgaWYgKGl0ZW1zICE9PSBudWxsKSB7XHJcbiAgICAgIGNvbnN0IHByZXZpb3VzRGF0YVRvID0gdGhpcy5fZGF0YVRvO1xyXG4gICAgICBjb25zdCBpdGVtQ291bnQgPSBBcnJheS5pc0FycmF5KGl0ZW1zKSA/IGl0ZW1zLmxlbmd0aCA6IDE7XHJcbiAgICAgIGNvbnN0IGl0ZW1Db3VudFdpdGhEaXJlY3Rpb24gPSBpc0l0ZW1BZGRlZCA/ICtpdGVtQ291bnQgOiAtaXRlbUNvdW50O1xyXG5cclxuICAgICAgLy8gcmVmcmVzaCB0aGUgdG90YWwgY291bnQgaW4gdGhlIHBhZ2luYXRpb24gYW5kIGluIHRoZSBVSVxyXG4gICAgICB0aGlzLl90b3RhbEl0ZW1zICs9IGl0ZW1Db3VudFdpdGhEaXJlY3Rpb247XHJcbiAgICAgIHRoaXMucmVjYWxjdWxhdGVGcm9tVG9JbmRleGVzKCk7XHJcblxyXG4gICAgICAvLyBmaW5hbGx5IHJlZnJlc2ggdGhlIFwiVG9cIiBjb3VudCBhbmQgd2Uga25vdyBpdCBtaWdodCBiZSBkaWZmZXJlbnQgdGhhbiB0aGUgXCJpdGVtcyBwZXIgcGFnZVwiIGNvdW50XHJcbiAgICAgIC8vIGJ1dCB0aGlzIGlzIG5lY2Vzc2FyeSBzaW5jZSB3ZSBkb24ndCB3YW50IGFuIGFjdHVhbCBiYWNrZW5kIHJlZnJlc2hcclxuICAgICAgdGhpcy5fZGF0YVRvID0gcHJldmlvdXNEYXRhVG8gKyBpdGVtQ291bnRXaXRoRGlyZWN0aW9uO1xyXG4gICAgICB0aGlzLm9uUGFnaW5hdGlvbkNoYW5nZWQubmV4dCh0aGlzLmdldEZ1bGxQYWdpbmF0aW9uKCkpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=