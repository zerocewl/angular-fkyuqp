import * as tslib_1 from "tslib";
import { Component, Input, Optional } from '@angular/core';
import { TranslateService } from '@ngx-translate/core';
import { Constants } from '../constants';
import { PaginationService } from '../services/pagination.service';
import { unsubscribeAllObservables } from '../services/utilities';
let SlickPaginationComponent = class SlickPaginationComponent {
    /** Constructor */
    constructor(paginationService, translate) {
        this.paginationService = paginationService;
        this.translate = translate;
        this.subscriptions = [];
        this._enableTranslate = false;
        // text translations (handled by ngx-translate or by custom locale)
        this.textItemsPerPage = 'items per page';
        this.textItems = 'items';
        this.textOf = 'of';
        this.textPage = 'Page';
    }
    get availablePageSizes() {
        return this.paginationService.availablePageSizes;
    }
    get dataFrom() {
        return this.paginationService.dataFrom;
    }
    get dataTo() {
        return this.paginationService.dataTo;
    }
    get itemsPerPage() {
        return this.paginationService.itemsPerPage;
    }
    get pageCount() {
        return this.paginationService.pageCount;
    }
    get pageNumber() {
        return this.paginationService.pageNumber;
    }
    set pageNumber(page) {
        // the setter has to be declared but we won't use it, instead we will use the "changeToCurrentPage()" to only update the value after ENTER keydown event
    }
    get totalItems() {
        return this.paginationService.totalItems;
    }
    ngOnDestroy() {
        this.dispose();
    }
    ngOnInit() {
        const gridOptions = this.gridOptions || {};
        this._enableTranslate = gridOptions && gridOptions.enableTranslate || false;
        this._locales = gridOptions && gridOptions.locales || Constants.locales;
        if (this._enableTranslate && !this.translate) {
            throw new Error('[Angular-Slickgrid] requires "ngx-translate" to be installed and configured when the grid option "enableTranslate" is enabled.');
        }
        this.translateAllUiTexts(this._locales);
        // translate all the text using ngx-translate or custom locales
        if (this._enableTranslate && this.translate && this.translate.onLangChange) {
            this.subscriptions.push(this.translate.onLangChange.subscribe(() => this.translateAllUiTexts(this._locales)));
        }
    }
    changeToFirstPage(event) {
        this.paginationService.goToFirstPage(event);
    }
    changeToLastPage(event) {
        this.paginationService.goToLastPage(event);
    }
    changeToNextPage(event) {
        this.paginationService.goToNextPage(event);
    }
    changeToPreviousPage(event) {
        this.paginationService.goToPreviousPage(event);
    }
    changeToCurrentPage(event) {
        let pageNumber = 1;
        if (event && event.currentTarget && event.currentTarget.value) {
            pageNumber = +(event.currentTarget.value);
        }
        this.paginationService.goToPageNumber(pageNumber, event);
    }
    changeItemPerPage(event) {
        let itemsPerPage = 1;
        if (event && event.currentTarget && event.currentTarget.value) {
            itemsPerPage = +(event.currentTarget.value);
        }
        this.paginationService.changeItemPerPage(itemsPerPage, event);
    }
    dispose() {
        this.paginationService.dispose();
        // also unsubscribe all Angular Subscriptions
        this.subscriptions = unsubscribeAllObservables(this.subscriptions);
    }
    // --
    // private functions
    // --------------------
    /** Translate all the texts shown in the UI, use ngx-translate service when available or custom locales when service is null */
    translateAllUiTexts(locales) {
        if (this._enableTranslate && this.translate && this.translate.instant && this.translate.currentLang) {
            this.textItemsPerPage = this.translate.instant('ITEMS_PER_PAGE');
            this.textItems = this.translate.instant('ITEMS');
            this.textOf = this.translate.instant('OF');
            this.textPage = this.translate.instant('PAGE');
        }
        else if (locales) {
            this.textItemsPerPage = locales.TEXT_ITEMS_PER_PAGE || 'TEXT_ITEMS_PER_PAGE';
            this.textItems = locales.TEXT_ITEMS || 'TEXT_ITEMS';
            this.textOf = locales.TEXT_OF || 'TEXT_OF';
            this.textPage = locales.TEXT_PAGE || 'TEXT_PAGE';
        }
    }
};
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], SlickPaginationComponent.prototype, "gridOptions", void 0);
SlickPaginationComponent = tslib_1.__decorate([
    Component({
        selector: 'slick-pagination',
        template: "<div class=\"slick-pagination\">\r\n  <div class=\"slick-pagination-nav\">\r\n    <nav aria-label=\"Page navigation\">\r\n      <ul class=\"pagination\">\r\n        <li class=\"page-item\" [ngClass]=\"(pageNumber === 1 || totalItems === 0) ? 'disabled' : ''\">\r\n          <a class=\"page-link icon-seek-first fa fa-angle-double-left\" aria-label=\"First\"\r\n            (click)=\"changeToFirstPage($event)\">\r\n          </a>\r\n        </li>\r\n        <li class=\"page-item\" [ngClass]=\"(pageNumber === 1 || totalItems === 0) ? 'disabled' : ''\">\r\n          <a class=\"page-link icon-seek-prev fa fa-angle-left\" aria-label=\"Previous\"\r\n            (click)=\"changeToPreviousPage($event)\">\r\n          </a>\r\n        </li>\r\n      </ul>\r\n    </nav>\r\n\r\n    <div class=\"slick-page-number\">\r\n      <span>{{textPage}}</span>\r\n      <input type=\"text\" class=\"form-control\" data-test=\"page-number-input\" [value]=\"pageNumber\" size=\"1\"\r\n        [readOnly]=\"totalItems === 0\" (change)=\"changeToCurrentPage($event)\">\r\n      <span>{{textOf}}</span><span data-test=\"page-count\"> {{pageCount}}</span>\r\n    </div>\r\n\r\n    <nav aria-label=\"Page navigation\">\r\n      <ul class=\"pagination\">\r\n        <li class=\"page-item\" [ngClass]=\"(pageNumber === pageCount || totalItems === 0) ? 'disabled' : ''\">\r\n          <a class=\"page-link icon-seek-next text-center fa fa-lg fa-angle-right\" aria-label=\"Next\"\r\n            (click)=\"changeToNextPage($event)\">\r\n          </a>\r\n        </li>\r\n        <li class=\"page-item\" [ngClass]=\"(pageNumber === pageCount || totalItems === 0) ? 'disabled' : ''\">\r\n          <a class=\"page-link icon-seek-end fa fa-lg fa-angle-double-right\" aria-label=\"Last\"\r\n            (click)=\"changeToLastPage($event)\">\r\n          </a>\r\n        </li>\r\n      </ul>\r\n    </nav>\r\n  </div>\r\n  <span class=\"slick-pagination-settings\">\r\n    <select id=\"items-per-page-label\" [value]=\"itemsPerPage\" (change)=\"changeItemPerPage($event)\">\r\n      <option value=\"{{pageSize}}\" *ngFor=\"let pageSize of availablePageSizes\">{{pageSize}}</option>\r\n    </select>\r\n    <span>{{textItemsPerPage}}</span>,\r\n    <span class=\"slick-pagination-count\">\r\n      <span *ngIf=\"totalItems\">\r\n        <span class=\"page-info-from-to\">\r\n          <span data-test=\"item-from\">{{dataFrom}}</span>-<span data-test=\"item-to\">{{dataTo}}</span>\r\n          {{textOf}}\r\n        </span>\r\n      </span>\r\n      <span class=\"page-info-total-items\">\r\n        <span data-test=\"total-items\">{{totalItems}}</span> {{textItems}}\r\n      </span>\r\n    </span>\r\n  </span>\r\n</div>\r\n"
    }),
    tslib_1.__param(1, Optional()),
    tslib_1.__metadata("design:paramtypes", [PaginationService, TranslateService])
], SlickPaginationComponent);
export { SlickPaginationComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpY2stcGFnaW5hdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLXNsaWNrZ3JpZC8iLCJzb3VyY2VzIjpbImFwcC9tb2R1bGVzL2FuZ3VsYXItc2xpY2tncmlkL2NvbXBvbmVudHMvc2xpY2stcGFnaW5hdGlvbi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFxQixRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDOUUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFHdkQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUV6QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNuRSxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQU1sRSxJQUFhLHdCQUF3QixHQUFyQyxNQUFhLHdCQUF3QjtJQWFuQyxrQkFBa0I7SUFDbEIsWUFBb0IsaUJBQW9DLEVBQXNCLFNBQTJCO1FBQXJGLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFBc0IsY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUFYakcsa0JBQWEsR0FBbUIsRUFBRSxDQUFDO1FBQ25DLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQUdqQyxtRUFBbUU7UUFDbkUscUJBQWdCLEdBQUcsZ0JBQWdCLENBQUM7UUFDcEMsY0FBUyxHQUFHLE9BQU8sQ0FBQztRQUNwQixXQUFNLEdBQUcsSUFBSSxDQUFDO1FBQ2QsYUFBUSxHQUFHLE1BQU0sQ0FBQztJQUcyRixDQUFDO0lBRTlHLElBQUksa0JBQWtCO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLGtCQUFrQixDQUFDO0lBQ25ELENBQUM7SUFFRCxJQUFJLFFBQVE7UUFDVixPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUM7SUFDekMs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QUNwRCxJQUFJLENBQUMsTUFBTSxHQUFHLE9BQU8sQ0FBQyxPQUFPLElBQUksU0FBUyxDQUFDO1lBQzNDLElBQUksQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDLFNBQVMsSUFBSSxXQUFXLENBQUM7U0FDbEQ7SUFDSCxDQUFDO0NBQ0YsQ0FBQTtBQTVIVTtJQUFSLEtBQUssRUFBRTs7NkRBQXlCO0FBRHRCLHdCQUF3QjtJQUpwQyxTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsa0JBQWtCO1FBQzVCLG1wRkFBZ0Q7S0FDakQsQ0FBQztJQWUyRCxtQkFBQSxRQUFRLEVBQUUsQ0FBQTs2Q0FBOUIsaUJBQWlCLEVBQWlDLGdCQUFnQjtHQWQ5Rix3QkFBd0IsQ0E2SHBDO1NBN0hZLHdCQUF3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9uRGVzdHJveSwgT25Jbml0LCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHsgQ29uc3RhbnRzIH0gZnJvbSAnLi4vY29uc3RhbnRzJztcclxuaW1wb3J0IHsgR3JpZE9wdGlvbiwgTG9jYWxlIH0gZnJvbSAnLi8uLi9tb2RlbHMvaW5kZXgnO1xyXG5pbXBvcnQgeyBQYWdpbmF0aW9uU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3BhZ2luYXRpb24uc2VydmljZSc7XHJcbmltcG9ydCB7IHVuc3Vic2NyaWJlQWxsT2JzZXJ2YWJsZXMgfSBmcm9tICcuLi9zZXJ2aWNlcy91dGlsaXRpZXMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdzbGljay1wYWdpbmF0aW9uJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vc2xpY2stcGFnaW5hdGlvbi5jb21wb25lbnQuaHRtbCdcclxufSlcclxuZXhwb3J0IGNsYXNzIFNsaWNrUGFnaW5hdGlvbkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSwgT25Jbml0IHtcclxuICBASW5wdXQoKSBncmlkT3B0aW9uczogR3JpZE9wdGlvbjtcclxuXHJcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb25zOiBTdWJzY3JpcHRpb25bXSA9IFtdO1xyXG4gIHByaXZhdGUgX2VuYWJsZVRyYW5zbGF0ZSA9IGZhbHNlO1xyXG4gIHByaXZhdGUgX2xvY2FsZXM6IExvY2FsZTtcclxuXHJcbiAgLy8gdGV4dCB0cmFuc2xhdGlvbnMgKGhhbmRsZWQgYnkgbmd4LXRyYW5zbGF0ZSBvciBieSBjdXN0b20gbG9jYWxlKVxyXG4gIHRleHRJdGVtc1BlclBhZ2UgPSAnaXRlbXMgcGVyIHBhZ2UnO1xyXG4gIHRleHRJdGVtcyA9ICdpdGVtcyc7XHJcbiAgdGV4dE9mID0gJ29mJztcclxuICB0ZXh0UGFnZSA9ICdQYWdlJztcclxuXHJcbiAgLyoqIENvbnN0cnVjdG9yICovXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBwYWdpbmF0aW9uU2VydmljZTogUGFnaW5hdGlvblNlcnZpY2UsIEBPcHRpb25hbCgpIHByaXZhdGUgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlKSB7IH1cclxuXHJcbiAgZ2V0IGF2YWlsYWJsZVBhZ2VTaXplcygpOiBudW1iZXJbXSB7XHJcbiAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uU2VydmljZS5hdmFpbGFibGVQYWdlU2l6ZXM7XHJcbiAgfVxyXG5cclxuICBnZXQgZGF0YUZyb20oKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25TZXJ2aWNlLmRhdGFGcm9tO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGRhdGFUbygpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvblNlcnZpY2UuZGF0YVRvO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGl0ZW1zUGVyUGFnZSgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvblNlcnZpY2UuaXRlbXNQZXJQYWdlO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHBhZ2VDb3VudCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMucGFnaW5hdGlvblNlcnZpY2UucGFnZUNvdW50O1xyXG4gIH1cclxuXHJcbiAgZ2V0IHBhZ2VOdW1iZXIoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25TZXJ2aWNlLnBhZ2VOdW1iZXI7XHJcbiAgfVxyXG4gIHNldCBwYWdlTnVtYmVyKHBhZ2U6IG51bWJlcikge1xyXG4gICAgLy8gdGhlIHNldHRlciBoYXMgdG8gYmUgZGVjbGFyZWQgYnV0IHdlIHdvbid0IHVzZSBpdCwgaW5zdGVhZCB3ZSB3aWxsIHVzZSB0aGUgXCJjaGFuZ2VUb0N1cnJlbnRQYWdlKClcIiB0byBvbmx5IHVwZGF0ZSB0aGUgdmFsdWUgYWZ0ZXIgRU5URVIga2V5ZG93biBldmVudFxyXG4gIH1cclxuXHJcbiAgZ2V0IHRvdGFsSXRlbXMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5wYWdpbmF0aW9uU2VydmljZS50b3RhbEl0ZW1zO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICB0aGlzLmRpc3Bvc2UoKTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgY29uc3QgZ3JpZE9wdGlvbnM6IEdyaWRPcHRpb24gPSB0aGlzLmdyaWRPcHRpb25zIHx8IHt9O1xyXG4gICAgdGhpcy5fZW5hYmxlVHJhbnNsYXRlID0gZ3JpZE9wdGlvbnMgJiYgZ3JpZE9wdGlvbnMuZW5hYmxlVHJhbnNsYXRlIHx8IGZhbHNlO1xyXG4gICAgdGhpcy5fbG9jYWxlcyA9IGdyaWRPcHRpb25zICYmIGdyaWRPcHRpb25zLmxvY2FsZXMgfHwgQ29uc3RhbnRzLmxvY2FsZXM7XHJcblxyXG4gICAgaWYgKHRoaXMuX2VuYWJsZVRyYW5zbGF0ZSAmJiAhdGhpcy50cmFuc2xhdGUpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdbQW5ndWxhci1TbGlja2dyaWRdIHJlcXVpcmVzIFwibmd4LXRyYW5zbGF0ZVwiIHRvIGJlIGluc3RhbGxlZCBhbmQgY29uZmlndXJlZCB3aGVuIHRoZSBncmlkIG9wdGlvbiBcImVuYWJsZVRyYW5zbGF0ZVwiIGlzIGVuYWJsZWQuJyk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy50cmFuc2xhdGVBbGxVaVRleHRzKHRoaXMuX2xvY2FsZXMpO1xyXG5cclxuICAgIC8vIHRyYW5zbGF0ZSBhbGwgdGhlIHRleHQgdXNpbmcgbmd4LXRyYW5zbGF0ZSBvciBjdXN0b20gbG9jYWxlc1xyXG4gICAgaWYgKHRoaXMuX2VuYWJsZVRyYW5zbGF0ZSAmJiB0aGlzLnRyYW5zbGF0ZSAmJiB0aGlzLnRyYW5zbGF0ZS5vbkxhbmdDaGFuZ2UpIHtcclxuICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy50cmFuc2xhdGUub25MYW5nQ2hhbmdlLnN1YnNjcmliZSgoKSA9PiB0aGlzLnRyYW5zbGF0ZUFsbFVpVGV4dHModGhpcy5fbG9jYWxlcykpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNoYW5nZVRvRmlyc3RQYWdlKGV2ZW50OiBhbnkpIHtcclxuICAgIHRoaXMucGFnaW5hdGlvblNlcnZpY2UuZ29Ub0ZpcnN0UGFnZShldmVudCk7XHJcbiAgfVxyXG5cclxuICBjaGFuZ2VUb0xhc3RQYWdlKGV2ZW50OiBhbnkpIHtcclxuICAgIHRoaXMucGFnaW5hdGlvblNlcnZpY2UuZ29Ub0xhc3RQYWdlKGV2ZW50KTtcclxuICB9XHJcblxyXG4gIGNoYW5nZVRvTmV4dFBhZ2UoZXZlbnQ6IGFueSkge1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uU2VydmljZS5nb1RvTmV4dFBhZ2UoZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgY2hhbmdlVG9QcmV2aW91c1BhZ2UoZXZlbnQ6IGFueSkge1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uU2VydmljZS5nb1RvUHJldmlvdXNQYWdlKGV2ZW50KTtcclxuICB9XHJcblxyXG4gIGNoYW5nZVRvQ3VycmVudFBhZ2UoZXZlbnQ6IGFueSkge1xyXG4gICAgbGV0IHBhZ2VOdW1iZXIgPSAxO1xyXG4gICAgaWYgKGV2ZW50ICYmIGV2ZW50LmN1cnJlbnRUYXJnZXQgJiYgZXZlbnQuY3VycmVudFRhcmdldC52YWx1ZSkge1xyXG4gICAgICBwYWdlTnVtYmVyID0gKyhldmVudC5jdXJyZW50VGFyZ2V0LnZhbHVlKTtcclxuICAgIH1cclxuICAgIHRoaXMucGFnaW5hdGlvblNlcnZpY2UuZ29Ub1BhZ2VOdW1iZXIocGFnZU51bWJlciwgZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgY2hhbmdlSXRlbVBlclBhZ2UoZXZlbnQ6IGFueSkge1xyXG4gICAgbGV0IGl0ZW1zUGVyUGFnZSA9IDE7XHJcbiAgICBpZiAoZXZlbnQgJiYgZXZlbnQuY3VycmVudFRhcmdldCAmJiBldmVudC5jdXJyZW50VGFyZ2V0LnZhbHVlKSB7XHJcbiAgICAgIGl0ZW1zUGVyUGFnZSA9ICsoZXZlbnQuY3VycmVudFRhcmdldC52YWx1ZSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnBhZ2luYXRpb25TZXJ2aWNlLmNoYW5nZUl0ZW1QZXJQYWdlKGl0ZW1zUGVyUGFnZSwgZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIHRoaXMucGFnaW5hdGlvblNlcnZpY2UuZGlzcG9zZSgpO1xyXG5cclxuICAgIC8vIGFsc28gdW5zdWJzY3JpYmUgYWxsIEFuZ3VsYXIgU3Vic2NyaXB0aW9uc1xyXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zID0gdW5zdWJzY3JpYmVBbGxPYnNlcnZhYmxlcyh0aGlzLnN1YnNjcmlwdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgLy8gLS1cclxuICAvLyBwcml2YXRlIGZ1bmN0aW9uc1xyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIC8qKiBUcmFuc2xhdGUgYWxsIHRoZSB0ZXh0cyBzaG93biBpbiB0aGUgVUksIHVzZSBuZ3gtdHJhbnNsYXRlIHNlcnZpY2Ugd2hlbiBhdmFpbGFibGUgb3IgY3VzdG9tIGxvY2FsZXMgd2hlbiBzZXJ2aWNlIGlzIG51bGwgKi9cclxuICBwcml2YXRlIHRyYW5zbGF0ZUFsbFVpVGV4dHMobG9jYWxlczogTG9jYWxlKSB7XHJcbiAgICBpZiAodGhpcy5fZW5hYmxlVHJhbnNsYXRlICYmIHRoaXMudHJhbnNsYXRlICYmIHRoaXMudHJhbnNsYXRlLmluc3RhbnQgJiYgdGhpcy50cmFuc2xhdGUuY3VycmVudExhbmcpIHtcclxuICAgICAgdGhpcy50ZXh0SXRlbXNQZXJQYWdlID0gdGhpcy50cmFuc2xhdGUuaW5zdGFudCgnSVRFTVNfUEVSX1BBR0UnKTtcclxuICAgICAgdGhpcy50ZXh0SXRlbXMgPSB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KCdJVEVNUycpO1xyXG4gICAgICB0aGlzLnRleHRPZiA9IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ09GJyk7XHJcbiAgICAgIHRoaXMudGV4dFBhZ2UgPSB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KCdQQUdFJyk7XHJcbiAgICB9IGVsc2UgaWYgKGxvY2FsZXMpIHtcclxuICAgICAgdGhpcy50ZXh0SXRlbXNQZXJQYWdlID0gbG9jYWxlcy5URVhUX0lURU1TX1BFUl9QQUdFIHx8ICdURVhUX0lURU1TX1BFUl9QQUdFJztcclxuICAgICAgdGhpcy50ZXh0SXRlbXMgPSBsb2NhbGVzLlRFWFRfSVRFTVMgfHwgJ1RFWFRfSVRFTVMnO1xyXG4gICAgICB0aGlzLnRleHRPZiA9IGxvY2FsZXMuVEVYVF9PRiB8fCAnVEVYVF9PRic7XHJcbiAgICAgIHRoaXMudGV4dFBhZ2UgPSBsb2NhbGVzLlRFWFRfUEFHRSB8fCAnVEVYVF9QQUdFJztcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19